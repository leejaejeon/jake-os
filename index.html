<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>Jake WorkOS V24 - Organic Map Selector</title>
  
  <script src="https://unpkg.com/react@18/umd/react.production.min.js" crossorigin></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js" crossorigin></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

  <style>
    @import url('https://cdn.jsdelivr.net/gh/orioncactus/pretendard@v1.3.9/dist/web/static/pretendard.min.css');
    body { font-family: 'Pretendard', sans-serif; background-color: #f1f5f9; color: #1e293b; -webkit-font-smoothing: antialiased; overflow: hidden; }
    
    ::-webkit-scrollbar { width: 8px; height: 8px; }
    ::-webkit-scrollbar-track { background: #f8fafc; border-radius: 4px; }
    ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 4px; border: 2px solid #f8fafc; }
    ::-webkit-scrollbar-thumb:hover { background: #94a3b8; }
    .no-scrollbar::-webkit-scrollbar { display: none; }
    .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
    
    .calendar-grid { display: grid; grid-template-columns: repeat(7, 1fr); gap: 1px; background-color: #e2e8f0; border: 1px solid #e2e8f0; }
    .calendar-cell { min-height: 100px; background-color: #fff; padding: 4px; cursor: pointer; transition: background-color 0.2s; }
    .calendar-cell:hover { background-color: #f8fafc; }
    .calendar-cell:active { background-color: #f1f5f9; }
    
    .modal-enter { animation: fadeIn 0.2s ease-out; }
    @keyframes fadeIn { from { opacity: 0; transform: scale(0.98); } to { opacity: 1; transform: scale(1); } }

    .map-row { display: flex; flex-direction: row; justify-content: flex-start; gap: 4px; margin-bottom: 4px; width: max-content; }
    .map-slot { width: 85px; min-width: 85px; height: 70px; border-radius: 4px; border: 1px solid #cbd5e1; display: flex; flex-direction: column; justify-content: center; align-items: center; cursor: pointer; transition: transform 0.1s; }
    .map-slot:active { opacity: 0.7; transform: scale(0.95); }
    .slot-spacer { visibility: hidden; pointer-events: none; border: none; background: transparent; } 
    .slot-id { font-size: 10px; font-weight: 800; margin-bottom: 2px; }
    .slot-name { font-size: 11px; font-weight: 800; text-align: center; width: 100%; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; padding: 0 2px; letter-spacing: -0.5px; }

    .form-input { width: 100%; padding: 10px 12px; border: 1px solid #cbd5e1; border-radius: 8px; font-size: 14px; font-weight: bold; color: #1e293b; outline: none; transition: border-color 0.2s; background-color: #f8fafc; }
    .form-input:focus { border-color: #3b82f6; box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1); background-color: #ffffff; }
    .form-label { display: block; font-size: 11px; font-weight: 900; color: #64748b; margin-bottom: 4px; text-transform: uppercase; letter-spacing: 0.5px; }
  </style>

  <script>
    window.JAKE_MAP_RAW_JSON = `{"A2/Í∞Ä":["1-12","1-11","1-10","1-9","1-8","1-7","1-6","1-5","1-4","1-3","1-2","1-1"],"A3/Í∞Ä":["1-7","1-6","1-5","1-4","1-3-2","1-3-1","1-2","1-1","2-7","2-6","2-5","2-4","2-3","2-2","2-1","2-1A"],"A4/Í∞Ä":["_6","1-6","1-5","1-4","1-3","1-2","1-1","_9","2-1","_2","3-12","3-11","3-10","3-9","3-8","3-7","3-6","3-5","3-4","3-3","3-2","3-1","4-12","4-11","4-10","4-9","4-8","4-7","4-6","4-5","4-4","4-3","4-2","4-1","5-12-2","5-12-1","5-11-2","5-11-1","5-10-2","5-10-1","5-9-2","5-9-1","5-8-2","5-8-1","5-7-2","5-7-1","5-6","5-5","5-4","5-3","5-2","5-1","5-12-4","5-12-3","5-11-4","5-11-3","5-10-4","5-10-3","5-9-4","5-9-3","5-8-4","5-8-3","5-7-4","5-7-3","_6","5-12-8","5-12-7","5-12-6","5-12-5","5-11-8","5-11-7","5-11-6","5-11-5","5-10-8","5-10-7","5-10-6","5-10-5","5-9-8","5-9-7","5-9-6","5-9-5","5-8-8","5-8-7","5-8-6","5-8-5","_8","6-5","6-4","6-3","6-2","6-1","_7"],"A4/ÎÇò":["1-9","1-8","1-7","1-6","1-5","1-4","1-3","1-2","1-1","2-11","2-10","2-9","2-8","2-7","2-6","2-5","2-4","2-3","2-2","2-1","3-7","3-6","3-5","3-4","3-3","3-2","3-1","4-8","4-7","4-6","4-5","4-4","4-3","4-2","4-1","5-8","5-7","5-6","5-5","5-4","5-3","5-2","5-1"],"A4/Îã§":["4-6","4-5","4-4","4-3","4-2","4-1","5-6","5-5","5-4","5-3","5-2","5-1"],"A5/Í∞Ä":["1-13","1-12","1-11","1-10","1-9","1-8","1-7","1-6","1-5","1-4","1-3","1-2","1-1","2-14","2-13","2-12","2-11","2-10","2-9","2-8","2-7","2-6","2-5","2-4","2-3","2-2","2-1","3-14","3-13","3-12","3-11","3-10","3-9","3-8","3-7","3-6","3-5","3-4","3-3","3-2","3-1","4-13","4-12","4-11","4-10","4-9","4-8","4-7","4-6","4-5","4-4","4-3","4-2","4-1","5-13","5-12","5-11","5-10","5-9","5-8","5-7","5-6","5-5","5-4","5-3","5-2","5-1","6-11","6-10","6-9","6-8","6-7","6-6","6-5","6-4","6-3","6-2","6-1C","6-1B","6-1A","6-0","6-1M","8-8","8-7","8-6","8-5","8-4","8-3","8-2","8-1","8-1C","8-1B","8-1A"],"A5/ÎÇò":["_9","1-14","1-13","1-12","1-11","1-10","1-9","1-8","1-7","1-6","1-5","1-4","1-3","1-2","1-1","2-22","2-21","2-20","2-19","2-18","2-17","2-16","2-15","2-14","2-13","2-12","2-11","2-10","2-9","2-8","2-7","2-6","2-5","2-4","2-3","2-2","2-1","3-26","3-25","3-24","3-23","3-22","3-21","3-20","3-19","3-18","3-17","3-16","3-15","3-14","3-13","3-12","3-11","3-10","3-9","3-8","3-7","3-6","3-5","3-4","3-3","3-2","3-1","4-25","4-24","4-23","4-22","4-21","4-20","4-19","4-18","4-17","4-16","4-15","4-14","4-13","4-12","4-11","4-10","4-9","4-8","4-7","4-6","4-5","4-4","4-3","4-2","4-1","5-29","5-28","5-27","5-26","5-25","5-24","5-23","5-22","5-21","5-20","5-19","5-18","5-17","5-16","5-15","5-14","5-13","5-12","5-11","5-10","5-9","5-8","5-7A","5-7","5-6","5-5","5-4","5-3","5-2","5-1","6-47","6-46","6-45","6-44","6-43","6-42","6-41","6-40","6-39","6-38","6-37","6-36","6-35","6-34","6-33","6-32","6-31","6-30","6-29-1","6-28-1","6-27-1","6-26-1","6-25-1","6-24-1","6-23-1","6-22-1","6-21-1","6-20-1","6-19-1","6-18-1","6-17-1","6-16-1","6-15-1","6-14-1","6-13-1","6-12-1","6-11-1","6-10-1","6-9-1","6-8-1","6-7-1","6-6-1","6-5-1","6-4-1","6-3-1","6-2-1","6-1-1","_18","6-29-2","6-28-2","6-27-2","6-26-2","6-25-2","6-24-2","6-23-2","6-22-2","6-21-2","6-20-2","6-19-2","6-18-2","6-17-2","6-16-2","6-15-2","6-14-2","6-13-2","6-12-2","6-11-2","6-10-2","6-9-2","6-8-2","6-7-2","6-6-2","6-5-2","6-4-2","6-3-2","6-2-2","6-1-2","_18","6-29-3","6-28-3","6-27-3","6-26-3","6-25-3","6-24-3","6-23-3","6-22-3","6-21-3","6-20-3","6-19-3","6-18-3","_17","7-9","7-8","7-7","7-6","7-5","7-4","7-3","7-2","7-1","_30"],"A6/Í∞Ä":["1-23","1-22","1-21","1-20","1-19","1-18","1-17","1-16-2","1-16-1","1-15","1-14-2","1-14-1","1-13","1-12","1-11","1-10","1-9-2","1-9-1","1-8","1-7","1-6","1-5-2","1-5-1","1-4","1-3","1-2","1-1","2-22","2-21","2-20","2-19-2","2-19-1","2-18","2-17-2","2-17-1","2-16","2-15","2-14","2-13","2-12","2-11","2-10","2-9","2-8-2","2-8-1","2-7","2-6-2","2-6-1","2-5","2-4","2-3","2-2","2-1-2","2-1-1","_2","3-19-2","3-19-1","3-18","3-17","3-16","3-15","3-14","3-13","3-12","3-11","3-10","3-9","3-8","3-7","3-6","3-5","3-4","3-3","3-2","3-1","4-18","4-17","4-16","4-15","4-14","4-13","4-12","4-11","4-10","4-9","4-8","4-7","4-6","4-5","4-4","4-3","4-2","4-1","5-18","5-17","5-16","5-15","5-14","5-13","5-12","5-11","5-10","5-9","5-8","5-7","5-6","5-5-2","5-5-1","5-4","5-3","5-2","5-1","6-15","6-14","6-13","6-12","6-11","6-10","6-9","6-8","6-7","6-6","6-5","6-4","6-3","6-2","6-1","7-13","7-12","7-11","7-10","7-9","7-8","7-7","7-6","7-5","7-4","7-3","7-2","7-1"],"A6/ÎÇò":["1-25","1-24","1-23","1-22","1-21","1-20","1-19","1-18","1-17","1-16","1-15","1-14","1-13","1-12","1-11","1-10","1-9","1-8","1-7","1-6","1-5","1-4","1-3","1-2","1-1","2-26","2-25","2-24","2-23","2-22","2-21","2-20","2-19","2-18","2-17","2-16","2-15","2-14","2-13","2-12","2-11","2-10","2-9","2-8","2-7","2-6","2-5","2-4","2-3","2-2","2-1","3-26","3-25","3-24","3-23","3-22","3-21","3-20","3-19","3-18","3-17","3-16","3-15","3-14","3-13","3-12","3-11","3-10","3-9","3-8","3-7","3-6","3-5","3-4","3-3","3-2","3-1","4-26","4-25","4-24","4-23","4-22","4-21","4-20","4-19","4-18","4-17","4-16","4-15","4-14","4-13","4-12","4-11","4-10","4-9","4-8","4-7","4-6","4-5","4-4","4-3","4-2","4-1","5-14","5-13","5-12-1","5-12-2","5-11-1","5-11-2","5-10-1","5-10-2","5-9-1","5-9-2","5-8-1","5-8-2","5-7-1","5-7-2","5-6-1","5-6-2","5-5-1","5-5-2","5-4-1","5-4-2","5-3-1","5-3-2","5-2-1","5-2-2","5-1-1","5-1-2","_4","5-11-3","5-11-4","5-10-3","5-10-4","5-9-3","5-9-4","5-8-3","5-8-4","5-7-3","5-7-4","5-6-3","_1","5-5-3","5-5-4","5-4-3","5-4-4","5-3-3","5-3-4","5-2-3","5-2-4","5-1-3","5-1-4"],"C1/Í∞Ä":["1-13","1-12","1-11","1-10","1-9","1-8","1-7","1-6","1-5","1-4","1-3","1-2","1-1","2-17","2-16","2-15","2-14","2-13","2-12","2-11","2-10","2-9","2-8","2-7","2-6","2-5","2-4","2-3","2-2","2-1","3-21","3-20","3-19","3-18","3-17","3-16","3-15","3-14","3-13","3-12","3-11","3-10","3-9","3-8","3-7","3-6","3-5","3-4","3-3","3-2","3-1","4-25","4-24","4-23","4-22","4-21","4-20","4-19","4-18","4-17","4-16","4-15","4-14","4-13","4-12","4-11","4-10","4-9","4-8","4-7","4-6","4-5","4-4","4-3","4-2","4-1"],"B1/Í∞Ä":["1-20","1-19","1-18","1-17","1-16","1-15","1-14","1-13","1-12","1-11","1-10","1-9","1-8","1-7","1-6","1-5","1-4","1-3","1-2","1-1","2-23","2-22","2-21","2-20","2-19","2-18","2-17","2-16","2-15","2-14","2-13","2-12","2-11","2-10","2-9","2-8","2-7","2-6","2-5","2-4","2-3","2-2","2-1"],"B2/Í∞Ä":["1-5","1-4","1-3","1-2","1-1","_29","2-4","2-3","2-2","2-1","_30","3-35","3-34","3-33","3-32","3-31","3-30","3-29","3-28","3-27","3-26","3-25","3-24","3-23","3-22","3-21","3-20","3-19","3-18","3-17","3-16","3-15","3-14","3-13","3-12","3-11","3-10","3-9","3-8","3-7","3-6","3-5","3-4","3-3","3-2","3-1","4-34","4-33","4-32","4-31","4-30","4-29","4-28","4-27","4-26","4-25","4-24","4-23","4-22","4-21","4-20","4-19","4-18","4-17","4-16","4-15","4-14","4-13","4-12","4-11","4-10","4-9","4-8","4-7","4-6","4-5","4-4","4-3","4-2","4-1","5-34","5-33","5-32","5-31","5-30","5-29","5-28","5-27","5-26","5-25","5-24","5-23","5-22","5-21","5-20","5-19","5-18","5-17","5-16","5-15","5-14","5-13","5-12","5-11","5-10","5-9","5-8","5-7","5-6","5-5","5-4","5-3","5-2","5-1"],"B3/Í∞Ä":["1-48","1-47","1-46","1-45","1-44","1-43","1-42","1-41","1-40","1-39","1-38","1-37","1-36","1-35","1-34","1-33","1-32","1-31","1-30","1-29","1-28","1-27","1-26","1-25","1-24","1-23","1-22","1-21","1-20","1-19","1-18","1-17","1-16","1-15","1-14","1-13","1-12","1-11","1-10","1-9","1-8","1-7","1-6","1-5","1-4","1-3","1-2","1-1","2-46","2-45","2-44","2-43","2-42","2-41","2-40","2-39","2-38","2-37","2-36","2-35","2-34","2-33","2-32","2-31","2-30","2-29","2-28","2-27","2-26","2-25","2-24","2-23","2-22","2-21","2-20","2-19","2-18","2-17","2-16","2-15","2-14","2-13","2-12","2-11","2-10","2-9","2-8","2-7","2-6","2-5","2-4","2-3","2-2","2-1","3-45","3-44","3-43","3-42","3-41","3-40","3-39","3-38","3-37","3-36","3-35","3-34","3-33","3-32","3-31","3-30","3-29","3-28","3-27","3-26","3-25","3-24","3-23","3-22","3-21","3-20","3-19","3-18","3-17","3-16","3-15","3-14","3-13","3-12","3-11","3-10","3-9","3-8","3-7","3-6","3-5","3-4","3-3","3-2","3-1","4-41","4-40","4-39","4-38","4-37","4-36","4-35","4-34","4-33","4-32","4-31","4-30","4-29","4-28","4-27","4-26","4-25","4-24","4-23","4-22","4-21","4-20","4-19","4-18","4-17","4-16","4-15","4-14","4-13","4-12","4-11","4-10","4-9","4-8","4-7","4-6","4-5","4-4","4-3","4-2","4-1"],"B4/Í∞Ä":["1-37","1-36","1-35","1-34","1-33","1-32","1-31","1-30","1-29","1-28","1-27","1-26","1-25","1-24","1-23","1-22","1-21","1-20","1-19","1-18","1-17","1-16","1-15","1-14","1-13","1-12","1-11","1-10","1-9","1-8","1-7","1-6","1-5","1-4","1-3","1-2","1-1","2-38","2-37","2-36","2-35","2-34","2-33","2-32","2-31","2-30","2-29","2-28","2-27","2-26","2-25","2-24","2-23","2-22","2-21","2-20","2-19","2-18","2-17","2-16","2-15","2-14","2-13","2-12","2-11","2-10","2-9","2-8","2-7","2-6","2-5","2-4","2-3","2-2","2-1","3-41","3-40","3-39","3-38","3-37","3-36","3-35","3-34","3-33","3-32","3-31","3-30","3-29","3-28","3-27","3-26","3-25","3-24","3-23","3-22","3-21","3-20","3-19","3-18","3-17","3-16","3-15","3-14","3-13","3-12","3-11","3-10","3-9","3-8","3-7","3-6","3-5","3-4","3-3","3-2","3-1","4-41","4-40","4-39","4-38","4-37","4-36","4-35","4-34","4-33","4-32","4-31","4-30","4-29","4-28","4-27","4-26","4-25","4-24","4-23","4-22","4-21","4-20","4-19","4-18","4-17","4-16","4-15","4-14","4-13","4-12","4-11","4-10","4-9","4-8","4-7","4-6","4-5","4-4","4-3","4-2","4-1","5-34","5-33","5-32","5-31","5-30","5-29","5-28","5-27","5-26","5-25","5-24","5-23","5-22","5-21","5-20","5-19","5-18","5-17","5-16","5-15","5-14","5-13","5-12","5-11","5-10","5-9","5-8","5-7","5-6","5-5","5-4","5-3","5-2","5-1"],"B5/Í∞Ä":["1-47","1-46","1-45","1-44","1-43","1-42","1-41","1-40","1-39","1-38","1-37","1-36","1-35","1-34","1-33","1-32","1-31","1-30","1-29","1-28","1-27","1-26","1-25","1-24","1-23","1-22","1-21","1-20","1-19","1-18","1-17","1-16","1-15","1-14","1-13","1-12","1-11","1-10","1-9","1-8","1-7","1-6","1-5","1-4","1-3","1-2","1-1","2-47","2-46","2-45","2-44","2-43","2-42","2-41","2-40","2-39","2-38","2-37","2-36","2-35","2-34","2-33","2-32","2-31","2-30","2-29","2-28","2-27","2-26","2-25","2-24","2-23","2-22","2-21","2-20","2-19","2-18","2-17","2-16","2-15","2-14","2-13","2-12","2-11","2-10","2-9","2-8","2-7","2-6","2-5","2-4","2-3","2-2","2-1","3-49","3-48","3-47","3-46","3-45","3-44","3-43","3-42","3-41","3-40","3-39","3-38","3-37","3-36","3-35","3-34","3-33","3-32","3-31","3-30","3-29","3-28","3-27","3-26","3-25","3-24","3-23","3-22","3-21","3-20","3-19","3-18","3-17","3-16","3-15","3-14","3-13","3-12","3-11","3-10","3-9","3-8","3-7","3-6","3-5","3-4","3-3","3-2","3-1","4-48","4-47","4-46","4-45","4-44","4-43","4-42","4-41","4-40","4-39","4-38","4-37","4-36","4-35","4-34","4-33","4-32","4-31","4-30","4-29","4-28","4-27","4-26","4-25","4-24","4-23","4-22","4-21","4-20","4-19","4-18","4-17","4-16","4-15","4-14","4-13","4-12","4-11","4-10","4-9","4-8","4-7","4-6","4-5","4-4","4-3","4-2","4-1","5-40","5-39","5-38","5-37","5-36","5-35","5-34","5-33","5-32","5-31","5-30","5-29","5-28","5-27","5-26","5-25","5-24","5-23","5-22","5-21","5-20","5-19","5-18","5-17","5-16","5-15","5-14","5-13","5-12","5-11","5-10","5-9","5-8","5-7","5-6","5-5","5-4","5-3","5-2","5-1","6-30","6-29-2","6-29-1","6-28","6-27","6-26","6-25","6-24-2","6-24-1","6-23","6-22","6-21","6-20","6-19","6-18","6-17","6-16","6-15","6-14","6-13","6-12","6-11","6-10","6-9","6-8","6-7","6-6","6-5","6-4","6-3","6-2","6-1"],"B6/Í∞Ä/1-12":["1-47","1-46","1-45","1-44","1-43","1-42","1-41","1-40","1-39","1-38","1-37","1-36","1-35","1-34","1-33","1-32","1-31","1-30","1-29","1-28","1-27","1-26","1-25","1-24","1-23","1-22","1-21","1-20","1-19","1-18","1-17","1-16","1-15","1-14","1-13","1-12","1-11","1-10","1-9","1-8","1-7","1-6","1-5","1-4","1-3","1-2","1-1","2-52","2-51","2-50","2-49","2-48","2-47","2-46","2-45","2-44","2-43","2-42","2-41","2-40","2-39","2-38","2-37","2-36","2-35","2-34","2-33","2-32","2-31","2-30","2-29","2-28","2-27","2-26","2-25","2-24","2-23","2-22","2-21","2-20","2-19","2-18","2-17","2-16","2-15","2-14","2-13","2-12","2-11","2-10","2-9","2-8","2-7","2-6","2-5","2-4","2-3","2-2","2-1","3-53","3-52","3-51","3-50","3-49","3-48","3-47","3-46","3-45","3-44","3-43","3-42","3-41","3-40","3-39","3-38","3-37","3-36","3-35","3-34","3-33","3-32","3-31","3-30","3-29","3-28","3-27","3-26","3-25","3-24","3-23","3-22","3-21","3-20","3-19","3-18","3-17","3-16","3-15","3-14","3-13","3-12","3-11","3-10","3-9","3-8","3-7","3-6","3-5","3-4","3-3","3-2","3-1","4-52","4-51","4-50","4-49","4-48","4-47","4-46","4-45","4-44","4-43","4-42","4-41","4-40","4-39","4-38","4-37","4-36","4-35","4-34","4-33","4-32","4-31","4-30","4-29","4-28","4-27","4-26","4-25","4-24","4-23","4-22","4-21","4-20","4-19","4-18","4-17","4-16","4-15","4-14","4-13","4-12","4-11","4-10","4-9","4-8","4-7","4-6","4-5","4-4","4-3","4-2","4-1","5-53","5-52","5-51","5-50","5-49","5-48","5-47","5-46","5-45","5-44","5-43","5-42","5-41","5-40","5-39","5-38","5-37","5-36","5-35","5-34","5-33","5-32","5-31","5-30","5-29","5-28","5-27","5-26","5-25","5-24","5-23","5-22","5-21","5-20","5-19","5-18","5-17","5-16","5-15","5-14","5-13","5-12","5-11","5-10","5-9","5-8","5-7","5-6","5-5","5-4","5-3","5-2","5-1","6-53","6-52","6-51","6-50","6-49","6-48","6-47","6-46","6-45","6-44","6-43","6-42","6-41","6-40","6-39","6-38","6-37","6-36","6-35","6-34","6-33","6-32","6-31","6-30","6-29","6-28","6-27","6-26","6-25","6-24","6-23","6-22","6-21","6-20","6-19","6-18","6-17","6-16","6-15","6-14","6-13","6-12","6-11","6-10","6-9","6-8","6-7","6-6","6-5","6-4","6-3","6-2","6-1","6-107","6-106","6-105","6-104","6-103","6-102","6-101","6-100","6-99","6-98","6-97","6-96","6-95","6-94","6-93","6-92","6-91","6-90","6-89","6-88","6-87","6-86","6-85","6-84","6-83","6-82","6-81","6-80","6-79","6-78","6-77","6-76","6-75","6-74","6-73","6-72","6-71","6-70","6-69","6-68","6-67","6-66","6-65","6-64","6-63","6-62","6-61","6-60","6-59","6-58","6-57","6-56","6-55","6-54","7-54","7-53","7-52","7-51","7-50","7-49","7-48","7-47","7-46","7-45","7-44","7-43","7-42","7-41","7-40","7-39","7-38","7-37","7-36","7-35","7-34","7-33","7-32","7-31","7-30","7-29","7-28","7-27","7-26","7-25","7-24","7-23","7-22","7-21","7-20","7-19","7-18","7-17","7-16","7-15","7-14","7-13","7-12","7-11","7-10","7-9","7-8","7-7","7-6","7-5","7-4","7-3","7-2","7-1","8-54","8-53","8-52","8-51","8-50","8-49","8-48","8-47","8-46","8-45","8-44","8-43","8-42","8-41","8-40","8-39","8-38","8-37","8-36","8-35","8-34","8-33","8-32","8-31","8-30","8-29","8-28","8-27","8-26","8-25","8-24","8-23","8-22","8-21","8-20","8-19","8-18","8-17","8-16","8-15","8-14","8-13","8-12","8-11","8-10","8-9","8-8","8-7","8-6","8-5","8-4","8-3","8-2","8-1","9-53","9-52","9-51","9-50","9-49","9-48","9-47","9-46","9-45","9-44","9-43","9-42","9-41","9-40","9-39","9-38","9-37","9-36","9-35","9-34","9-33","9-32","9-31","9-30","9-29","9-28","9-27","9-26","9-25","9-24","9-23","9-22","9-21","9-20","9-19","9-18","9-17","9-16","9-15","9-14","9-13","9-12","9-11","9-10","9-9","9-8","9-7","9-6","9-5","9-4","9-3","9-2","9-1","10-55","10-54","10-53","10-52","10-51","10-50","10-49","10-48","10-47","10-46","10-45","10-44","10-43","10-42","10-41","10-40","10-39","10-38","10-37","10-36","10-35","10-34","10-33","10-32","10-31","10-30","10-29","10-28","10-27","10-26","10-25","10-24","10-23","10-22","10-21","10-20","10-19","10-18","10-17","10-16","10-15","10-14","10-13","10-12","10-11","10-10","10-9","10-8","10-7","10-6","10-5","10-4","10-3","10-2","10-1","11-54","11-53","11-52","11-51","11-50","11-49","11-48","11-47","11-46","11-45","11-44","11-43","11-42","11-41","11-40","11-39","11-38","11-37","11-36","11-35","11-34","11-33","11-32","11-31","11-30","11-29","11-28","11-27","11-26","11-25","11-24","11-23","11-22","11-21","11-20","11-19","11-18","11-17","11-16","11-15","11-14","11-13","11-12","11-11","11-10","11-9","11-8","11-7","11-6","11-5","11-4","11-3","11-2","11-1","12-50","12-49","12-48","12-47","12-46","12-45","12-44","12-43","12-42","12-41","12-40","12-39","12-38","12-37","12-36","12-35","12-34","12-33","12-32","12-31","12-30","12-29","12-28","12-27","12-26","12-25","12-24","12-23","12-22","12-21","12-20","12-19","12-18","12-17","12-16","12-15","12-14","12-13","12-12","12-11","12-10","12-9","12-8","12-7","12-6","12-5","12-4","12-3","12-2","12-1"],"B6/Í∞Ä/13-14":["13-38-2","13-38-1","13-37-2","13-37-1","13-36-2","13-36-1","13-35-2","13-35-1","13-34-2","13-34-1","13-33-2","13-33-1","13-32-2","13-32-1","13-31-2","13-31-1","13-30-2","13-30-1","13-29-2","13-29-1","13-28-2","13-28-1","13-27-2","13-27-1","13-26-2","13-26-1","13-25-2","13-25-1","13-24-2","13-24-1","13-23-2","13-23-1","13-22-2","13-22-1","13-21-2","13-21-1","13-20-2","13-20-1","13-19-2","13-19-1","13-18-2","13-18-1","13-17-2","13-17-1","13-16-2","13-16-1","13-15-2","13-15-1","13-14-2","13-14-1","13-13-2","13-13-1","13-12-2","13-12-1","13-11-2","13-11-1","13-10-2","13-10-1","13-9-2","13-9-1","13-8-2","13-8-1","13-7-2","13-7-1","13-6-2","13-6-1","13-5","13-4-2","13-4-1","13-3-2","13-3-1","13-2-2","13-2-1","13-1-2","13-1-1","13-38-4","13-38-3","13-37-4","13-37-3","13-36-4","13-36-3","13-35-4","13-35-3","13-34-4","13-34-3","13-33-4","13-33-3","13-32-4","13-32-3","13-31-4","13-31-3","13-30-4","13-30-3","13-29-4","13-29-3","13-28-4","13-28-3","13-27-4","13-27-3","13-26-4","13-26-3","13-25-4","13-25-3","13-24-4","13-24-3","13-23-4","13-23-3","13-22-4","13-22-3","13-21-4","13-21-3","13-20-4","13-20-3","13-19-4","13-19-3","13-18-4","13-18-3","13-17-4","13-17-3","13-16-4","13-16-3","13-15-4","13-15-3","13-14-4","13-14-3","13-13-4","13-13-3","13-12-4","13-12-3","13-11-4","13-11-3","13-10-4","13-10-3","13-9-4","13-9-3","13-8-4","13-8-3","13-7-4","13-7-3","13-6-4","13-6-3","_9","13-38-6","13-38-5","13-37-6","13-37-5","13-36-6","13-36-5","13-35-6","13-35-5","13-34-6","13-34-5","13-33-6","13-33-5","13-32-6","13-32-5","13-31-6","13-31-5","13-30-6","13-30-5","13-29-6","13-29-5","13-28-6","13-28-5","13-27-6","13-27-5","13-26-6","13-26-5","13-25-6","13-25-5","13-24-6","13-24-5","13-23-6","13-23-5","13-22-6","13-22-5","13-21-6","13-21-5","13-20-6","13-20-5","13-19-6","13-19-5","13-18-6","13-18-5","13-17-6","13-17-5","13-16-6","13-16-5","13-15-6","13-15-5","13-14-6","13-14-5","13-13-6","13-13-5","_23","14-19-2","14-19-1","14-18-2","14-18-1","14-17-2","14-17-1","14-16-2","14-16-1","14-15-2","14-15-1","14-14-2","14-14-1","14-13-2","14-13-1","14-12-2","14-12-1","14-11-2","14-11-1","14-10-2","14-10-1","14-9-2","14-9-1","14-8-2","14-8-1","14-7-2","14-7-1","14-6-2","14-6-1","14-5-2","14-5-1","14-4-2","14-4-1","14-3-2","14-3-1","14-2-2","14-2-1","14-1-2","14-1-1","_37","14-19-5","14-19-4","14-19-3","14-18-4","14-18-3","14-17-4","14-17-3","14-16-4","14-16-3","14-15-4","14-15-3","14-14-4","14-14-3","14-13-4","14-13-3","14-12-4","14-12-3","14-11-4","14-11-3","14-10-4","14-10-3","14-9-4","14-9-3","14-8-4","14-8-3","14-7-4","14-7-3","14-6-4","14-6-3","14-5-4","14-5-3","_44","14-19-8","14-19-7","14-19-6","14-18-6","14-18-5","14-17-6","14-17-5","14-16-6","14-16-5","14-15-6","14-15-5","14-14-6","14-14-5","14-13-6","14-13-5","14-12-6","14-12-5","14-11-6","14-11-5","14-10-6","14-10-5","_54","14-19-11","14-19-10","14-19-9","14-18-8","14-18-7","14-17-8","14-17-7","14-16-8","14-16-7","14-15-8","14-15-7","14-14-8","14-14-7","14-13-8","14-13-7","14-12-8","14-12-7","14-11-7","_57","14-19-14","14-19-13","14-19-12","14-18-10","14-18-9","14-17-10","14-17-9","14-16-10","14-16-9","14-15-10","14-15-9","14-14-10","14-14-9","14-13-10","14-13-9","14-12-9","_59","14-19-17","14-19-16","14-19-15","14-18-12","14-18-11","14-17-12","14-17-11","_68"]}`;

    // üö® React Î∞îÍπ•ÏóêÏÑú Ï¶âÏãú ÎèôÍ∏∞Ìôî ÌååÏã± (ÎπÑÎèôÍ∏∞ ÏóêÎü¨ ÏõêÏ≤ú Ï∞®Îã®)
    let GLOBAL_LAYOUT_DATA = {};
    try {
      GLOBAL_LAYOUT_DATA = JSON.parse(window.JAKE_MAP_RAW_JSON);
    } catch(e) {
      console.error("Critical JSON Parse Error", e);
    }
  </script>

  <script type="text/babel">
    const { useState, useEffect, useMemo } = React;

    const SUPABASE_URL = 'https://lqccxnciiajwqdmpwjdv.supabase.co';
    const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImxxY2N4bmNpaWFqd3FkbXB3amR2Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzE1MjA3MTMsImV4cCI6MjA4NzA5NjcxM30.L23-eq-DIPsbONOeX-xQ8UcMb7gtgTTTRpkaSm9HTw4';
    const supabaseClient = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

    const clean = (val) => (!val || val === '0.0' || val === '0' || val === 'null' || val === ' -  - ' || val === 'SPACER') ? '' : String(val).trim();
    const normalizeDate = (v) => { 
      if(!v) return null; 
      try {
        const s = String(v).replace(/\./g,'-').replace(/\s/g,'').substring(0,10);
        const m = s.match(/^(\d{4})-(\d{1,2})-(\d{1,2})/);
        return m ? `${m[1]}-${m[2].padStart(2, '0')}-${m[3].padStart(2, '0')}` : null;
      } catch(e) { return null; }
    };
    const formatMoney = (val) => {
      try {
        const num = parseInt(String(val).replace(/[^0-9]/g, ''));
        return isNaN(num) ? '0Ïõê' : num.toLocaleString() + 'Ïõê';
      } catch(e) { return '0Ïõê'; }
    };
    const getTodayStr = () => new Date().toISOString().split('T')[0];

    const SECTION_LIST = ['A2/Í∞Ä','A3/Í∞Ä','A4/Í∞Ä','A4/ÎÇò','A4/Îã§','A5/Í∞Ä','A5/ÎÇò','A6/Í∞Ä','A6/ÎÇò','B1/Í∞Ä','B2/Í∞Ä','B3/Í∞Ä','B4/Í∞Ä','B5/Í∞Ä','B6/Í∞Ä/1-12','B6/Í∞Ä/13-14','C1/Í∞Ä'];
    const ROW_CONFIG = { 
      'A2/Í∞Ä':[12], 'A3/Í∞Ä':[8,8], 'A4/Í∞Ä':[12,12,12,12,18,18,28,12], 'A4/ÎÇò':[9,11,7,8,8], 'A4/Îã§':[6,6], 'A5/Í∞Ä':[13,14,14,13,13,15,11], 
      'A5/ÎÇò':[23,22,26,25,30,47,47,30,39], 'A6/Í∞Ä':[27,27,22,18,19,15,13], 'A6/ÎÇò':[25,26,26,26,26,26], 'C1/Í∞Ä':[13,17,21,25], 
      'B1/Í∞Ä':[20,23], 'B2/Í∞Ä':[34,34,35,34,34], 'B3/Í∞Ä':[48,46,45,41], 'B4/Í∞Ä':[37,38,41,41,34], 'B5/Í∞Ä':[47,47,49,48,40,32], 
      'B6/Í∞Ä/1-12':[47,52,53,52,53,53,54,54,54,53,55,54,50], 'B6/Í∞Ä/13-14':[75,75,75,75,75,75,75,75,75] 
    };

    class ErrorBoundary extends React.Component {
      constructor(props) { super(props); this.state = { hasError: false, error: null }; }
      static getDerivedStateFromError(error) { return { hasError: true, error }; }
      render() {
        if (this.state.hasError) {
          return (
            <div className="p-8 m-4 bg-rose-50 border-2 border-rose-500 rounded-xl shadow-lg">
              <h1 className="text-xl font-black text-rose-700 mb-2">üö® V24 ÏãúÏä§ÌÖú Ïò§Î•ò</h1>
              <pre className="text-xs bg-white p-4 rounded border border-rose-200 overflow-auto">{this.state.error?.toString()}</pre>
            </div>
          );
        }
        return this.props.children; 
      }
    }

    // üß± Îã§Ï§ë Î™®Îã¨ Ïª¥Ìè¨ÎÑåÌä∏
    function Modal({ isOpen, onClose, title, children, isNested = false }) {
      if (!isOpen) return null;
      const zIndex = isNested ? "z-[110]" : "z-[100]"; 
      const bgOpacity = isNested ? "bg-slate-900/40" : "bg-slate-900/60";

      return (
        <div className={`fixed inset-0 flex items-center justify-center p-4 ${bgOpacity} ${zIndex}`} onClick={onClose}>
          <div className="bg-white rounded-2xl shadow-2xl w-full max-w-md max-h-[85vh] overflow-hidden flex flex-col modal-enter" onClick={e => e.stopPropagation()}>
            <div className="p-4 border-b border-slate-100 flex justify-between items-center bg-slate-50 shrink-0">
              <h3 className="text-lg font-black text-slate-800 tracking-tight">{title}</h3>
              <button onClick={onClose} className="p-1 hover:bg-slate-200 rounded-lg text-slate-500 font-bold transition">‚úï</button>
            </div>
            <div className="flex-1 overflow-y-auto p-4 bg-slate-50/50 relative">{children}</div>
          </div>
        </div>
      );
    }

    // üó∫Ô∏è Ïú†Í∏∞Ï†Å Ïó∞Îèô: ÌòÑÏû• ÏßÄÎèÑ ÌåùÏóÖ ÏÑ†ÌÉùÍ∏∞
    function MapSelectorModal({ isOpen, onClose, onSelectLocation }) {
      const [area, setArea] = useState('A6/Í∞Ä');
      const [data, setData] = useState([]);
      const [loading, setLoading] = useState(false);

      useEffect(() => {
        if(!isOpen) return;
        const fetchField = async () => {
          setLoading(true);
          try {
            const res = await supabaseClient.from('field_data').select('ÏúÑÏπò_Î≤àÌò∏, Í≥ÑÏïΩ_ÏÉÅÌÉú, ÏÑ±Ìï®').eq('Íµ¨Ïó≠', area);
            setData(res.data || []);
          } catch(e) { console.error(e); }
          setLoading(false);
        };
        fetchField();
      }, [area, isOpen]);

      const renderedGrid = useMemo(() => {
        const layoutData = GLOBAL_LAYOUT_DATA;
        if (!layoutData || !layoutData[area]) return [];
        const dataMap = {};
        data.forEach(item => { if (item.ÏúÑÏπò_Î≤àÌò∏) dataMap[item.ÏúÑÏπò_Î≤àÌò∏] = item; });
        const comp = layoutData[area];
        let finalRows = [];

        if (Array.isArray(comp[0])) finalRows = comp;
        else {
            const flat = [];
            comp.forEach(item => {
                if (typeof item === 'string' && item.startsWith('_')) {
                    const count = parseInt(item.substring(1)) || 1;
                    for(let i=0; i<count; i++) flat.push('SPACER');
                } else flat.push(item);
            });
            const config = ROW_CONFIG[area] || [20];
            let idx = 0;
            config.forEach(cnt => {
                if(idx < flat.length) { finalRows.push(flat.slice(idx, idx + cnt)); idx += cnt; }
            });
        }

        return finalRows.map((rowSlots, rIdx) => ({
            rowNum: rIdx + 1,
            slots: rowSlots.map((slotId, sIdx) => {
                if (!slotId || slotId === 'SPACER' || (typeof slotId === 'string' && slotId.startsWith('_'))) {
                     return { type: 'spacer', id: `spacer-${rIdx}-${sIdx}` };
                }
                return { type: 'data', ...(dataMap[slotId] || { ÏúÑÏπò_Î≤àÌò∏: slotId, Í≥ÑÏïΩ_ÏÉÅÌÉú: 'ÎØ∏Î∂ÑÏñë' }) };
            })
        }));
      }, [data, area]);

      if (!isOpen) return null;

      return (
        <div className="fixed inset-0 flex items-center justify-center p-2 sm:p-4 bg-slate-900/80 z-[120]" onClick={onClose}>
          <div className="bg-white rounded-2xl shadow-2xl w-full max-w-4xl h-[85vh] flex flex-col modal-enter" onClick={e => e.stopPropagation()}>
            <div className="p-4 border-b border-slate-200 flex justify-between items-center bg-slate-800 shrink-0">
              <h3 className="text-lg font-black text-white tracking-tight">üìç ÏßÄÎèÑÏóêÏÑú ÏúÑÏπò ÏÑ†ÌÉù</h3>
              <button onClick={onClose} className="p-1 bg-slate-700 hover:bg-slate-600 rounded-lg text-white font-bold transition">Îã´Í∏∞</button>
            </div>
            
            <div className="flex gap-2 overflow-x-auto p-3 border-b border-slate-200 bg-slate-100 no-scrollbar shrink-0" style={{ WebkitOverflowScrolling: 'touch' }}>
              {SECTION_LIST.map(s => (
                <button key={s} onClick={() => setArea(s)} className={`flex-none px-4 py-2 rounded-lg font-bold text-[13px] whitespace-nowrap transition-all border border-slate-300 ${area === s ? 'bg-blue-600 text-white border-blue-600 shadow-md' : 'bg-white text-slate-600 hover:bg-slate-50'}`}>
                  {s}
                </button>
              ))}
            </div>

            <div className="flex-1 overflow-auto bg-[#F8FAFC] p-4 relative">
              {loading ? (
                <div className="flex h-full items-center justify-center font-black text-slate-400">Îç∞Ïù¥ÌÑ∞Î•º Î∂àÎü¨Ïò§Îäî Ï§ë...</div>
              ) : (
                <div className="min-w-max pb-10 pr-10 mx-auto">
                  {renderedGrid.map((row, rIdx) => (
                    <div key={rIdx} className="map-row">
                      {row.slots.map((s) => {
                        if (s.type === 'spacer') return <div key={s.id} className="map-slot slot-spacer"></div>;
                        const st = clean(s.Í≥ÑÏïΩ_ÏÉÅÌÉú) || 'ÎØ∏Î∂ÑÏñë';
                        const cols = { 'ÏïàÏπò':'bg-emerald-700 text-white opacity-40', 'ÏòàÏïΩ':'bg-amber-300 text-amber-900', 'ÌôÄÎî©':'bg-rose-600 text-white', 'ÎØ∏Î∂ÑÏñë':'bg-white text-slate-600 hover:bg-blue-50 border-blue-300 shadow-md hover:-translate-y-1' };
                        return (
                          <div key={s.id || s.ÏúÑÏπò_Î≤àÌò∏} onClick={() => onSelectLocation(`${area}/${s.ÏúÑÏπò_Î≤àÌò∏}`)} className={`map-slot ${cols[st] || cols['ÎØ∏Î∂ÑÏñë']}`}>
                            <div className="slot-id">{s.ÏúÑÏπò_Î≤àÌò∏}</div>
                            <div className="slot-name">{st === 'ÎØ∏Î∂ÑÏñë' ? 'ÌÅ¥Î¶≠ÌïòÏó¨ ÏÑ†ÌÉù' : (clean(s.ÏÑ±Ìï®) || st)}</div>
                          </div>
                        );
                      })}
                    </div>
                  ))}
                </div>
              )}
            </div>
            <div className="p-3 bg-slate-100 text-center text-xs font-bold text-slate-500 shrink-0">
              ÏïàÏπòÌïòÎ†§Îäî ÏúÑÏπòÏùò Î∞ïÏä§Î•º ÌÅ¥Î¶≠ÌïòÎ©¥ ÏûêÎèôÏúºÎ°ú ÌÖçÏä§Ìä∏Í∞Ä ÏûÖÎ†•Îê©ÎãàÎã§.
            </div>
          </div>
        </div>
      );
    }

    // üìä ÌÜµÌï© ÎåÄÏãúÎ≥¥Îìú
    function DashboardView() {
      const [loading, setLoading] = useState(true);
      const [events, setEvents] = useState([]);
      const [currentDate, setCurrentDate] = useState(new Date());
      
      const [dailyModal, setDailyModal] = useState({ isOpen: false, dateStr: '', events: [] });
      const [undecidedModalOpen, setUndecidedModalOpen] = useState(false);
      
      const [salesModal, setSalesModal] = useState({ isOpen: false, data: null });
      const [schModal, setSchModal] = useState({ isOpen: false, data: null });

      // Ïú†Í∏∞Ï†Å Îßµ Ïó∞Îèô Ïä§ÌÖåÏù¥Ìä∏
      const [mapSelectorOpen, setMapSelectorOpen] = useState(false);
      const [selectedLocBase, setSelectedLocBase] = useState('');
      const [gwangjung, setGwangjung] = useState('');

      useEffect(() => {
        const fetchAll = async () => {
          setLoading(true);
          try {
            const [burRes, salRes] = await Promise.all([
              supabaseClient.from('burial_schedule').select('*'),
              supabaseClient.from('status_mgmt').select('*')
            ]);
            const bEvs = (burRes.data || []).map(b => ({ id: b.id, type:'burial', date:normalizeDate(b.ÏïàÏπòÏùº), title:clean(b.Í≥†Ïù∏Î™Ö), sub:clean(b.ÏúÑÏπò), raw:b }));
            const sEvs = (salRes.data || []).map(s => {
              const custName = clean(s['Í≥†Í∞ù(Í≥†Ïù∏)Î™Ö'] || s.Í≥†Í∞ù_Í≥†Ïù∏_Î™Ö || s.Í≥†Í∞ùÍ≥†Ïù∏Î™Ö || 'Ïù¥Î¶ÑÏóÜÏùå');
              return { id: s.id, type:'sales', date:normalizeDate(s.ÎãµÏÇ¨Ïùº)||normalizeDate(s.Îì±Î°ùÏùº), title:custName, sub:`${clean(s.ÏòÅÏóÖÏûêÏÇ¨Î™Ö)}/${clean(s.ÏòÅÏóÖÏûêÏÑ±Ìï®)}`, status:s.ÌòÑÏû¨ÏÉÅÌÉú, raw:s };
            });
            setEvents([...bEvs, ...sEvs].filter(e => e.date !== null));
          } catch (e) { console.error(e); } finally { setLoading(false); }
        };
        fetchAll();
      }, []);

      const calendarDays = useMemo(() => {
        const year = currentDate.getFullYear(), month = currentDate.getMonth();
        const startDay = new Date(year, month, 1).getDay(), offset = startDay === 0 ? 6 : startDay - 1;
        const lastDate = new Date(year, month + 1, 0).getDate();
        const days = [];
        for (let i = 0; i < offset; i++) days.push(null);
        for (let i = 1; i <= lastDate; i++) {
          const ds = `${year}-${String(month + 1).padStart(2, '0')}-${String(i).padStart(2, '0')}`;
          days.push({ day: i, dateStr: ds, dayEvents: events.filter(e => e.date === ds && e.status !== 'ÏÉÅÎã¥ ÌõÑ ÎåÄÍ∏∞') });
        }
        return days;
      }, [currentDate, events]);

      const headlineStats = useMemo(() => {
        const targetDate = dailyModal.isOpen ? dailyModal.dateStr : getTodayStr();
        const todaysEvents = events.filter(e => e.date === targetDate);
        const burials = todaysEvents.filter(e => e.type === 'burial').length;
        const sales = todaysEvents.filter(e => e.type === 'sales' && (e.status === 'ÎãµÏÇ¨ÎåÄÍ∏∞' || e.status === 'ÎãµÏÇ¨ÏôÑÎ£å')).length;
        return { targetDate, burials, sales, hr: 0 };
      }, [events, dailyModal.isOpen, dailyModal.dateStr]);

      const undecidedList = useMemo(() => {
        return events.filter(e => e.type === 'sales' && e.status !== 'ÏïàÏπòÌôïÏ†ï' && e.status !== 'Ï∑®ÏÜå');
      }, [events]);

      const handleCellClick = (dateStr, dayEvents) => {
        setDailyModal({ isOpen: true, dateStr, events: dayEvents });
      };

      return (
        <div className="space-y-4 max-w-7xl mx-auto h-full flex flex-col relative">
          <div className="bg-slate-800 rounded-2xl p-4 shadow-lg text-white flex justify-between items-center shrink-0">
            <div>
              <p className="text-xs font-bold text-slate-400 mb-1">
                {headlineStats.targetDate === getTodayStr() ? 'TODAY SUMMARY' : `SUMMARY: ${headlineStats.targetDate}`}
              </p>
              <div className="flex gap-4">
                <div className="flex items-end gap-1"><span className="text-2xl font-black text-emerald-400">{headlineStats.burials}</span><span className="text-sm font-bold text-slate-300 pb-1">ÏïàÏπò</span></div>
                <div className="flex items-end gap-1"><span className="text-2xl font-black text-amber-400">{headlineStats.sales}</span><span className="text-sm font-bold text-slate-300 pb-1">ÎãµÏÇ¨</span></div>
                <div className="flex items-end gap-1"><span className="text-2xl font-black text-blue-400">{headlineStats.hr}</span><span className="text-sm font-bold text-slate-300 pb-1">Ìú¥Î¨¥</span></div>
              </div>
            </div>
            <div className="hidden sm:block text-right">
              <p className="text-[10px] font-bold text-slate-400 uppercase tracking-widest">Jake WorkOS</p>
              <p className="text-sm font-black text-emerald-400">DATABASE ACTIVE</p>
            </div>
          </div>

          <div className="bg-white rounded-2xl shadow border border-slate-200 flex flex-col h-full overflow-hidden">
            <div className="p-4 border-b border-slate-100 flex justify-between items-center shrink-0">
              <div className="flex items-center space-x-4">
                <button onClick={() => setCurrentDate(new Date(currentDate.getFullYear(), currentDate.getMonth()-1, 1))} className="px-3 py-1 bg-slate-100 hover:bg-slate-200 transition rounded-lg font-bold">‚óÄ</button>
                <h2 className="text-xl font-black">{currentDate.getFullYear()}ÎÖÑ {currentDate.getMonth()+1}Ïõî</h2>
                <button onClick={() => setCurrentDate(new Date(currentDate.getFullYear(), currentDate.getMonth()+1, 1))} className="px-3 py-1 bg-slate-100 hover:bg-slate-200 transition rounded-lg font-bold">‚ñ∂</button>
              </div>
            </div>
            
            <div className="px-4 pt-4 shrink-0">
              <button onClick={() => setUndecidedModalOpen(true)} className="w-full bg-orange-50 hover:bg-orange-100 transition text-orange-600 border border-orange-200 font-black py-3 rounded-xl shadow-sm flex justify-between px-4">
                  <span>üìç ÏòÅÏóÖ ÎåÄÍ∏∞ Î∞è ÏÑ†Ï†ê Î™ÖÎã® ÌôïÏù∏</span>
                  <span className="bg-orange-600 text-white px-2 py-0.5 rounded-lg">{undecidedList.length}Í±¥</span>
              </button>
            </div>

            <div className="flex-1 overflow-auto bg-white p-2 md:p-4">
              <div className="min-w-[700px] h-full flex flex-col border border-slate-200 rounded-xl shadow-sm bg-slate-200 gap-px">
                <div className="grid grid-cols-7 gap-px shrink-0">
                  {['Ïõî','Ìôî','Ïàò','Î™©','Í∏à','ÌÜ†','Ïùº'].map((d,i)=>(<div key={d} className={`py-2 text-center text-sm font-black bg-white ${i===6?'text-red-500':i===5?'text-blue-500':'text-slate-700'}`}>{d}</div>))}
                </div>
                <div className="grid grid-cols-7 gap-px flex-1">
                  {calendarDays.map((d,i)=>(
                    <div key={i} onClick={()=>d && handleCellClick(d.dateStr, d.dayEvents)} className={`calendar-cell flex flex-col ${!d?'bg-slate-50 cursor-default':''}`}>
                      {d && (
                        <>
                          <div className={`text-right text-xs font-bold p-1 ${getTodayStr() === d.dateStr ? 'text-white bg-blue-600 inline-block self-end rounded-md px-2' : 'text-slate-500'}`}>{d.day}</div>
                          <div className="space-y-1 overflow-y-auto no-scrollbar pb-1">
                            {d.dayEvents.map((ev,idx)=>{
                              const isCancel = ev.status === 'Ï∑®ÏÜå';
                              const isDone = ev.status === 'ÎãµÏÇ¨ÏôÑÎ£å' || ev.status === 'ÏïàÏπòÌôïÏ†ï';
                              let st = ev.type === 'burial' ? 'bg-emerald-600 text-white' : (isCancel ? 'bg-slate-200 text-slate-500 line-through' : isDone ? 'bg-blue-100 text-blue-800' : 'bg-amber-300 text-amber-900');
                              return <div key={idx} className={`px-1.5 py-0.5 rounded text-[10px] font-bold truncate shadow-sm ${st}`}>{ev.title}</div>
                            })}
                          </div>
                        </>
                      )}
                    </div>
                  ))}
                </div>
              </div>
            </div>
          </div>

          <Modal isOpen={dailyModal.isOpen} onClose={()=>setDailyModal({...dailyModal, isOpen:false})} title={`üìÖ ${dailyModal.dateStr} ÏùºÏ†ï`}>
            {dailyModal.events.length === 0 ? <div className="text-center p-8 text-slate-400 font-bold">Îì±Î°ùÎêú ÏùºÏ†ïÏù¥ ÏóÜÏäµÎãàÎã§.</div> : (
              <div className="space-y-2">
                {dailyModal.events.map((ev, idx) => {
                  const isCancel = ev.status === 'Ï∑®ÏÜå';
                  const isDone = ev.status === 'ÎãµÏÇ¨ÏôÑÎ£å' || ev.status === 'ÏïàÏπòÌôïÏ†ï';
                  if (ev.type === 'sales') {
                    const bg = isCancel ? "bg-slate-100 text-slate-500" : (isDone ? "bg-blue-50 border-blue-200" : "bg-yellow-50 border-amber-300 hover:bg-yellow-100");
                    return (
                      <div key={idx} onClick={() => { setDailyModal({...dailyModal, isOpen:false}); setSalesModal({isOpen:true, data:ev}); }} className={`p-3 rounded-xl border cursor-pointer transition shadow-sm ${bg}`}>
                        <div className="font-black text-[13px] mb-1" style={{textDecoration: isCancel ? "line-through" : "none"}}>üü° [ÏòÅÏóÖ] {ev.sub} - {ev.title} <span className="float-right text-[11px] bg-white/50 px-1.5 rounded">{ev.status}</span></div>
                        <div className="text-[11px] font-bold opacity-70 whitespace-pre-wrap">{clean(ev.raw.ÎπÑÍ≥†Î©îÎ™®) || 'Î©îÎ™® ÏóÜÏùå'}</div>
                      </div>
                    );
                  } else {
                    return (
                      <div key={idx} onClick={() => { 
                          setDailyModal({...dailyModal, isOpen:false}); 
                          setSchModal({isOpen:true, data:ev}); 
                          // ÏúÑÏπò Îç∞Ïù¥ÌÑ∞ ÌååÏã±: B5/Í∞Ä/5-24[2] -> base: B5/Í∞Ä/5-24, gwangjung: 2
                          const locMatch = clean(ev.raw.ÏúÑÏπò).match(/^(.*?)\[(\d+)\]$/);
                          if(locMatch) { setSelectedLocBase(locMatch[1]); setGwangjung(locMatch[2]); }
                          else { setSelectedLocBase(clean(ev.raw.ÏúÑÏπò)); setGwangjung(''); }
                        }} className="p-3 rounded-xl border border-emerald-700 bg-emerald-600 text-white cursor-pointer hover:bg-emerald-700 transition shadow-sm">
                        <div className="font-black text-[13px] mb-1">üü¢ [ÏïàÏπò] {ev.title} <span className="float-right text-[11px] bg-black/20 px-1.5 rounded">{ev.sub}</span></div>
                        <div className="text-[11px] font-medium opacity-90 whitespace-pre-wrap">{clean(ev.raw.ÎπÑÍ≥†) || 'ÌäπÏù¥ÏÇ¨Ìï≠ ÏóÜÏùå'}</div>
                      </div>
                    );
                  }
                })}
              </div>
            )}
            <div className="mt-4 flex gap-2">
                <button onClick={() => { setDailyModal({...dailyModal, isOpen:false}); setSalesModal({isOpen:true, data:null}); }} className="flex-1 py-3 bg-amber-50 text-amber-700 border border-amber-200 font-bold rounded-xl text-sm shadow-sm hover:bg-amber-100 transition">+ ÏòÅÏóÖ Îì±Î°ù</button>
                <button onClick={() => { setDailyModal({...dailyModal, isOpen:false}); setSelectedLocBase(''); setGwangjung(''); setSchModal({isOpen:true, data:null}); }} className="flex-1 py-3 bg-emerald-50 text-emerald-700 border border-emerald-200 font-bold rounded-xl text-sm shadow-sm hover:bg-emerald-100 transition">+ ÏïàÏπò Îì±Î°ù</button>
            </div>
          </Modal>

          <Modal isOpen={undecidedModalOpen} onClose={()=>setUndecidedModalOpen(false)} title="üìç ÏòÅÏóÖ ÎåÄÍ∏∞ Î∞è ÏÑ†Ï†ê Î™ÖÎã®">
              <div className="space-y-2 max-h-[60vh] overflow-y-auto no-scrollbar">
                  {undecidedList.map(ev => (
                      <div key={ev.id} onClick={() => { setUndecidedModalOpen(false); setSalesModal({isOpen:true, data:ev}); }} className="p-3 bg-white border border-orange-200 rounded-xl cursor-pointer hover:bg-orange-50 shadow-sm transition">
                          <div className="flex justify-between items-center mb-1.5">
                              <span className="font-black text-[14px] text-slate-800">{ev.title} <span className="text-slate-500 font-bold text-[12px]">({ev.sub})</span></span>
                              <span className="text-[10px] font-black text-orange-600 bg-orange-100 px-2 py-0.5 rounded">{ev.status}</span>
                          </div>
                          <div className="text-[12px] font-bold text-blue-600 mb-1">üìû {ev.raw?.Ïó∞ÎùΩÏ≤ò || 'Ïó∞ÎùΩÏ≤ò ÏóÜÏùå'}</div>
                          <div className="text-[11px] text-slate-500 font-bold">‚è∞ Ï∞ú Îì±Î°ù: {normalizeDate(ev.raw?.Îì±Î°ùÏùº) || '-'}</div>
                      </div>
                  ))}
                  {undecidedList.length === 0 && <div className="text-center p-5 text-slate-400 font-bold">ÎåÄÍ∏∞ Ï§ëÏù∏ ÏÑ†Ï†ê Í±¥Ïù¥ ÏóÜÏäµÎãàÎã§.</div>}
              </div>
          </Modal>

          <Modal isOpen={salesModal.isOpen} onClose={()=>setSalesModal({isOpen:false, data:null})} title={salesModal.data ? "üü° ÏòÅÏóÖ ÌòÑÌô© ÏàòÏ†ï" : "üìù ÏòÅÏóÖ ÌòÑÌô© Ïã†Í∑ú Îì±Î°ù"} isNested={true}>
              <div className="space-y-4">
                  <div className="input-group">
                      <label className="form-label">Îì±Î°ù(Ï∞ú) ÏùºÏãú</label>
                      <input type="text" className="form-input bg-yellow-50 border-yellow-300 text-red-600" defaultValue={normalizeDate(salesModal.data?.raw?.Îì±Î°ùÏùº) || ''} placeholder="ÎπÑÏõåÎëêÎ©¥ ÌòÑÏû¨ ÏãúÍ∞Ñ Í∏∞Î°ù" />
                  </div>
                  <div className="input-group">
                      <label className="form-label">ÎãµÏÇ¨ ÏòàÏ†ïÏùº</label>
                      <input type="date" className="form-input" defaultValue={normalizeDate(salesModal.data?.raw?.ÎãµÏÇ¨Ïùº) || (dailyModal.isOpen ? dailyModal.dateStr : '')} />
                  </div>
                  <div className="grid grid-cols-2 gap-3">
                      <div>
                          <label className="form-label">ÏÇ¨Î™Ö (ÏóÖÏ≤¥Î™Ö)</label>
                          <input type="text" className="form-input" defaultValue={clean(salesModal.data?.raw?.ÏòÅÏóÖÏûêÏÇ¨Î™Ö) || ''} placeholder="Ïòà: Í∞úÏù∏" />
                      </div>
                      <div>
                          <label className="form-label">ÏòÅÏóÖÏûê ÏÑ±Ìï®</label>
                          <input type="text" className="form-input" defaultValue={clean(salesModal.data?.raw?.ÏòÅÏóÖÏûêÏÑ±Ìï®) || ''} />
                      </div>
                  </div>
                  <div className="grid grid-cols-2 gap-3">
                      <div>
                          <label className="form-label">Í≥†Í∞ù(Í≥†Ïù∏)Î™Ö</label>
                          <input type="text" className="form-input" defaultValue={salesModal.data?.title || ''} />
                      </div>
                      <div>
                          <label className="form-label">Ïó∞ÎùΩÏ≤ò</label>
                          <input type="text" className="form-input" defaultValue={clean(salesModal.data?.raw?.Ïó∞ÎùΩÏ≤ò) || ''} />
                      </div>
                  </div>
                  <div className="grid grid-cols-2 gap-3">
                      <div>
                          <label className="form-label">Í≥ÑÏïΩÍµ¨Î∂Ñ</label>
                          <select className="form-input" defaultValue={clean(salesModal.data?.raw?.Í≥ÑÏïΩÍµ¨Î∂Ñ) || 'ÏÑ†Î∂ÑÏñë'}>
                              <option value="ÏÑ†Î∂ÑÏñë">ÏÑ†Î∂ÑÏñë</option>
                              <option value="Ïû•Î°ÄÏïàÏπò">Ïû•Î°ÄÏïàÏπò</option>
                          </select>
                      </div>
                      <div>
                          <label className="form-label">ÏßÑÌñâÏÉÅÌÉú</label>
                          <select className="form-input cursor-pointer font-black text-blue-600" defaultValue={clean(salesModal.data?.status) || 'ÏÉÅÎã¥ ÌõÑ ÎåÄÍ∏∞'}>
                              <option value="ÏÉÅÎã¥ ÌõÑ ÎåÄÍ∏∞">ÏÉÅÎã¥ ÌõÑ ÎåÄÍ∏∞</option>
                              <option value="ÎãµÏÇ¨ÎåÄÍ∏∞">ÎãµÏÇ¨ÎåÄÍ∏∞</option>
                              <option value="ÎãµÏÇ¨ÏôÑÎ£å">ÎãµÏÇ¨ÏôÑÎ£å</option>
                              <option value="ÏïàÏπòÌôïÏ†ï" className="text-red-500">ÏïàÏπòÌôïÏ†ï</option>
                              <option value="Ï∑®ÏÜå">Ï∑®ÏÜå</option>
                          </select>
                      </div>
                  </div>
                  <div className="input-group">
                      <label className="form-label text-red-500">üö® ÏïàÏπò ÌôïÏ†ïÏùº (ÏûêÎèô ÏÉùÏÑ±Ïö©)</label>
                      <input type="date" className="form-input border-red-200 bg-red-50" defaultValue={normalizeDate(salesModal.data?.raw?.ÏïàÏπòÌôïÏ†ïÏùº) || ''} />
                  </div>
                  <div className="input-group">
                      <label className="form-label">ÎπÑÍ≥† Î©îÎ™®</label>
                      <textarea className="form-input min-h-[80px]" defaultValue={clean(salesModal.data?.raw?.ÎπÑÍ≥† || salesModal.data?.raw?.ÎπÑÍ≥†Î©îÎ™®)} placeholder="ÌäπÏù¥ÏÇ¨Ìï≠..."></textarea>
                  </div>
                  <div className="flex gap-2 pt-2">
                      {salesModal.data && (
                        <div className="flex flex-1 flex-col gap-1">
                          <button className="py-2 bg-slate-200 text-slate-600 font-bold rounded-lg text-xs hover:bg-slate-300">üö´ Î≥¥Í¥ÄÌï® Ïù¥Îèô</button>
                          <button className="py-2 bg-rose-100 text-rose-600 font-bold rounded-lg text-xs hover:bg-rose-200">üóëÔ∏è ÏòÅÍµ¨ ÏÇ≠Ï†ú</button>
                        </div>
                      )}
                      <button className="flex-[2] py-3 bg-blue-600 text-white font-black rounded-xl text-sm hover:bg-blue-700 transition shadow-lg shadow-blue-500/30">Îç∞Ïù¥ÌÑ∞ Ï†ÄÏû•</button>
                  </div>
              </div>
          </Modal>

          {/* ÏïàÏπò Îì±Î°ù Î™®Îã¨ (ÏßÄÎèÑ ÌåùÏóÖ Ïó∞Îèô Î∞è Í¥ëÏ§ëÎ≤àÌò∏ Ï≤òÎ¶¨) */}
          <Modal isOpen={schModal.isOpen} onClose={()=>setSchModal({isOpen:false, data:null})} title={schModal.data ? "üü¢ ÏïàÏπò ÏùºÏ†ï ÏàòÏ†ï" : "üü¢ ÏïàÏπò ÏùºÏ†ï Îì±Î°ù"} isNested={true}>
              <div className="space-y-4">
                  <div className="grid grid-cols-2 gap-3">
                      <div>
                          <label className="form-label">ÏïàÏπòÏùº</label>
                          <input type="date" className="form-input" defaultValue={normalizeDate(schModal.data?.raw?.ÏïàÏπòÏùº) || (dailyModal.isOpen ? dailyModal.dateStr : '')} />
                      </div>
                      <div>
                          <label className="form-label">Í≥ÑÏïΩÎ≤àÌò∏</label>
                          <input type="text" className="form-input" defaultValue={clean(schModal.data?.raw?.Í≥ÑÏïΩÎ≤àÌò∏) || ''} placeholder="Ïã§Ï†ÅÏö©" />
                      </div>
                  </div>
                  <div className="grid grid-cols-2 gap-3">
                      <div>
                          <label className="form-label">Í≥†Ïù∏Î™Ö</label>
                          <input type="text" className="form-input" defaultValue={clean(schModal.data?.raw?.Í≥†Ïù∏Î™Ö) || ''} />
                      </div>
                      <div>
                          <label className="form-label">Í≥ÑÏïΩÏûê</label>
                          <input type="text" className="form-input" defaultValue={clean(schModal.data?.raw?.Í≥ÑÏïΩÏûê) || ''} />
                      </div>
                  </div>
                  
                  {/* ‚úÖ ÏßÄÎèÑ Ïó∞Îèô + Í¥ëÏ§ëÎ≤àÌò∏ Î∂ÑÎ¶¨ Ìèº */}
                  <div className="input-group">
                      <label className="form-label text-blue-600">ÏúÑÏπòÏ†ïÎ≥¥ (ÏßÄÎèÑ Í∞ïÏ†ú Ïó∞Îèô)</label>
                      <div className="flex gap-2">
                        <input type="text" className="form-input bg-slate-200 text-slate-500 cursor-not-allowed flex-[2] text-xs sm:text-sm" readOnly value={selectedLocBase} placeholder="ÏßÄÎèÑ Î≤ÑÌäºÏùÑ ÎàÑÎ•¥ÏÑ∏Ïöî" />
                        <div className="relative flex-[1]">
                           <input type="number" className="form-input pr-5 text-center text-xs sm:text-sm" placeholder="Í¥ëÏ§ë" value={gwangjung} onChange={e => setGwangjung(e.target.value)} />
                           <span className="absolute right-2 top-1/2 -translate-y-1/2 font-black text-slate-400 text-xs">Î≤à</span>
                        </div>
                        <button onClick={() => setMapSelectorOpen(true)} className="px-3 bg-slate-800 text-white rounded-lg font-bold text-xs whitespace-nowrap shadow-md hover:bg-slate-700">ÏßÄÎèÑÏÑ†ÌÉù</button>
                      </div>
                  </div>

                  <div className="input-group">
                      <label className="form-label">ÎπÑÍ≥†</label>
                      <textarea className="form-input min-h-[80px]" defaultValue={clean(schModal.data?.raw?.ÎπÑÍ≥†)} placeholder="ÌäπÏù¥ÏÇ¨Ìï≠..."></textarea>
                  </div>
                  
                  <div className="bg-emerald-50 p-3 rounded-lg border border-emerald-200">
                     <p className="text-[10px] font-black text-emerald-800">üí° [Ï†ÄÏû• Ïãú ÏûêÎèô ÎèôÍ∏∞Ìôî Íµ¨Ï°∞ Ï§ÄÎπÑ ÏôÑÎ£å]</p>
                     <p className="text-[11px] font-bold text-emerald-700 mt-1">Ï†ÄÏû• Ïãú '{selectedLocBase}{gwangjung ? `[${gwangjung}]` : ''}' ÏΩîÎìúÎ°ú ÌòÑÏû• ÏßÄÎèÑ DBÏóê ÏïàÏ†ÑÌïòÍ≤å Ìï©ÏÇ¨ Ï≤òÎ¶¨Îê©ÎãàÎã§.</p>
                  </div>

                  <div className="flex gap-2 pt-2">
                      {schModal.data && (
                        <div className="flex flex-1 flex-col gap-1">
                          <button className="py-2 bg-slate-200 text-slate-600 font-bold rounded-lg text-xs hover:bg-slate-300">üö´ Î≥¥Í¥ÄÌï® Ïù¥Îèô</button>
                          <button className="py-2 bg-rose-100 text-rose-600 font-bold rounded-lg text-xs hover:bg-rose-200">üóëÔ∏è ÏòÅÍµ¨ ÏÇ≠Ï†ú</button>
                        </div>
                      )}
                      <button className="flex-[2] py-3 bg-emerald-600 text-white font-black rounded-xl text-sm hover:bg-emerald-700 transition shadow-lg shadow-emerald-500/30">ÏùºÏ†ï Ï†ÄÏû•</button>
                  </div>
              </div>
          </Modal>

          <MapSelectorModal 
             isOpen={mapSelectorOpen} 
             onClose={() => setMapSelectorOpen(false)} 
             onSelectLocation={(loc) => { setSelectedLocBase(loc); setMapSelectorOpen(false); }} 
          />

        </div>
      );
    }

    // üîç View: Field Map
    function FieldView() {
      const [loading, setLoading] = useState(true);
      const [data, setData] = useState([]);
      const [area, setArea] = useState('A2/Í∞Ä');
      const [slotModal, setSlotModal] = useState({ isOpen: false, data: null });

      useEffect(() => {
        const fetchField = async () => {
          setLoading(true);
          try {
            const res = await supabaseClient.from('field_data').select('*').eq('Íµ¨Ïó≠', area);
            setData(res.data || []);
          } catch(e) { console.error("DB Fetch Error:", e); }
          setLoading(false);
        };
        fetchField();
      }, [area]);

      const renderedGrid = useMemo(() => {
        const layoutData = GLOBAL_LAYOUT_DATA;
        if (!layoutData || !layoutData[area]) return [];
        const dataMap = {};
        data.forEach(item => { if (item.ÏúÑÏπò_Î≤àÌò∏) dataMap[item.ÏúÑÏπò_Î≤àÌò∏] = item; });

        const comp = layoutData[area];
        let finalRows = [];

        if (Array.isArray(comp[0])) {
            finalRows = comp;
        } else {
            const flat = [];
            comp.forEach(item => {
                if (typeof item === 'string' && item.startsWith('_')) {
                    const count = parseInt(item.substring(1)) || 1;
                    for(let i=0; i<count; i++) flat.push('SPACER');
                } else {
                    flat.push(item);
                }
            });
            const config = ROW_CONFIG[area] || [20];
            let idx = 0;
            config.forEach(cnt => {
                if(idx < flat.length) {
                    finalRows.push(flat.slice(idx, idx + cnt));
                    idx += cnt;
                }
            });
        }

        return finalRows.map((rowSlots, rIdx) => ({
            rowNum: rIdx + 1,
            slots: rowSlots.map((slotId, sIdx) => {
                if (!slotId || slotId === 'SPACER' || (typeof slotId === 'string' && slotId.startsWith('_'))) {
                     return { type: 'spacer', id: `spacer-${rIdx}-${sIdx}` };
                }
                return { type: 'data', ...(dataMap[slotId] || { ÏúÑÏπò_Î≤àÌò∏: slotId, Íµ¨Ïó≠: area, Í≥ÑÏïΩ_ÏÉÅÌÉú: 'ÎØ∏Î∂ÑÏñë' }) };
            })
        }));
      }, [data, area]);

      return (
        <div className="space-y-4 max-w-7xl mx-auto flex flex-col h-[calc(100vh-100px)] overflow-hidden">
          <div className="flex gap-2 overflow-x-auto pb-2 border-b border-slate-200 px-2 w-full no-scrollbar shrink-0" style={{ WebkitOverflowScrolling: 'touch' }}>
            {SECTION_LIST.map(s => (
              <button key={s} onClick={() => setArea(s)} className={`flex-none px-4 py-2.5 rounded-t-xl font-bold text-[13px] whitespace-nowrap transition-all border-t border-l border-r ${area === s ? 'bg-white text-blue-600 border-slate-200 translate-y-[1px] shadow-[0_-2px_4px_rgba(0,0,0,0.02)]' : 'bg-slate-100 text-slate-500 border-transparent hover:bg-slate-200'}`}>
                {s}
              </button>
            ))}
          </div>

          <div className="bg-white p-4 md:p-8 rounded-b-2xl rounded-tr-2xl shadow-xl border border-slate-200 overflow-auto flex-1 relative w-full">
            {loading ? (
              <div className="flex h-full items-center justify-center font-black text-slate-300 animate-pulse tracking-widest text-lg">MAP SYNCING...</div>
            ) : (
              <div className="min-w-max pb-20 pr-20">
                {renderedGrid.map((row, rIdx) => (
                  <div key={rIdx} className="map-row">
                    {row.slots.map((s) => {
                      if (s.type === 'spacer') return <div key={s.id} className="map-slot slot-spacer"></div>;
                      const st = clean(s.Í≥ÑÏïΩ_ÏÉÅÌÉú) || 'ÎØ∏Î∂ÑÏñë';
                      const cols = { 'ÏïàÏπò':'bg-emerald-700 text-white border-emerald-800', 'ÏòàÏïΩ':'bg-amber-300 text-amber-900 border-amber-400', 'ÌôÄÎî©':'bg-rose-600 text-white border-rose-800', 'ÎØ∏Î∂ÑÏñë':'bg-white text-slate-400 border-slate-300' };
                      return (
                        <div key={s.id || s.ÏúÑÏπò_Î≤àÌò∏} onClick={()=>setSlotModal({isOpen:true, data:s})} className={`map-slot ${cols[st] || cols['ÎØ∏Î∂ÑÏñë']}`}>
                          <div className={`slot-id ${st==='ÎØ∏Î∂ÑÏñë'?'opacity-50':''}`}>{s.ÏúÑÏπò_Î≤àÌò∏}</div>
                          <div className={`slot-name ${st==='ÎØ∏Î∂ÑÏñë'?'opacity-30':''}`}>{clean(s.ÏÑ±Ìï®) || clean(s.Í≥ÑÏïΩÏûê) || 'EMPTY'}</div>
                        </div>
                      );
                    })}
                  </div>
                ))}
              </div>
            )}
          </div>

          <Modal isOpen={slotModal.isOpen} onClose={()=>setSlotModal({...slotModal, isOpen:false})} title={`üìç ${slotModal.data?.Íµ¨Ïó≠} ${slotModal.data?.ÏúÑÏπò_Î≤àÌò∏}`}>
            {slotModal.data && (
              <div className="space-y-4">
                <div className="flex justify-between items-center bg-slate-100 p-4 rounded-xl border border-slate-200 shadow-inner">
                  <div className="flex-1 pr-4 border-r border-slate-300">
                    <label className="form-label">ÏïàÏπòÏûê (ÏÑ±Ìï®)</label>
                    <input type="text" className="form-input bg-white text-lg font-black" defaultValue={clean(slotModal.data.ÏÑ±Ìï®)} placeholder="Ïù¥Î¶Ñ ÏûÖÎ†•" />
                  </div>
                  <div className="pl-4 w-32">
                    <label className="form-label">ÌòÑÏû¨ ÏÉÅÌÉú</label>
                    <select className="form-input bg-white text-blue-600 font-black cursor-pointer" defaultValue={clean(slotModal.data.Í≥ÑÏïΩ_ÏÉÅÌÉú) || 'ÎØ∏Î∂ÑÏñë'}>
                      <option value="ÎØ∏Î∂ÑÏñë">ÎØ∏Î∂ÑÏñë</option>
                      <option value="ÏòàÏïΩ">ÏòàÏïΩ</option>
                      <option value="ÌôÄÎî©">ÌôÄÎî©</option>
                      <option value="ÏïàÏπò">ÏïàÏπò</option>
                    </select>
                  </div>
                </div>
                
                <div className="grid grid-cols-2 gap-3">
                  <div>
                    <label className="form-label">Í≥ÑÏïΩÏûê</label>
                    <input type="text" className="form-input" defaultValue={clean(slotModal.data.Í≥ÑÏïΩÏûê)} />
                  </div>
                  <div>
                    <label className="form-label">Í∏∞Ïàò</label>
                    <div className="relative">
                       <input type="number" className="form-input pr-8" defaultValue={clean(slotModal.data.Í∏∞Ïàò)} />
                       <span className="absolute right-3 top-1/2 -translate-y-1/2 font-black text-slate-400">Í∏∞</span>
                    </div>
                  </div>
                </div>

                <div className="grid grid-cols-2 gap-3">
                  <div>
                    <label className="form-label text-amber-600">Î∂ÑÏñëÍ∞Ä</label>
                    <input type="text" className="form-input bg-amber-50 border-amber-200 text-amber-700" defaultValue={formatMoney(slotModal.data.Í∞ÄÍ≤©)} />
                  </div>
                  <div>
                    <label className="form-label text-amber-600">Í¥ÄÎ¶¨ÎπÑ (Ïó∞)</label>
                    <input type="text" className="form-input bg-amber-50 border-amber-200 text-amber-700" defaultValue={formatMoney(slotModal.data.Í¥ÄÎ¶¨ÎπÑ)} />
                  </div>
                </div>

                <div>
                  <label className="form-label">ÎπÑÍ≥† (ÌòÑÏû• Î©îÎ™®)</label>
                  <textarea className="form-input min-h-[80px]" defaultValue={clean(slotModal.data.Î©îÎ™®)} placeholder="ÌäπÏù¥ÏÇ¨Ìï≠ Í∏∞Î°ù..."></textarea>
                </div>

                <div className="pt-2">
                    <button className="w-full py-3 bg-blue-600 text-white font-black rounded-xl text-sm hover:bg-blue-700 transition shadow-lg shadow-blue-500/30">
                        ÏßÄÎèÑ Îç∞Ïù¥ÌÑ∞ ÏàòÏ†ï (DB Î∞òÏòÅ)
                    </button>
                </div>
              </div>
            )}
          </Modal>
        </div>
      );
    }

    function App() {
      const [activeTab, setActiveTab] = useState('dash');
      const [isSidebarOpen, setIsSidebarOpen] = useState(window.innerWidth > 1024);

      useEffect(() => {
        const handleResize = () => {
          if (window.innerWidth > 1024) setIsSidebarOpen(true);
          else setIsSidebarOpen(false);
        };
        window.addEventListener('resize', handleResize);
        return () => window.removeEventListener('resize', handleResize);
      }, []);

      return (
        <div className="flex h-screen overflow-hidden bg-slate-900">
          {isSidebarOpen && <div className="fixed inset-0 bg-black/60 z-40 lg:hidden backdrop-blur-sm transition-opacity" onClick={() => setIsSidebarOpen(false)} />}
          
          <aside className={`fixed inset-y-0 left-0 z-50 w-64 bg-slate-900 border-r border-slate-800 text-slate-300 transform transition-transform duration-300 ease-in-out lg:static lg:translate-x-0 ${isSidebarOpen ? 'translate-x-0' : '-translate-x-full lg:hidden'} flex flex-col shadow-2xl lg:shadow-none`}>
            <div className="p-6 border-b border-slate-800 flex justify-between items-center shrink-0">
              <h1 className="text-xl font-black text-white tracking-tighter">JAKE WorkOS <span className="text-[10px] bg-emerald-500 px-1.5 py-0.5 rounded ml-1 text-slate-900">V24</span></h1>
              <button className="lg:hidden text-slate-400 hover:text-white transition font-bold" onClick={() => setIsSidebarOpen(false)}>‚úï</button>
            </div>
            <nav className="p-4 space-y-8 overflow-y-auto flex-1 no-scrollbar">
              <div>
                <p className="text-[10px] font-black text-slate-500 mb-3 ml-2 uppercase tracking-widest">Team Workspace</p>
                <div className="space-y-1">
                  <button onClick={() => {setActiveTab('dash'); if(window.innerWidth<1024)setIsSidebarOpen(false);}} className={`w-full flex items-center px-4 py-3 rounded-xl font-bold text-sm transition-all ${activeTab === 'dash' ? 'bg-blue-600 text-white shadow-lg shadow-blue-900/50' : 'hover:bg-slate-800'}`}>üìä ÌÜµÌï© ÏùºÏ†ï Í¥ÄÎ¶¨</button>
                  <button onClick={() => {setActiveTab('field'); if(window.innerWidth<1024)setIsSidebarOpen(false);}} className={`w-full flex items-center px-4 py-3 rounded-xl font-bold text-sm transition-all ${activeTab === 'field' ? 'bg-blue-600 text-white shadow-lg shadow-blue-900/50' : 'hover:bg-slate-800'}`}>üìç ÌòÑÏû• ÏßÄÎèÑ (Map)</button>
                  <button className="w-full flex items-center px-4 py-3 rounded-xl font-bold text-sm text-slate-600 cursor-not-allowed">üèñÔ∏è Í∑ºÌÉú Í¥ÄÎ¶¨</button>
                </div>
              </div>
            </nav>
          </aside>

          <main className="flex-1 flex flex-col h-screen overflow-hidden bg-[#F8FAFC]">
            <header className="h-14 bg-white border-b border-slate-200 flex items-center px-4 justify-between shrink-0 z-10 shadow-sm">
              <div className="flex items-center">
                <button className="p-2 text-slate-500 hover:bg-slate-100 transition rounded-lg mr-3" onClick={() => setIsSidebarOpen(!isSidebarOpen)}>
                  <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
                </button>
                <h2 className="font-black text-lg text-slate-800 tracking-tight">{activeTab === 'dash' ? 'Integrated Dashboard' : 'Field Control Map'}</h2>
              </div>
            </header>
            <div className="flex-1 overflow-hidden p-2 md:p-4">
              {activeTab === 'dash' && <DashboardView />}
              {activeTab === 'field' && <FieldView />}
            </div>
          </main>
        </div>
      );
    }

    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(
      <ErrorBoundary>
        <App />
      </ErrorBoundary>
    );
  </script>
</body>
</html>
