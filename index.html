<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>Jake WorkOS V26 - Full Sync & HR & Charts</title>
  
  <script src="https://unpkg.com/react@18/umd/react.production.min.js" crossorigin></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js" crossorigin></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.0.0"></script>

  <style>
    @import url('https://cdn.jsdelivr.net/gh/orioncactus/pretendard@v1.3.9/dist/web/static/pretendard.min.css');
    body { font-family: 'Pretendard', sans-serif; background-color: #f1f5f9; color: #1e293b; -webkit-font-smoothing: antialiased; overflow: hidden; }
    
    ::-webkit-scrollbar { width: 8px; height: 8px; }
    ::-webkit-scrollbar-track { background: #f8fafc; border-radius: 4px; }
    ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 4px; border: 2px solid #f8fafc; }
    ::-webkit-scrollbar-thumb:hover { background: #94a3b8; }
    .no-scrollbar::-webkit-scrollbar { display: none; }
    .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
    
    .calendar-grid { display: grid; grid-template-columns: repeat(7, 1fr); gap: 1px; background-color: #e2e8f0; border: 1px solid #e2e8f0; }
    .calendar-cell { min-height: 110px; background-color: #fff; padding: 4px; cursor: pointer; transition: background-color 0.2s; position: relative; }
    .calendar-cell:hover { background-color: #f8fafc; }
    .calendar-cell:active { background-color: #f1f5f9; }
    
    .modal-enter { animation: fadeIn 0.2s cubic-bezier(0.16, 1, 0.3, 1); }
    @keyframes fadeIn { from { opacity: 0; transform: scale(0.98); } to { opacity: 1; transform: scale(1); } }

    .map-row { display: flex; flex-direction: row; justify-content: flex-start; gap: 4px; margin-bottom: 4px; width: max-content; }
    .map-slot { width: 85px; min-width: 85px; height: 70px; border-radius: 4px; border: 1px solid #cbd5e1; display: flex; flex-direction: column; justify-content: center; align-items: center; cursor: pointer; transition: transform 0.1s; }
    .map-slot:active { opacity: 0.7; transform: scale(0.95); }
    .slot-spacer { visibility: hidden; pointer-events: none; border: none; background: transparent; } 
    .slot-id { font-size: 10px; font-weight: 800; margin-bottom: 2px; }
    .slot-name { font-size: 11px; font-weight: 800; text-align: center; width: 100%; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; padding: 0 2px; letter-spacing: -0.5px; }

    .form-input { width: 100%; padding: 10px 12px; border: 1px solid #cbd5e1; border-radius: 8px; font-size: 14px; font-weight: bold; color: #1e293b; outline: none; transition: border-color 0.2s; background-color: #f8fafc; }
    .form-input:focus { border-color: #3b82f6; box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1); background-color: #ffffff; }
    .form-label { display: block; font-size: 11px; font-weight: 900; color: #64748b; margin-bottom: 4px; text-transform: uppercase; letter-spacing: 0.5px; }
  </style>

  <script>
    // JSON Î†àÏù¥ÏïÑÏõÉ Îç∞Ïù¥ÌÑ∞ Ïö∞Ìöå (ÌïòÏñÄ ÌôîÎ©¥ Ï†àÎåÄ Î∞©ÏßÄ)
    window.JAKE_MAP_RAW_JSON = `{"A2/Í∞Ä":["1-12","1-11","1-10","1-9","1-8","1-7","1-6","1-5","1-4","1-3","1-2","1-1"],"A3/Í∞Ä":["1-7","1-6","1-5","1-4","1-3-2","1-3-1","1-2","1-1","2-7","2-6","2-5","2-4","2-3","2-2","2-1","2-1A"],"A4/Í∞Ä":["_6","1-6","1-5","1-4","1-3","1-2","1-1","_9","2-1","_2","3-12","3-11","3-10","3-9","3-8","3-7","3-6","3-5","3-4","3-3","3-2","3-1","4-12","4-11","4-10","4-9","4-8","4-7","4-6","4-5","4-4","4-3","4-2","4-1","5-12-2","5-12-1","5-11-2","5-11-1","5-10-2","5-10-1","5-9-2","5-9-1","5-8-2","5-8-1","5-7-2","5-7-1","5-6","5-5","5-4","5-3","5-2","5-1","5-12-4","5-12-3","5-11-4","5-11-3","5-10-4","5-10-3","5-9-4","5-9-3","5-8-4","5-8-3","5-7-4","5-7-3","_6","5-12-8","5-12-7","5-12-6","5-12-5","5-11-8","5-11-7","5-11-6","5-11-5","5-10-8","5-10-7","5-10-6","5-10-5","5-9-8","5-9-7","5-9-6","5-9-5","5-8-8","5-8-7","5-8-6","5-8-5","_8","6-5","6-4","6-3","6-2","6-1","_7"],"A4/ÎÇò":["1-9","1-8","1-7","1-6","1-5","1-4","1-3","1-2","1-1","2-11","2-10","2-9","2-8","2-7","2-6","2-5","2-4","2-3","2-2","2-1","3-7","3-6","3-5","3-4","3-3","3-2","3-1","4-8","4-7","4-6","4-5","4-4","4-3","4-2","4-1","5-8","5-7","5-6","5-5","5-4","5-3","5-2","5-1"],"A4/Îã§":["4-6","4-5","4-4","4-3","4-2","4-1","5-6","5-5","5-4","5-3","5-2","5-1"],"A5/Í∞Ä":["1-13","1-12","1-11","1-10","1-9","1-8","1-7","1-6","1-5","1-4","1-3","1-2","1-1","2-14","2-13","2-12","2-11","2-10","2-9","2-8","2-7","2-6","2-5","2-4","2-3","2-2","2-1","3-14","3-13","3-12","3-11","3-10","3-9","3-8","3-7","3-6","3-5","3-4","3-3","3-2","3-1","4-13","4-12","4-11","4-10","4-9","4-8","4-7","4-6","4-5","4-4","4-3","4-2","4-1","5-13","5-12","5-11","5-10","5-9","5-8","5-7","5-6","5-5","5-4","5-3","5-2","5-1","6-11","6-10","6-9","6-8","6-7","6-6","6-5","6-4","6-3","6-2","6-1C","6-1B","6-1A","6-0","6-1M","8-8","8-7","8-6","8-5","8-4","8-3","8-2","8-1","8-1C","8-1B","8-1A"],"A5/ÎÇò":["_9","1-14","1-13","1-12","1-11","1-10","1-9","1-8","1-7","1-6","1-5","1-4","1-3","1-2","1-1","2-22","2-21","2-20","2-19","2-18","2-17","2-16","2-15","2-14","2-13","2-12","2-11","2-10","2-9","2-8","2-7","2-6","2-5","2-4","2-3","2-2","2-1","3-26","3-25","3-24","3-23","3-22","3-21","3-20","3-19","3-18","3-17","3-16","3-15","3-14","3-13","3-12","3-11","3-10","3-9","3-8","3-7","3-6","3-5","3-4","3-3","3-2","3-1","4-25","4-24","4-23","4-22","4-21","4-20","4-19","4-18","4-17","4-16","4-15","4-14","4-13","4-12","4-11","4-10","4-9","4-8","4-7","4-6","4-5","4-4","4-3","4-2","4-1","5-29","5-28","5-27","5-26","5-25","5-24","5-23","5-22","5-21","5-20","5-19","5-18","5-17","5-16","5-15","5-14","5-13","5-12","5-11","5-10","5-9","5-8","5-7A","5-7","5-6","5-5","5-4","5-3","5-2","5-1","6-47","6-46","6-45","6-44","6-43","6-42","6-41","6-40","6-39","6-38","6-37","6-36","6-35","6-34","6-33","6-32","6-31","6-30","6-29-1","6-28-1","6-27-1","6-26-1","6-25-1","6-24-1","6-23-1","6-22-1","6-21-1","6-20-1","6-19-1","6-18-1","6-17-1","6-16-1","6-15-1","6-14-1","6-13-1","6-12-1","6-11-1","6-10-1","6-9-1","6-8-1","6-7-1","6-6-1","6-5-1","6-4-1","6-3-1","6-2-1","6-1-1","_18","6-29-2","6-28-2","6-27-2","6-26-2","6-25-2","6-24-2","6-23-2","6-22-2","6-21-2","6-20-2","6-19-2","6-18-2","6-17-2","6-16-2","6-15-2","6-14-2","6-13-2","6-12-2","6-11-2","6-10-2","6-9-2","6-8-2","6-7-2","6-6-2","6-5-2","6-4-2","6-3-2","6-2-2","6-1-2","_18","6-29-3","6-28-3","6-27-3","6-26-3","6-25-3","6-24-3","6-23-3","6-22-3","6-21-3","6-20-3","6-19-3","6-18-3","_17","7-9","7-8","7-7","7-6","7-5","7-4","7-3","7-2","7-1","_30"],"A6/Í∞Ä":["1-23","1-22","1-21","1-20","1-19","1-18","1-17","1-16-2","1-16-1","1-15","1-14-2","1-14-1","1-13","1-12","1-11","1-10","1-9-2","1-9-1","1-8","1-7","1-6","1-5-2","1-5-1","1-4","1-3","1-2","1-1","2-22","2-21","2-20","2-19-2","2-19-1","2-18","2-17-2","2-17-1","2-16","2-15","2-14","2-13","2-12","2-11","2-10","2-9","2-8-2","2-8-1","2-7","2-6-2","2-6-1","2-5","2-4","2-3","2-2","2-1-2","2-1-1","_2","3-19-2","3-19-1","3-18","3-17","3-16","3-15","3-14","3-13","3-12","3-11","3-10","3-9","3-8","3-7","3-6","3-5","3-4","3-3","3-2","3-1","4-18","4-17","4-16","4-15","4-14","4-13","4-12","4-11","4-10","4-9","4-8","4-7","4-6","4-5","4-4","4-3","4-2","4-1","5-18","5-17","5-16","5-15","5-14","5-13","5-12","5-11","5-10","5-9","5-8","5-7","5-6","5-5-2","5-5-1","5-4","5-3","5-2","5-1","6-15","6-14","6-13","6-12","6-11","6-10","6-9","6-8","6-7","6-6","6-5","6-4","6-3","6-2","6-1","7-13","7-12","7-11","7-10","7-9","7-8","7-7","7-6","7-5","7-4","7-3","7-2","7-1"],"A6/ÎÇò":["1-25","1-24","1-23","1-22","1-21","1-20","1-19","1-18","1-17","1-16","1-15","1-14","1-13","1-12","1-11","1-10","1-9","1-8","1-7","1-6","1-5","1-4","1-3","1-2","1-1","2-26","2-25","2-24","2-23","2-22","2-21","2-20","2-19","2-18","2-17","2-16","2-15","2-14","2-13","2-12","2-11","2-10","2-9","2-8","2-7","2-6","2-5","2-4","2-3","2-2","2-1","3-26","3-25","3-24","3-23","3-22","3-21","3-20","3-19","3-18","3-17","3-16","3-15","3-14","3-13","3-12","3-11","3-10","3-9","3-8","3-7","3-6","3-5","3-4","3-3","3-2","3-1","4-26","4-25","4-24","4-23","4-22","4-21","4-20","4-19","4-18","4-17","4-16","4-15","4-14","4-13","4-12","4-11","4-10","4-9","4-8","4-7","4-6","4-5","4-4","4-3","4-2","4-1","5-14","5-13","5-12-1","5-12-2","5-11-1","5-11-2","5-10-1","5-10-2","5-9-1","5-9-2","5-8-1","5-8-2","5-7-1","5-7-2","5-6-1","5-6-2","5-5-1","5-5-2","5-4-1","5-4-2","5-3-1","5-3-2","5-2-1","5-2-2","5-1-1","5-1-2","_4","5-11-3","5-11-4","5-10-3","5-10-4","5-9-3","5-9-4","5-8-3","5-8-4","5-7-3","5-7-4","5-6-3","_1","5-5-3","5-5-4","5-4-3","5-4-4","5-3-3","5-3-4","5-2-3","5-2-4","5-1-3","5-1-4"],"C1/Í∞Ä":["1-13","1-12","1-11","1-10","1-9","1-8","1-7","1-6","1-5","1-4","1-3","1-2","1-1","2-17","2-16","2-15","2-14","2-13","2-12","2-11","2-10","2-9","2-8","2-7","2-6","2-5","2-4","2-3","2-2","2-1","3-21","3-20","3-19","3-18","3-17","3-16","3-15","3-14","3-13","3-12","3-11","3-10","3-9","3-8","3-7","3-6","3-5","3-4","3-3","3-2","3-1","4-25","4-24","4-23","4-22","4-21","4-20","4-19","4-18","4-17","4-16","4-15","4-14","4-13","4-12","4-11","4-10","4-9","4-8","4-7","4-6","4-5","4-4","4-3","4-2","4-1"],"B1/Í∞Ä":["1-20","1-19","1-18","1-17","1-16","1-15","1-14","1-13","1-12","1-11","1-10","1-9","1-8","1-7","1-6","1-5","1-4","1-3","1-2","1-1","2-23","2-22","2-21","2-20","2-19","2-18","2-17","2-16","2-15","2-14","2-13","2-12","2-11","2-10","2-9","2-8","2-7","2-6","2-5","2-4","2-3","2-2","2-1"],"B2/Í∞Ä":["1-5","1-4","1-3","1-2","1-1","_29","2-4","2-3","2-2","2-1","_30","3-35","3-34","3-33","3-32","3-31","3-30","3-29","3-28","3-27","3-26","3-25","3-24","3-23","3-22","3-21","3-20","3-19","3-18","3-17","3-16","3-15","3-14","3-13","3-12","3-11","3-10","3-9","3-8","3-7","3-6","3-5","3-4","3-3","3-2","3-1","4-34","4-33","4-32","4-31","4-30","4-29","4-28","4-27","4-26","4-25","4-24","4-23","4-22","4-21","4-20","4-19","4-18","4-17","4-16","4-15","4-14","4-13","4-12","4-11","4-10","4-9","4-8","4-7","4-6","4-5","4-4","4-3","4-2","4-1","5-34","5-33","5-32","5-31","5-30","5-29","5-28","5-27","5-26","5-25","5-24","5-23","5-22","5-21","5-20","5-19","5-18","5-17","5-16","5-15","5-14","5-13","5-12","5-11","5-10","5-9","5-8","5-7","5-6","5-5","5-4","5-3","5-2","5-1"],"B3/Í∞Ä":["1-48","1-47","1-46","1-45","1-44","1-43","1-42","1-41","1-40","1-39","1-38","1-37","1-36","1-35","1-34","1-33","1-32","1-31","1-30","1-29","1-28","1-27","1-26","1-25","1-24","1-23","1-22","1-21","1-20","1-19","1-18","1-17","1-16","1-15","1-14","1-13","1-12","1-11","1-10","1-9","1-8","1-7","1-6","1-5","1-4","1-3","1-2","1-1","2-46","2-45","2-44","2-43","2-42","2-41","2-40","2-39","2-38","2-37","2-36","2-35","2-34","2-33","2-32","2-31","2-30","2-29","2-28","2-27","2-26","2-25","2-24","2-23","2-22","2-21","2-20","2-19","2-18","2-17","2-16","2-15","2-14","2-13","2-12","2-11","2-10","2-9","2-8","2-7","2-6","2-5","2-4","2-3","2-2","2-1","3-45","3-44","3-43","3-42","3-41","3-40","3-39","3-38","3-37","3-36","3-35","3-34","3-33","3-32","3-31","3-30","3-29","3-28","3-27","3-26","3-25","3-24","3-23","3-22","3-21","3-20","3-19","3-18","3-17","3-16","3-15","3-14","3-13","3-12","3-11","3-10","3-9","3-8","3-7","3-6","3-5","3-4","3-3","3-2","3-1","4-41","4-40","4-39","4-38","4-37","4-36","4-35","4-34","4-33","4-32","4-31","4-30","4-29","4-28","4-27","4-26","4-25","4-24","4-23","4-22","4-21","4-20","4-19","4-18","4-17","4-16","4-15","4-14","4-13","4-12","4-11","4-10","4-9","4-8","4-7","4-6","4-5","4-4","4-3","4-2","4-1"],"B4/Í∞Ä":["1-37","1-36","1-35","1-34","1-33","1-32","1-31","1-30","1-29","1-28","1-27","1-26","1-25","1-24","1-23","1-22","1-21","1-20","1-19","1-18","1-17","1-16","1-15","1-14","1-13","1-12","1-11","1-10","1-9","1-8","1-7","1-6","1-5","1-4","1-3","1-2","1-1","2-38","2-37","2-36","2-35","2-34","2-33","2-32","2-31","2-30","2-29","2-28","2-27","2-26","2-25","2-24","2-23","2-22","2-21","2-20","2-19","2-18","2-17","2-16","2-15","2-14","2-13","2-12","2-11","2-10","2-9","2-8","2-7","2-6","2-5","2-4","2-3","2-2","2-1","3-41","3-40","3-39","3-38","3-37","3-36","3-35","3-34","3-33","3-32","3-31","3-30","3-29","3-28","3-27","3-26","3-25","3-24","3-23","3-22","3-21","3-20","3-19","3-18","3-17","3-16","3-15","3-14","3-13","3-12","3-11","3-10","3-9","3-8","3-7","3-6","3-5","3-4","3-3","3-2","3-1","4-41","4-40","4-39","4-38","4-37","4-36","4-35","4-34","4-33","4-32","4-31","4-30","4-29","4-28","4-27","4-26","4-25","4-24","4-23","4-22","4-21","4-20","4-19","4-18","4-17","4-16","4-15","4-14","4-13","4-12","4-11","4-10","4-9","4-8","4-7","4-6","4-5","4-4","4-3","4-2","4-1","5-34","5-33","5-32","5-31","5-30","5-29","5-28","5-27","5-26","5-25","5-24","5-23","5-22","5-21","5-20","5-19","5-18","5-17","5-16","5-15","5-14","5-13","5-12","5-11","5-10","5-9","5-8","5-7","5-6","5-5","5-4","5-3","5-2","5-1"],"B5/Í∞Ä":["1-47","1-46","1-45","1-44","1-43","1-42","1-41","1-40","1-39","1-38","1-37","1-36","1-35","1-34","1-33","1-32","1-31","1-30","1-29","1-28","1-27","1-26","1-25","1-24","1-23","1-22","1-21","1-20","1-19","1-18","1-17","1-16","1-15","1-14","1-13","1-12","1-11","1-10","1-9","1-8","1-7","1-6","1-5","1-4","1-3","1-2","1-1","2-47","2-46","2-45","2-44","2-43","2-42","2-41","2-40","2-39","2-38","2-37","2-36","2-35","2-34","2-33","2-32","2-31","2-30","2-29","2-28","2-27","2-26","2-25","2-24","2-23","2-22","2-21","2-20","2-19","2-18","2-17","2-16","2-15","2-14","2-13","2-12","2-11","2-10","2-9","2-8","2-7","2-6","2-5","2-4","2-3","2-2","2-1","3-49","3-48","3-47","3-46","3-45","3-44","3-43","3-42","3-41","3-40","3-39","3-38","3-37","3-36","3-35","3-34","3-33","3-32","3-31","3-30","3-29","3-28","3-27","3-26","3-25","3-24","3-23","3-22","3-21","3-20","3-19","3-18","3-17","3-16","3-15","3-14","3-13","3-12","3-11","3-10","3-9","3-8","3-7","3-6","3-5","3-4","3-3","3-2","3-1","4-48","4-47","4-46","4-45","4-44","4-43","4-42","4-41","4-40","4-39","4-38","4-37","4-36","4-35","4-34","4-33","4-32","4-31","4-30","4-29","4-28","4-27","4-26","4-25","4-24","4-23","4-22","4-21","4-20","4-19","4-18","4-17","4-16","4-15","4-14","4-13","4-12","4-11","4-10","4-9","4-8","4-7","4-6","4-5","4-4","4-3","4-2","4-1","5-40","5-39","5-38","5-37","5-36","5-35","5-34","5-33","5-32","5-31","5-30","5-29","5-28","5-27","5-26","5-25","5-24","5-23","5-22","5-21","5-20","5-19","5-18","5-17","5-16","5-15","5-14","5-13","5-12","5-11","5-10","5-9","5-8","5-7","5-6","5-5","5-4","5-3","5-2","5-1","6-30","6-29-2","6-29-1","6-28","6-27","6-26","6-25","6-24-2","6-24-1","6-23","6-22","6-21","6-20","6-19","6-18","6-17","6-16","6-15","6-14","6-13","6-12","6-11","6-10","6-9","6-8","6-7","6-6","6-5","6-4","6-3","6-2","6-1"],"B6/Í∞Ä/1-12":["1-47","1-46","1-45","1-44","1-43","1-42","1-41","1-40","1-39","1-38","1-37","1-36","1-35","1-34","1-33","1-32","1-31","1-30","1-29","1-28","1-27","1-26","1-25","1-24","1-23","1-22","1-21","1-20","1-19","1-18","1-17","1-16","1-15","1-14","1-13","1-12","1-11","1-10","1-9","1-8","1-7","1-6","1-5","1-4","1-3","1-2","1-1","2-52","2-51","2-50","2-49","2-48","2-47","2-46","2-45","2-44","2-43","2-42","2-41","2-40","2-39","2-38","2-37","2-36","2-35","2-34","2-33","2-32","2-31","2-30","2-29","2-28","2-27","2-26","2-25","2-24","2-23","2-22","2-21","2-20","2-19","2-18","2-17","2-16","2-15","2-14","2-13","2-12","2-11","2-10","2-9","2-8","2-7","2-6","2-5","2-4","2-3","2-2","2-1","3-53","3-52","3-51","3-50","3-49","3-48","3-47","3-46","3-45","3-44","3-43","3-42","3-41","3-40","3-39","3-38","3-37","3-36","3-35","3-34","3-33","3-32","3-31","3-30","3-29","3-28","3-27","3-26","3-25","3-24","3-23","3-22","3-21","3-20","3-19","3-18","3-17","3-16","3-15","3-14","3-13","3-12","3-11","3-10","3-9","3-8","3-7","3-6","3-5","3-4","3-3","3-2","3-1","4-52","4-51","4-50","4-49","4-48","4-47","4-46","4-45","4-44","4-43","4-42","4-41","4-40","4-39","4-38","4-37","4-36","4-35","4-34","4-33","4-32","4-31","4-30","4-29","4-28","4-27","4-26","4-25","4-24","4-23","4-22","4-21","4-20","4-19","4-18","4-17","4-16","4-15","4-14","4-13","4-12","4-11","4-10","4-9","4-8","4-7","4-6","4-5","4-4","4-3","4-2","4-1","5-53","5-52","5-51","5-50","5-49","5-48","5-47","5-46","5-45","5-44","5-43","5-42","5-41","5-40","5-39","5-38","5-37","5-36","5-35","5-34","5-33","5-32","5-31","5-30","5-29","5-28","5-27","5-26","5-25","5-24","5-23","5-22","5-21","5-20","5-19","5-18","5-17","5-16","5-15","5-14","5-13","5-12","5-11","5-10","5-9","5-8","5-7","5-6","5-5","5-4","5-3","5-2","5-1","6-53","6-52","6-51","6-50","6-49","6-48","6-47","6-46","6-45","6-44","6-43","6-42","6-41","6-40","6-39","6-38","6-37","6-36","6-35","6-34","6-33","6-32","6-31","6-30","6-29","6-28","6-27","6-26","6-25","6-24","6-23","6-22","6-21","6-20","6-19","6-18","6-17","6-16","6-15","6-14","6-13","6-12","6-11","6-10","6-9","6-8","6-7","6-6","6-5","6-4","6-3","6-2","6-1","6-107","6-106","6-105","6-104","6-103","6-102","6-101","6-100","6-99","6-98","6-97","6-96","6-95","6-94","6-93","6-92","6-91","6-90","6-89","6-88","6-87","6-86","6-85","6-84","6-83","6-82","6-81","6-80","6-79","6-78","6-77","6-76","6-75","6-74","6-73","6-72","6-71","6-70","6-69","6-68","6-67","6-66","6-65","6-64","6-63","6-62","6-61","6-60","6-59","6-58","6-57","6-56","6-55","6-54","7-54","7-53","7-52","7-51","7-50","7-49","7-48","7-47","7-46","7-45","7-44","7-43","7-42","7-41","7-40","7-39","7-38","7-37","7-36","7-35","7-34","7-33","7-32","7-31","7-30","7-29","7-28","7-27","7-26","7-25","7-24","7-23","7-22","7-21","7-20","7-19","7-18","7-17","7-16","7-15","7-14","7-13","7-12","7-11","7-10","7-9","7-8","7-7","7-6","7-5","7-4","7-3","7-2","7-1","8-54","8-53","8-52","8-51","8-50","8-49","8-48","8-47","8-46","8-45","8-44","8-43","8-42","8-41","8-40","8-39","8-38","8-37","8-36","8-35","8-34","8-33","8-32","8-31","8-30","8-29","8-28","8-27","8-26","8-25","8-24","8-23","8-22","8-21","8-20","8-19","8-18","8-17","8-16","8-15","8-14","8-13","8-12","8-11","8-10","8-9","8-8","8-7","8-6","8-5","8-4","8-3","8-2","8-1","9-53","9-52","9-51","9-50","9-49","9-48","9-47","9-46","9-45","9-44","9-43","9-42","9-41","9-40","9-39","9-38","9-37","9-36","9-35","9-34","9-33","9-32","9-31","9-30","9-29","9-28","9-27","9-26","9-25","9-24","9-23","9-22","9-21","9-20","9-19","9-18","9-17","9-16","9-15","9-14","9-13","9-12","9-11","9-10","9-9","9-8","9-7","9-6","9-5","9-4","9-3","9-2","9-1","10-55","10-54","10-53","10-52","10-51","10-50","10-49","10-48","10-47","10-46","10-45","10-44","10-43","10-42","10-41","10-40","10-39","10-38","10-37","10-36","10-35","10-34","10-33","10-32","10-31","10-30","10-29","10-28","10-27","10-26","10-25","10-24","10-23","10-22","10-21","10-20","10-19","10-18","10-17","10-16","10-15","10-14","10-13","10-12","10-11","10-10","10-9","10-8","10-7","10-6","10-5","10-4","10-3","10-2","10-1","11-54","11-53","11-52","11-51","11-50","11-49","11-48","11-47","11-46","11-45","11-44","11-43","11-42","11-41","11-40","11-39","11-38","11-37","11-36","11-35","11-34","11-33","11-32","11-31","11-30","11-29","11-28","11-27","11-26","11-25","11-24","11-23","11-22","11-21","11-20","11-19","11-18","11-17","11-16","11-15","11-14","11-13","11-12","11-11","11-10","11-9","11-8","11-7","11-6","11-5","11-4","11-3","11-2","11-1","12-50","12-49","12-48","12-47","12-46","12-45","12-44","12-43","12-42","12-41","12-40","12-39","12-38","12-37","12-36","12-35","12-34","12-33","12-32","12-31","12-30","12-29","12-28","12-27","12-26","12-25","12-24","12-23","12-22","12-21","12-20","12-19","12-18","12-17","12-16","12-15","12-14","12-13","12-12","12-11","12-10","12-9","12-8","12-7","12-6","12-5","12-4","12-3","12-2","12-1"],"B6/Í∞Ä/13-14":["13-38-2","13-38-1","13-37-2","13-37-1","13-36-2","13-36-1","13-35-2","13-35-1","13-34-2","13-34-1","13-33-2","13-33-1","13-32-2","13-32-1","13-31-2","13-31-1","13-30-2","13-30-1","13-29-2","13-29-1","13-28-2","13-28-1","13-27-2","13-27-1","13-26-2","13-26-1","13-25-2","13-25-1","13-24-2","13-24-1","13-23-2","13-23-1","13-22-2","13-22-1","13-21-2","13-21-1","13-20-2","13-20-1","13-19-2","13-19-1","13-18-2","13-18-1","13-17-2","13-17-1","13-16-2","13-16-1","13-15-2","13-15-1","13-14-2","13-14-1","13-13-2","13-13-1","13-12-2","13-12-1","13-11-2","13-11-1","13-10-2","13-10-1","13-9-2","13-9-1","13-8-2","13-8-1","13-7-2","13-7-1","13-6-2","13-6-1","13-5","13-4-2","13-4-1","13-3-2","13-3-1","13-2-2","13-2-1","13-1-2","13-1-1","13-38-4","13-38-3","13-37-4","13-37-3","13-36-4","13-36-3","13-35-4","13-35-3","13-34-4","13-34-3","13-33-4","13-33-3","13-32-4","13-32-3","13-31-4","13-31-3","13-30-4","13-30-3","13-29-4","13-29-3","13-28-4","13-28-3","13-27-4","13-27-3","13-26-4","13-26-3","13-25-4","13-25-3","13-24-4","13-24-3","13-23-4","13-23-3","13-22-4","13-22-3","13-21-4","13-21-3","13-20-4","13-20-3","13-19-4","13-19-3","13-18-4","13-18-3","13-17-4","13-17-3","13-16-4","13-16-3","13-15-4","13-15-3","13-14-4","13-14-3","13-13-4","13-13-3","13-12-4","13-12-3","13-11-4","13-11-3","13-10-4","13-10-3","13-9-4","13-9-3","13-8-4","13-8-3","13-7-4","13-7-3","13-6-4","13-6-3","_9","13-38-6","13-38-5","13-37-6","13-37-5","13-36-6","13-36-5","13-35-6","13-35-5","13-34-6","13-34-5","13-33-6","13-33-5","13-32-6","13-32-5","13-31-6","13-31-5","13-30-6","13-30-5","13-29-6","13-29-5","13-28-6","13-28-5","13-27-6","13-27-5","13-26-6","13-26-5","13-25-6","13-25-5","13-24-6","13-24-5","13-23-6","13-23-5","13-22-6","13-22-5","13-21-6","13-21-5","13-20-6","13-20-5","13-19-6","13-19-5","13-18-6","13-18-5","13-17-6","13-17-5","13-16-6","13-16-5","13-15-6","13-15-5","13-14-6","13-14-5","13-13-6","13-13-5","_23","14-19-2","14-19-1","14-18-2","14-18-1","14-17-2","14-17-1","14-16-2","14-16-1","14-15-2","14-15-1","14-14-2","14-14-1","14-13-2","14-13-1","14-12-2","14-12-1","14-11-2","14-11-1","14-10-2","14-10-1","14-9-2","14-9-1","14-8-2","14-8-1","14-7-2","14-7-1","14-6-2","14-6-1","14-5-2","14-5-1","14-4-2","14-4-1","14-3-2","14-3-1","14-2-2","14-2-1","14-1-2","14-1-1","_37","14-19-5","14-19-4","14-19-3","14-18-4","14-18-3","14-17-4","14-17-3","14-16-4","14-16-3","14-15-4","14-15-3","14-14-4","14-14-3","14-13-4","14-13-3","14-12-4","14-12-3","14-11-4","14-11-3","14-10-4","14-10-3","14-9-4","14-9-3","14-8-4","14-8-3","14-7-4","14-7-3","14-6-4","14-6-3","14-5-4","14-5-3","_44","14-19-8","14-19-7","14-19-6","14-18-6","14-18-5","14-17-6","14-17-5","14-16-6","14-16-5","14-15-6","14-15-5","14-14-6","14-14-5","14-13-6","14-13-5","14-12-6","14-12-5","14-11-6","14-11-5","14-10-6","14-10-5","_54","14-19-11","14-19-10","14-19-9","14-18-8","14-18-7","14-17-8","14-17-7","14-16-8","14-16-7","14-15-8","14-15-7","14-14-8","14-14-7","14-13-8","14-13-7","14-12-8","14-12-7","14-11-7","_57","14-19-14","14-19-13","14-19-12","14-18-10","14-18-9","14-17-10","14-17-9","14-16-10","14-16-9","14-15-10","14-15-9","14-14-10","14-14-9","14-13-10","14-13-9","14-12-9","_59","14-19-17","14-19-16","14-19-15","14-18-12","14-18-11","14-17-12","14-17-11","_68"]}`;
    let GLOBAL_LAYOUT_DATA = {};
    try { GLOBAL_LAYOUT_DATA = JSON.parse(window.JAKE_MAP_RAW_JSON); } 
    catch(e) { console.error("JSON Error"); }
  </script>

  <script type="text/babel">
    const { useState, useEffect, useMemo, useRef } = React;

    const SUPABASE_URL = 'https://lqccxnciiajwqdmpwjdv.supabase.co';
    const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImxxY2N4bmNpaWFqd3FkbXB3amR2Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzE1MjA3MTMsImV4cCI6MjA4NzA5NjcxM30.L23-eq-DIPsbONOeX-xQ8UcMb7gtgTTTRpkaSm9HTw4';
    const supabaseClient = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

    const clean = (val) => (!val || val === '0.0' || val === '0' || val === 'null' || val === ' -  - ' || val === 'SPACER') ? '' : String(val).trim();
    const normalizeDate = (v) => { 
      if(!v) return null; 
      try {
        const s = String(v).replace(/\./g,'-').replace(/\s/g,'').substring(0,10);
        const m = s.match(/^(\d{4})-(\d{1,2})-(\d{1,2})/);
        return m ? `${m[1]}-${m[2].padStart(2, '0')}-${m[3].padStart(2, '0')}` : null;
      } catch(e) { return null; }
    };
    const formatMoney = (val) => {
      try {
        const num = parseInt(String(val).replace(/[^0-9]/g, ''));
        return isNaN(num) ? '0Ïõê' : num.toLocaleString() + 'Ïõê';
      } catch(e) { return '0Ïõê'; }
    };
    const getTodayStr = () => new Date().toISOString().split('T')[0];

    const SECTION_LIST = ['A2/Í∞Ä','A3/Í∞Ä','A4/Í∞Ä','A4/ÎÇò','A4/Îã§','A5/Í∞Ä','A5/ÎÇò','A6/Í∞Ä','A6/ÎÇò','B1/Í∞Ä','B2/Í∞Ä','B3/Í∞Ä','B4/Í∞Ä','B5/Í∞Ä','B6/Í∞Ä/1-12','B6/Í∞Ä/13-14','C1/Í∞Ä'];
    const ROW_CONFIG = { 
      'A2/Í∞Ä':[12], 'A3/Í∞Ä':[8,8], 'A4/Í∞Ä':[12,12,12,12,18,18,28,12], 'A4/ÎÇò':[9,11,7,8,8], 'A4/Îã§':[6,6], 'A5/Í∞Ä':[13,14,14,13,13,15,11], 
      'A5/ÎÇò':[23,22,26,25,30,47,47,30,39], 'A6/Í∞Ä':[27,27,22,18,19,15,13], 'A6/ÎÇò':[25,26,26,26,26,26], 'C1/Í∞Ä':[13,17,21,25], 
      'B1/Í∞Ä':[20,23], 'B2/Í∞Ä':[34,34,35,34,34], 'B3/Í∞Ä':[48,46,45,41], 'B4/Í∞Ä':[37,38,41,41,34], 'B5/Í∞Ä':[47,47,49,48,40,32], 
      'B6/Í∞Ä/1-12':[47,52,53,52,53,53,54,54,54,53,55,54,50], 'B6/Í∞Ä/13-14':[75,75,75,75,75,75,75,75,75] 
    };

    // üë®‚Äçüíº Í∑ºÌÉúÍ¥ÄÎ¶¨ Ï†ÑÏö© ÏÉÅÏàò (Ï†úÍ≥µÌï¥Ï£ºÏã† Í∞ÄÏ§ëÏπò Í∏∞Î∞ò - ÏàòÏ†ï ÌïÑÏöî)
    const EMPLOYEES = ["Ï°∞Í∑úÌÉú ÏÇ¨Î¨¥Ïû•", "Ïù¥Ï§ëÏõê ÌåÄÏû•", "Ïù¥Ïû•Ïàú Í≥ºÏû•", "ÌóàÏÑ±Î∞± Í≥ºÏû•", "Ï†ÑÍ¥ëÏàô Ïã§Ïû•", "Ïù¥Ïû¨Ï†Ñ Í≥ºÏû•", "Î∞ïÏö∞ÏÑù Ï∞®Ïû•"];
    const EMP_COLORS = ["#FF6B6B", "#FF9F43", "#FDCB6E", "#55E6C1", "#4BCFFA", "#5F27CD", "#D980FA"];
    const EMP_WEIGHTS = {
      "Ï°∞Í∑úÌÉú ÏÇ¨Î¨¥Ïû•": { guide: 1, burial: 1 },
      "Ïù¥Ï§ëÏõê ÌåÄÏû•": { guide: 1, burial: 1 },
      "Ïù¥Ïû•Ïàú Í≥ºÏû•": { guide: 0.5, burial: 1 },
      "ÌóàÏÑ±Î∞± Í≥ºÏû•": { guide: 0.5, burial: 1 },
      "Ï†ÑÍ¥ëÏàô Ïã§Ïû•": { guide: 1, burial: 0 },
      "Ïù¥Ïû¨Ï†Ñ Í≥ºÏû•": { guide: 1, burial: 1 },
      "Î∞ïÏö∞ÏÑù Ï∞®Ïû•": { guide: 1, burial: 1 }
    };

    class ErrorBoundary extends React.Component {
      constructor(props) { super(props); this.state = { hasError: false, error: null }; }
      static getDerivedStateFromError(error) { return { hasError: true, error }; }
      render() {
        if (this.state.hasError) {
          return (
            <div className="p-8 m-4 bg-rose-50 border-2 border-rose-500 rounded-xl shadow-lg">
              <h1 className="text-xl font-black text-rose-700 mb-2">üö® V26 Î†åÎçîÎßÅ ÏóêÎü¨</h1>
              <pre className="text-xs bg-white p-4 rounded border border-rose-200 overflow-auto">{this.state.error?.toString()}</pre>
            </div>
          );
        }
        return this.props.children; 
      }
    }

    function Modal({ isOpen, onClose, title, children, isNested = false }) {
      if (!isOpen) return null;
      const zIndex = isNested ? "z-[110]" : "z-[100]"; 
      const bgOpacity = isNested ? "bg-slate-900/50" : "bg-slate-900/70";

      return (
        <div className={`fixed inset-0 flex items-center justify-center p-4 ${bgOpacity} ${zIndex}`} onClick={onClose}>
          <div className="bg-white rounded-2xl shadow-2xl w-full max-w-md max-h-[85vh] overflow-hidden flex flex-col modal-enter" onClick={e => e.stopPropagation()}>
            <div className="p-4 border-b border-slate-100 flex justify-between items-center bg-slate-50 shrink-0">
              <h3 className="text-lg font-black text-slate-800 tracking-tight">{title}</h3>
              <button onClick={onClose} className="p-1 hover:bg-slate-200 rounded-lg text-slate-500 font-bold transition">‚úï</button>
            </div>
            <div className="flex-1 overflow-y-auto p-4 bg-slate-50/50 relative">{children}</div>
          </div>
        </div>
      );
    }

    function MapSelectorModal({ isOpen, onClose, layoutData, onSelectLocation }) {
      const [area, setArea] = useState('A6/Í∞Ä');
      const [data, setData] = useState([]);
      const [loading, setLoading] = useState(false);

      useEffect(() => {
        if(!isOpen) return;
        const fetchField = async () => {
          setLoading(true);
          try {
            const res = await supabaseClient.from('field_data').select('ÏúÑÏπò_Î≤àÌò∏, Í≥ÑÏïΩ_ÏÉÅÌÉú, ÏÑ±Ìï®').eq('Íµ¨Ïó≠', area);
            setData(res.data || []);
          } catch(e) { console.error(e); }
          setLoading(false);
        };
        fetchField();
      }, [area, isOpen]);

      const renderedGrid = useMemo(() => {
        if (!layoutData || !layoutData[area]) return [];
        const dataMap = {};
        data.forEach(item => { if (item.ÏúÑÏπò_Î≤àÌò∏) dataMap[item.ÏúÑÏπò_Î≤àÌò∏] = item; });
        const comp = layoutData[area];
        let finalRows = [];

        if (Array.isArray(comp[0])) finalRows = comp;
        else {
            const flat = [];
            comp.forEach(item => {
                if (typeof item === 'string' && item.startsWith('_')) {
                    const count = parseInt(item.substring(1)) || 1;
                    for(let i=0; i<count; i++) flat.push('SPACER');
                } else flat.push(item);
            });
            const config = ROW_CONFIG[area] || [20];
            let idx = 0;
            config.forEach(cnt => {
                if(idx < flat.length) { finalRows.push(flat.slice(idx, idx + cnt)); idx += cnt; }
            });
        }

        return finalRows.map((rowSlots, rIdx) => ({
            rowNum: rIdx + 1,
            slots: rowSlots.map((slotId, sIdx) => {
                if (!slotId || slotId === 'SPACER' || (typeof slotId === 'string' && slotId.startsWith('_'))) {
                     return { type: 'spacer', id: `spacer-${rIdx}-${sIdx}` };
                }
                return { type: 'data', ...(dataMap[slotId] || { ÏúÑÏπò_Î≤àÌò∏: slotId, Í≥ÑÏïΩ_ÏÉÅÌÉú: 'ÎØ∏Î∂ÑÏñë' }) };
            })
        }));
      }, [data, area, layoutData]);

      if (!isOpen) return null;

      return (
        <div className="fixed inset-0 flex items-center justify-center p-2 sm:p-4 bg-slate-900/80 z-[120]" onClick={onClose}>
          <div className="bg-white rounded-2xl shadow-2xl w-full max-w-4xl h-[85vh] flex flex-col modal-enter" onClick={e => e.stopPropagation()}>
            <div className="p-4 border-b border-slate-200 flex justify-between items-center bg-slate-800 shrink-0">
              <h3 className="text-lg font-black text-white tracking-tight">üìç ÏßÄÎèÑÏóêÏÑú ÏúÑÏπò ÏÑ†ÌÉù</h3>
              <button onClick={onClose} className="p-1 bg-slate-700 hover:bg-slate-600 rounded-lg text-white font-bold transition">Îã´Í∏∞</button>
            </div>
            
            <div className="flex gap-2 overflow-x-auto p-3 border-b border-slate-200 bg-slate-100 no-scrollbar shrink-0" style={{ WebkitOverflowScrolling: 'touch' }}>
              {SECTION_LIST.map(s => (
                <button key={s} onClick={() => setArea(s)} className={`flex-none px-4 py-2 rounded-lg font-bold text-[13px] whitespace-nowrap transition-all border border-slate-300 ${area === s ? 'bg-blue-600 text-white border-blue-600 shadow-md' : 'bg-white text-slate-600 hover:bg-slate-50'}`}>
                  {s}
                </button>
              ))}
            </div>

            <div className="flex-1 overflow-auto bg-[#F8FAFC] p-4 relative">
              {loading ? (
                <div className="flex h-full items-center justify-center font-black text-slate-400">Îç∞Ïù¥ÌÑ∞Î•º Î∂àÎü¨Ïò§Îäî Ï§ë...</div>
              ) : (
                <div className="min-w-max pb-10 pr-10 mx-auto">
                  {renderedGrid.map((row, rIdx) => (
                    <div key={rIdx} className="map-row">
                      {row.slots.map((s) => {
                        if (s.type === 'spacer') return <div key={s.id} className="map-slot slot-spacer"></div>;
                        const st = clean(s.Í≥ÑÏïΩ_ÏÉÅÌÉú) || 'ÎØ∏Î∂ÑÏñë';
                        const cols = { 'ÏïàÏπò':'bg-emerald-700 text-white opacity-40', 'ÏòàÏïΩ':'bg-amber-300 text-amber-900', 'ÌôÄÎî©':'bg-rose-600 text-white', 'ÎØ∏Î∂ÑÏñë':'bg-white text-slate-600 hover:bg-blue-50 border-blue-300 shadow-md hover:-translate-y-1' };
                        return (
                          <div key={s.id || s.ÏúÑÏπò_Î≤àÌò∏} onClick={() => onSelectLocation(`${area}/${s.ÏúÑÏπò_Î≤àÌò∏}`)} className={`map-slot ${cols[st] || cols['ÎØ∏Î∂ÑÏñë']}`}>
                            <div className="slot-id">{s.ÏúÑÏπò_Î≤àÌò∏}</div>
                            <div className="slot-name">{st === 'ÎØ∏Î∂ÑÏñë' ? 'ÏÑ†ÌÉùÍ∞ÄÎä•' : (clean(s.ÏÑ±Ìï®) || st)}</div>
                          </div>
                        );
                      })}
                    </div>
                  ))}
                </div>
              )}
            </div>
          </div>
        </div>
      );
    }

    function DashboardView({ layoutData }) {
      const [loading, setLoading] = useState(true);
      const [events, setEvents] = useState([]);
      const [hrData, setHrData] = useState([]); // Í∑ºÌÉú Ï∞®Ìä∏Ïö©
      const [currentDate, setCurrentDate] = useState(new Date());
      const chartRef = useRef(null);
      const chartInstance = useRef(null);
      
      const [dailyModal, setDailyModal] = useState({ isOpen: false, dateStr: '', events: [] });
      const [undecidedModalOpen, setUndecidedModalOpen] = useState(false);
      const [salesModal, setSalesModal] = useState({ isOpen: false, data: null });
      const [schModal, setSchModal] = useState({ isOpen: false, data: null });
      
      const [mapSelectorOpen, setMapSelectorOpen] = useState(false);
      const [selectedLocBase, setSelectedLocBase] = useState('');
      const [gwangjung, setGwangjung] = useState('');

      const fetchAll = async () => {
        setLoading(true);
        try {
          const [burRes, salRes, hrRes] = await Promise.all([
            supabaseClient.from('burial_schedule').select('*'),
            supabaseClient.from('status_mgmt').select('*'),
            supabaseClient.from('hr_management').select('*')
          ]);
          const bEvs = (burRes.data || []).map(b => ({ id: b.id, type:'burial', date:normalizeDate(b.ÏïàÏπòÏùº), title:clean(b.Í≥†Ïù∏Î™Ö), sub:clean(b.ÏúÑÏπò), raw:b }));
          const sEvs = (salRes.data || []).map(s => {
            const custName = clean(s['Í≥†Í∞ù(Í≥†Ïù∏)Î™Ö'] || s.Í≥†Í∞ù_Í≥†Ïù∏_Î™Ö || s.Í≥†Í∞ùÍ≥†Ïù∏Î™Ö || 'Ïù¥Î¶ÑÏóÜÏùå');
            return { id: s.id, type:'sales', date:normalizeDate(s.ÎãµÏÇ¨Ïùº)||normalizeDate(s.Îì±Î°ùÏùº), title:custName, sub:`${clean(s.ÏòÅÏóÖÏûêÏÇ¨Î™Ö)}/${clean(s.ÏòÅÏóÖÏûêÏÑ±Ìï®)}`, status:s.ÌòÑÏû¨ÏÉÅÌÉú, raw:s, regDate: new Date(normalizeDate(s.Îì±Î°ùÏùº) || 0) };
          });
          setEvents([...bEvs, ...sEvs].filter(e => e.date !== null));
          setHrData(hrRes.data || []);
        } catch (e) { console.error(e); } finally { setLoading(false); }
      };

      useEffect(() => { fetchAll(); }, []);

      // üìà ÏõîÎ≥Ñ ÏïàÏπò ÌòÑÌô© Ï∞®Ìä∏ Í∑∏Î¶¨Í∏∞ (16Í∞úÏõî)
      useEffect(() => {
        if (!chartRef.current || events.length === 0) return;
        
        let labels = []; 
        let dataCounts = [];
        
        for (let i = 15; i >= 0; i--) {
            let d = new Date(currentDate.getFullYear(), currentDate.getMonth() - i, 1);
            let y = d.getFullYear(); 
            let m = String(d.getMonth() + 1).padStart(2, '0'); 
            let key = `${y}-${m}`;
            
            // Ìï¥Îãπ ÏõîÏùò ÏïàÏπòÍ±¥Ïàò (Í≥†Ïú† Í≥ÑÏïΩÎ≤àÌò∏ ÌòπÏùÄ id Í∏∞Ï§Ä)
            let uniqueBurials = new Set();
            events.forEach(ev => {
                if (ev.type === 'burial' && ev.date && ev.date.startsWith(key)) {
                    uniqueBurials.add(ev.id); // Í≥†Ïú† IDÎ°ú Ïπ¥Ïö¥Ìä∏
                }
            });
            
            let count = uniqueBurials.size;
            labels.push([`${String(y).substring(2)}-${m}`]); 
            dataCounts.push(count);
        }

        if (chartInstance.current) chartInstance.current.destroy();
        
        const ctx = chartRef.current.getContext('2d');
        chartInstance.current = new Chart(ctx, {
            type: 'bar',
            data: { labels: labels, datasets: [{ data: dataCounts, backgroundColor: '#2E7D32', borderRadius: 4 }] },
            options: {
                responsive: true, maintainAspectRatio: false,
                layout: { padding: { top: 20 } },
                plugins: {
                    legend: { display: false },
                    datalabels: { anchor: 'end', align: 'end', color: '#333', font: { weight: 'bold', size: 10 }, formatter: v => v > 0 ? v : "" }
                },
                scales: {
                    y: { beginAtZero: true, grace: '10%', ticks: { stepSize: 1 } },
                    x: { ticks: { font: { size: 9 } } }
                }
            }
        });
      }, [events, currentDate]);

      const calendarDays = useMemo(() => {
        const year = currentDate.getFullYear(), month = currentDate.getMonth();
        const startDay = new Date(year, month, 1).getDay(), offset = startDay === 0 ? 6 : startDay - 1;
        const lastDate = new Date(year, month + 1, 0).getDate();
        const days = [];
        for (let i = 0; i < offset; i++) days.push(null);
        for (let i = 1; i <= lastDate; i++) {
          const ds = `${year}-${String(month + 1).padStart(2, '0')}-${String(i).padStart(2, '0')}`;
          days.push({ day: i, dateStr: ds, dayEvents: events.filter(e => e.date === ds && e.status !== 'ÏÉÅÎã¥ ÌõÑ ÎåÄÍ∏∞') });
        }
        return days;
      }, [currentDate, events]);

      const headlineStats = useMemo(() => {
        const targetDate = dailyModal.isOpen ? dailyModal.dateStr : getTodayStr();
        const todaysEvents = events.filter(e => e.date === targetDate);
        const burials = todaysEvents.filter(e => e.type === 'burial').length;
        const sales = todaysEvents.filter(e => e.type === 'sales' && (e.status === 'ÎãµÏÇ¨ÎåÄÍ∏∞' || e.status === 'ÎãµÏÇ¨ÏôÑÎ£å')).length;
        
        // Í∑ºÌÉú Ìú¥Î¨¥Ïûê Í≥ÑÏÇ∞ (Ìú¥Î¨¥, Ïó∞Ï∞®, Î≥ëÍ∞Ä=1Î™Ö / Î∞òÏ∞®, Ï°∞Ìá¥=0.5Î™Ö)
        let hrCount = 0;
        hrData.forEach(h => {
            if(h.work_date === targetDate) {
                if(['Ìú¥Î¨¥','Ïó∞Ï∞®','Î≥ëÍ∞Ä'].includes(h.status)) hrCount += 1;
                else if(['Ïò§Ï†ÑÎ∞òÏ∞®','Ïò§ÌõÑÎ∞òÏ∞®','Ï°∞Ìá¥'].includes(h.status)) hrCount += 0.5;
            }
        });
        
        return { targetDate, burials, sales, hr: hrCount };
      }, [events, hrData, dailyModal.isOpen, dailyModal.dateStr]);

      const undecidedList = useMemo(() => {
        let list = events.filter(e => e.type === 'sales' && e.status !== 'ÏïàÏπòÌôïÏ†ï' && e.status !== 'Ï∑®ÏÜå');
        return list.sort((a, b) => b.regDate - a.regDate);
      }, [events]);

      const handleCellClick = (dateStr, dayEvents) => {
        setDailyModal({ isOpen: true, dateStr, events: dayEvents });
      };

      // ‚ö° Îç∞Ïù¥ÌÑ∞Î≤†Ïù¥Ïä§ Ï†ÄÏû• ÏóîÏßÑ (ÏïàÏπòÏùºÏ†ï)
      const saveSchedule = async (e) => {
          e.preventDefault();
          const targetLoc = gwangjung ? `${selectedLocBase}[${gwangjung}]` : selectedLocBase;
          const payload = {
              ÏïàÏπòÏùº: e.target.sch_date.value,
              Í≥ÑÏïΩÎ≤àÌò∏: e.target.sch_no.value,
              Í≥†Ïù∏Î™Ö: e.target.sch_name.value,
              Í≥ÑÏïΩÏûê: e.target.sch_contractor.value,
              ÏúÑÏπò: targetLoc,
              ÎπÑÍ≥†: e.target.sch_note.value
          };
          if(schModal.data?.id) {
              await supabaseClient.from('burial_schedule').update(payload).eq('id', schModal.data.id);
          } else {
              await supabaseClient.from('burial_schedule').insert(payload);
          }
          setSchModal({isOpen:false, data:null});
          fetchAll(); // Îç∞Ïù¥ÌÑ∞ Í∞±Ïã†
      };

      // ‚ö° Îç∞Ïù¥ÌÑ∞Î≤†Ïù¥Ïä§ Ï†ÄÏû• ÏóîÏßÑ (ÏòÅÏóÖÌòÑÌô©)
      const saveSales = async (e) => {
          e.preventDefault();
          const payload = {
              Îì±Î°ùÏùº: e.target.s_regDate.value || new Date().toISOString(),
              ÎãµÏÇ¨Ïùº: e.target.s_visitDate.value,
              ÏòÅÏóÖÏûêÏÇ¨Î™Ö: e.target.s_corp.value,
              ÏòÅÏóÖÏûêÏÑ±Ìï®: e.target.s_staff.value,
              "Í≥†Í∞ù(Í≥†Ïù∏)Î™Ö": e.target.s_customer.value,
              Ïó∞ÎùΩÏ≤ò: e.target.s_phone.value,
              Í≥ÑÏïΩÍµ¨Î∂Ñ: e.target.s_type.value,
              ÌòÑÏû¨ÏÉÅÌÉú: e.target.s_status.value,
              ÏïàÏπòÌôïÏ†ïÏùº: e.target.s_confirmDate.value,
              ÎπÑÍ≥†Î©îÎ™®: e.target.s_memo.value
          };
          if(salesModal.data?.id) {
              await supabaseClient.from('status_mgmt').update(payload).eq('id', salesModal.data.id);
          } else {
              await supabaseClient.from('status_mgmt').insert(payload);
          }
          setSalesModal({isOpen:false, data:null});
          fetchAll();
      };

      return (
        <div className="space-y-4 max-w-7xl mx-auto h-full flex flex-col relative">
          <div className="bg-slate-800 rounded-2xl p-4 shadow-lg text-white flex justify-between items-center shrink-0">
            <div>
              <p className="text-xs font-bold text-slate-400 mb-1">
                {headlineStats.targetDate === getTodayStr() ? 'TODAY SUMMARY' : `SUMMARY: ${headlineStats.targetDate}`}
              </p>
              <div className="flex gap-4">
                <div className="flex items-end gap-1"><span className="text-2xl font-black text-emerald-400">{headlineStats.burials}</span><span className="text-sm font-bold text-slate-300 pb-1">ÏïàÏπò</span></div>
                <div className="flex items-end gap-1"><span className="text-2xl font-black text-amber-400">{headlineStats.sales}</span><span className="text-sm font-bold text-slate-300 pb-1">ÎãµÏÇ¨</span></div>
                <div className="flex items-end gap-1"><span className="text-2xl font-black text-blue-400">{headlineStats.hr}</span><span className="text-sm font-bold text-slate-300 pb-1">Ìú¥Î¨¥</span></div>
              </div>
            </div>
            <div className="hidden sm:block text-right">
              <p className="text-[10px] font-bold text-slate-400 uppercase tracking-widest">Jake WorkOS</p>
              <p className="text-sm font-black text-emerald-400">DATABASE ACTIVE</p>
            </div>
          </div>

          <div className="bg-white rounded-2xl shadow border border-slate-200 flex flex-col h-[60vh] overflow-hidden shrink-0">
            <div className="p-4 border-b border-slate-100 flex justify-between items-center shrink-0 bg-slate-50">
              <div className="flex items-center space-x-4">
                <button onClick={() => setCurrentDate(new Date(currentDate.getFullYear(), currentDate.getMonth()-1, 1))} className="px-3 py-1 bg-white border border-slate-200 hover:bg-slate-100 transition rounded-lg font-bold">‚óÄ</button>
                <h2 className="text-xl font-black text-slate-800">{currentDate.getFullYear()}ÎÖÑ {currentDate.getMonth()+1}Ïõî</h2>
                <button onClick={() => setCurrentDate(new Date(currentDate.getFullYear(), currentDate.getMonth()+1, 1))} className="px-3 py-1 bg-white border border-slate-200 hover:bg-slate-100 transition rounded-lg font-bold">‚ñ∂</button>
              </div>
            </div>
            
            <div className="px-4 pt-4 shrink-0">
              <button onClick={() => setUndecidedModalOpen(true)} className="w-full bg-orange-50 hover:bg-orange-100 transition text-orange-700 border border-orange-200 font-black py-3 rounded-xl shadow-sm flex justify-between px-4">
                  <span>üìç ÏòÅÏóÖ ÎåÄÍ∏∞ Î∞è ÏÑ†Ï†ê Î™ÖÎã® ÌôïÏù∏</span>
                  <span className="bg-orange-500 text-white px-2 py-0.5 rounded-lg">{undecidedList.length}Í±¥</span>
              </button>
            </div>

            <div className="flex-1 overflow-auto bg-white p-2 md:p-4">
              <div className="min-w-[700px] h-full flex flex-col border border-slate-200 rounded-xl shadow-sm bg-slate-200 gap-px">
                <div className="grid grid-cols-7 gap-px shrink-0">
                  {['Ïõî','Ìôî','Ïàò','Î™©','Í∏à','ÌÜ†','Ïùº'].map((d,i)=>(<div key={d} className={`py-2 text-center text-sm font-black bg-white ${i===6?'text-red-500':i===5?'text-blue-500':'text-slate-700'}`}>{d}</div>))}
                </div>
                <div className="grid grid-cols-7 gap-px flex-1">
                  {calendarDays.map((d,i)=>(
                    <div key={i} onClick={()=>d && handleCellClick(d.dateStr, d.dayEvents)} className={`calendar-cell flex flex-col ${!d?'bg-slate-50 cursor-default':''}`}>
                      {d && (
                        <>
                          <div className={`text-right text-xs font-bold p-1 ${getTodayStr() === d.dateStr ? 'text-white bg-blue-600 inline-block self-end rounded-md px-2' : 'text-slate-500'}`}>{d.day}</div>
                          <div className="space-y-1 overflow-y-auto no-scrollbar pb-1">
                            {d.dayEvents.map((ev,idx)=>{
                              const isCancel = ev.status === 'Ï∑®ÏÜå';
                              const isDone = ev.status === 'ÎãµÏÇ¨ÏôÑÎ£å' || ev.status === 'ÏïàÏπòÌôïÏ†ï';
                              let st = ev.type === 'burial' ? 'bg-emerald-600 text-white' : (isCancel ? 'bg-slate-200 text-slate-500 line-through' : isDone ? 'bg-blue-100 text-blue-800' : 'bg-amber-300 text-amber-900');
                              return <div key={idx} className={`px-1.5 py-0.5 rounded text-[10px] font-bold truncate shadow-sm ${st}`}>{ev.title}</div>
                            })}
                          </div>
                        </>
                      )}
                    </div>
                  ))}
                </div>
              </div>
            </div>
          </div>
          
          {/* ÌïòÎã® 16Í∞úÏõî ÏïàÏπò ÌÜµÍ≥Ñ Ï∞®Ìä∏ ÏòÅÏó≠ */}
          <div className="bg-white rounded-2xl shadow border border-slate-200 p-4 shrink-0">
              <h3 className="text-center font-black text-slate-800 text-sm mb-2">üìà ÏõîÎ≥Ñ ÏïàÏπò ÌòÑÌô© (ÏµúÍ∑º 16Í∞úÏõî)</h3>
              <div className="w-full h-[200px] relative">
                  <canvas ref={chartRef}></canvas>
              </div>
          </div>

          {/* Î™®Îã¨ ÏãúÏä§ÌÖúÎì§ */}
          <Modal isOpen={dailyModal.isOpen} onClose={()=>setDailyModal({...dailyModal, isOpen:false})} title={`üìÖ ${dailyModal.dateStr} ÏùºÏ†ï`}>
            {dailyModal.events.length === 0 ? <div className="text-center p-8 text-slate-400 font-bold">Îì±Î°ùÎêú ÏùºÏ†ïÏù¥ ÏóÜÏäµÎãàÎã§.</div> : (
              <div className="space-y-2">
                {dailyModal.events.map((ev, idx) => {
                  const isCancel = ev.status === 'Ï∑®ÏÜå';
                  const isDone = ev.status === 'ÎãµÏÇ¨ÏôÑÎ£å' || ev.status === 'ÏïàÏπòÌôïÏ†ï';
                  if (ev.type === 'sales') {
                    const bg = isCancel ? "bg-slate-100 text-slate-500" : (isDone ? "bg-blue-50 border-blue-200" : "bg-yellow-50 border-amber-300 hover:bg-yellow-100");
                    return (
                      <div key={idx} onClick={() => { setDailyModal({...dailyModal, isOpen:false}); setSalesModal({isOpen:true, data:ev}); }} className={`p-3 rounded-xl border cursor-pointer transition shadow-sm ${bg}`}>
                        <div className="font-black text-[13px] mb-1" style={{textDecoration: isCancel ? "line-through" : "none"}}>üü° [ÏòÅÏóÖ] {ev.sub} - {ev.title} <span className="float-right text-[11px] bg-white/50 px-1.5 rounded">{ev.status}</span></div>
                        <div className="text-[11px] font-bold opacity-70 whitespace-pre-wrap">{clean(ev.raw.ÎπÑÍ≥†Î©îÎ™®) || 'Î©îÎ™® ÏóÜÏùå'}</div>
                      </div>
                    );
                  } else {
                    return (
                      <div key={idx} onClick={() => { 
                          setDailyModal({...dailyModal, isOpen:false}); 
                          setSchModal({isOpen:true, data:ev}); 
                          const locMatch = clean(ev.raw.ÏúÑÏπò).match(/^(.*?)\[(\d+)\]$/);
                          if(locMatch) { setSelectedLocBase(locMatch[1]); setGwangjung(locMatch[2]); }
                          else { setSelectedLocBase(clean(ev.raw.ÏúÑÏπò)); setGwangjung(''); }
                        }} className="p-3 rounded-xl border border-emerald-700 bg-emerald-600 text-white cursor-pointer hover:bg-emerald-700 transition shadow-sm">
                        <div className="font-black text-[13px] mb-1">üü¢ [ÏïàÏπò] {ev.title} <span className="float-right text-[11px] bg-black/20 px-1.5 rounded">{ev.sub}</span></div>
                        <div className="text-[11px] font-medium opacity-90 whitespace-pre-wrap">{clean(ev.raw.ÎπÑÍ≥†) || 'ÌäπÏù¥ÏÇ¨Ìï≠ ÏóÜÏùå'}</div>
                      </div>
                    );
                  }
                })}
              </div>
            )}
            <div className="mt-4 flex gap-2">
                <button onClick={() => { setDailyModal({...dailyModal, isOpen:false}); setSalesModal({isOpen:true, data:null}); }} className="flex-1 py-3 bg-amber-50 text-amber-700 border border-amber-200 font-bold rounded-xl text-sm shadow-sm hover:bg-amber-100 transition">+ ÏòÅÏóÖ Îì±Î°ù</button>
                <button onClick={() => { setDailyModal({...dailyModal, isOpen:false}); setSelectedLocBase(''); setGwangjung(''); setSchModal({isOpen:true, data:null}); }} className="flex-1 py-3 bg-emerald-50 text-emerald-700 border border-emerald-200 font-bold rounded-xl text-sm shadow-sm hover:bg-emerald-100 transition">+ ÏïàÏπò Îì±Î°ù</button>
            </div>
          </Modal>

          <Modal isOpen={undecidedModalOpen} onClose={()=>setUndecidedModalOpen(false)} title="üìç ÏòÅÏóÖ ÎåÄÍ∏∞ Î∞è ÏÑ†Ï†ê Î™ÖÎã®">
              <div className="space-y-2 max-h-[60vh] overflow-y-auto no-scrollbar">
                  {undecidedList.map(ev => (
                      <div key={ev.id} onClick={() => { setUndecidedModalOpen(false); setSalesModal({isOpen:true, data:ev}); }} className="p-3 bg-white border border-orange-200 rounded-xl cursor-pointer hover:bg-orange-50 shadow-sm transition">
                          <div className="flex justify-between items-center mb-1.5">
                              <span className="font-black text-[14px] text-slate-800">{ev.title} <span className="text-slate-500 font-bold text-[12px]">({ev.sub})</span></span>
                              <span className="text-[10px] font-black text-orange-600 bg-orange-100 px-2 py-0.5 rounded">{ev.status}</span>
                          </div>
                          <div className="text-[12px] font-bold text-blue-600 mb-1">üìû {ev.raw?.Ïó∞ÎùΩÏ≤ò || 'Ïó∞ÎùΩÏ≤ò ÏóÜÏùå'}</div>
                          <div className="text-[11px] text-slate-500 font-bold">‚è∞ Ï∞ú Îì±Î°ù: {normalizeDate(ev.raw?.Îì±Î°ùÏùº) || '-'}</div>
                      </div>
                  ))}
              </div>
          </Modal>

          <Modal isOpen={salesModal.isOpen} onClose={()=>setSalesModal({isOpen:false, data:null})} title={salesModal.data ? "üü° ÏòÅÏóÖ ÌòÑÌô© ÏàòÏ†ï" : "üìù ÏòÅÏóÖ ÌòÑÌô© Ïã†Í∑ú Îì±Î°ù"} isNested={true}>
              <form onSubmit={saveSales} className="space-y-4">
                  <div className="input-group">
                      <label className="form-label">Îì±Î°ù ÏùºÏãú</label>
                      <input name="s_regDate" type="text" className="form-input bg-yellow-50 text-red-600" defaultValue={normalizeDate(salesModal.data?.raw?.Îì±Î°ùÏùº) || ''} placeholder="ÎπàÏπ∏ Ïãú ÌòÑÏû¨ÏãúÍ∞Ñ Ï†ÄÏû•" />
                  </div>
                  <div className="input-group">
                      <label className="form-label">ÎãµÏÇ¨ ÏòàÏ†ïÏùº</label>
                      <input name="s_visitDate" type="date" className="form-input" defaultValue={normalizeDate(salesModal.data?.raw?.ÎãµÏÇ¨Ïùº) || (dailyModal.isOpen ? dailyModal.dateStr : '')} />
                  </div>
                  <div className="grid grid-cols-2 gap-3">
                      <div><label className="form-label">ÏÇ¨Î™Ö</label><input name="s_corp" type="text" className="form-input" defaultValue={clean(salesModal.data?.raw?.ÏòÅÏóÖÏûêÏÇ¨Î™Ö) || ''} required /></div>
                      <div><label className="form-label">ÏòÅÏóÖÏûê</label><input name="s_staff" type="text" className="form-input" defaultValue={clean(salesModal.data?.raw?.ÏòÅÏóÖÏûêÏÑ±Ìï®) || ''} required /></div>
                  </div>
                  <div className="grid grid-cols-2 gap-3">
                      <div><label className="form-label">Í≥†Í∞ùÎ™Ö</label><input name="s_customer" type="text" className="form-input" defaultValue={salesModal.data?.title || ''} required /></div>
                      <div><label className="form-label">Ïó∞ÎùΩÏ≤ò</label><input name="s_phone" type="text" className="form-input" defaultValue={clean(salesModal.data?.raw?.Ïó∞ÎùΩÏ≤ò) || ''} /></div>
                  </div>
                  <div className="grid grid-cols-2 gap-3">
                      <div>
                          <label className="form-label">Íµ¨Î∂Ñ</label>
                          <select name="s_type" className="form-input" defaultValue={clean(salesModal.data?.raw?.Í≥ÑÏïΩÍµ¨Î∂Ñ) || 'ÏÑ†Î∂ÑÏñë'}><option>ÏÑ†Î∂ÑÏñë</option><option>Ïû•Î°ÄÏïàÏπò</option></select>
                      </div>
                      <div>
                          <label className="form-label">ÏÉÅÌÉú</label>
                          <select name="s_status" className="form-input text-blue-600" defaultValue={clean(salesModal.data?.status) || 'ÏÉÅÎã¥ ÌõÑ ÎåÄÍ∏∞'}>
                              <option>ÏÉÅÎã¥ ÌõÑ ÎåÄÍ∏∞</option><option>ÎãµÏÇ¨ÎåÄÍ∏∞</option><option>ÎãµÏÇ¨ÏôÑÎ£å</option><option className="text-red-500">ÏïàÏπòÌôïÏ†ï</option><option>Ï∑®ÏÜå</option>
                          </select>
                      </div>
                  </div>
                  <div className="input-group">
                      <label className="form-label text-red-500">ÏïàÏπò ÌôïÏ†ïÏùº</label>
                      <input name="s_confirmDate" type="date" className="form-input bg-red-50 border-red-200" defaultValue={normalizeDate(salesModal.data?.raw?.ÏïàÏπòÌôïÏ†ïÏùº) || ''} />
                  </div>
                  <div className="input-group">
                      <label className="form-label">ÎπÑÍ≥† Î©îÎ™®</label>
                      <textarea name="s_memo" className="form-input min-h-[80px]" defaultValue={clean(salesModal.data?.raw?.ÎπÑÍ≥† || salesModal.data?.raw?.ÎπÑÍ≥†Î©îÎ™®)}></textarea>
                  </div>
                  <div className="flex gap-2 pt-2">
                      {salesModal.data && <button type="button" className="flex-1 py-3 bg-slate-200 text-slate-600 font-bold rounded-xl text-xs hover:bg-slate-300">ÏÇ≠Ï†ú/Î≥¥Í¥Ä</button>}
                      <button type="submit" className="flex-[2] py-3 bg-blue-600 text-white font-black rounded-xl text-sm hover:bg-blue-700 transition shadow-lg">DB Ï†ÄÏû•</button>
                  </div>
              </form>
          </Modal>

          <Modal isOpen={schModal.isOpen} onClose={()=>setSchModal({isOpen:false, data:null})} title={schModal.data ? "üü¢ ÏïàÏπò ÏùºÏ†ï ÏàòÏ†ï" : "üü¢ ÏïàÏπò ÏùºÏ†ï Îì±Î°ù"} isNested={true}>
              <form onSubmit={saveSchedule} className="space-y-4">
                  <div className="grid grid-cols-2 gap-3">
                      <div><label className="form-label">ÏïàÏπòÏùº</label><input name="sch_date" type="date" className="form-input" defaultValue={normalizeDate(schModal.data?.raw?.ÏïàÏπòÏùº) || (dailyModal.isOpen ? dailyModal.dateStr : '')} required /></div>
                      <div><label className="form-label">Í≥ÑÏïΩÎ≤àÌò∏</label><input name="sch_no" type="text" className="form-input" defaultValue={clean(schModal.data?.raw?.Í≥ÑÏïΩÎ≤àÌò∏) || ''} /></div>
                  </div>
                  <div className="grid grid-cols-2 gap-3">
                      <div><label className="form-label">Í≥†Ïù∏Î™Ö</label><input name="sch_name" type="text" className="form-input" defaultValue={clean(schModal.data?.raw?.Í≥†Ïù∏Î™Ö) || ''} required /></div>
                      <div><label className="form-label">Í≥ÑÏïΩÏûê</label><input name="sch_contractor" type="text" className="form-input" defaultValue={clean(schModal.data?.raw?.Í≥ÑÏïΩÏûê) || ''} /></div>
                  </div>
                  <div className="input-group">
                      <label className="form-label text-blue-600">ÏúÑÏπòÏ†ïÎ≥¥ (ÏßÄÎèÑ Ïó∞Îèô)</label>
                      <div className="flex gap-2">
                        <input type="text" className="form-input bg-slate-200 text-slate-500 cursor-not-allowed flex-[2] text-xs" readOnly value={selectedLocBase} placeholder="Ïö∞Ï∏° ÏßÄÎèÑÏÑ†ÌÉù Î≤ÑÌäº ÌÅ¥Î¶≠" />
                        <div className="relative flex-[1]">
                           <input type="number" className="form-input pr-5 text-center text-xs" placeholder="Í¥ëÏ§ë" value={gwangjung} onChange={e => setGwangjung(e.target.value)} />
                           <span className="absolute right-2 top-1/2 -translate-y-1/2 font-black text-slate-400 text-xs">Î≤à</span>
                        </div>
                        <button type="button" onClick={() => setMapSelectorOpen(true)} className="px-3 bg-slate-800 text-white rounded-lg font-bold text-xs shadow-md">ÏßÄÎèÑÏÑ†ÌÉù</button>
                      </div>
                  </div>
                  <div className="input-group">
                      <label className="form-label">ÎπÑÍ≥†</label>
                      <textarea name="sch_note" className="form-input min-h-[80px]" defaultValue={clean(schModal.data?.raw?.ÎπÑÍ≥†)}></textarea>
                  </div>
                  <div className="flex gap-2 pt-2">
                      {schModal.data && <button type="button" className="flex-1 py-3 bg-slate-200 text-slate-600 font-bold rounded-xl text-xs hover:bg-slate-300">ÏÇ≠Ï†ú/Î≥¥Í¥Ä</button>}
                      <button type="submit" className="flex-[2] py-3 bg-emerald-600 text-white font-black rounded-xl text-sm hover:bg-emerald-700 transition shadow-lg">DB Ï†ÄÏû•</button>
                  </div>
              </form>
          </Modal>

          <MapSelectorModal 
             isOpen={mapSelectorOpen} 
             onClose={() => setMapSelectorOpen(false)} 
             layoutData={layoutData}
             onSelectLocation={(loc) => { setSelectedLocBase(loc); setMapSelectorOpen(false); }} 
          />
        </div>
      );
    }

    // üèñÔ∏è Í∑ºÌÉúÍ¥ÄÎ¶¨ Î∑∞ (Í∞ÄÏ§ëÏπò & Î∞òÏ∞® Ïó∞Îèô)
    function HrView() {
      const [loading, setLoading] = useState(true);
      const [hrData, setHrData] = useState([]);
      const [currentDate, setCurrentDate] = useState(new Date());
      const chartRef = useRef(null);
      const chartInstance = useRef(null);
      const [dayModal, setDayModal] = useState({ isOpen: false, dateStr: '', data: {} });

      const fetchHR = async () => {
        setLoading(true);
        try {
          const res = await supabaseClient.from('hr_management').select('*');
          setHrData(res.data || []);
        } catch(e) { console.error(e); }
        setLoading(false);
      };

      useEffect(() => { fetchHR(); }, []);

      const getCleanedHR = () => {
        let map = {};
        hrData.forEach(r => {
          if(r.work_date && r.worker_name) map[`${r.work_date}_${r.worker_name}`] = r.status;
        });
        return map;
      };

      // üìà Ïù¥Î≤à Îã¨ Ìú¥Î¨¥ ÌÜµÍ≥Ñ Ï∞®Ìä∏
      useEffect(() => {
        if (!chartRef.current) return;
        const pfx = `${currentDate.getFullYear()}-${String(currentDate.getMonth()+1).padStart(2,'0')}`;
        const cln = getCleanedHR();
        let sFull = {}; let sHalf = {}; 
        EMPLOYEES.forEach(e => { sFull[e]=0; sHalf[e]=0; });
        
        for (const [k, st] of Object.entries(cln)) {
          let [dt, nm] = k.split('_');
          if (dt.startsWith(pfx)) {
            if (['Ìú¥Î¨¥','Ïó∞Ï∞®','Î≥ëÍ∞Ä'].includes(st)) sFull[nm] = (sFull[nm]||0) + 1;
            else if (['Ïò§Ï†ÑÎ∞òÏ∞®','Ïò§ÌõÑÎ∞òÏ∞®','Ï°∞Ìá¥'].includes(st)) sHalf[nm] = (sHalf[nm]||0) + 1;
          }
        }
        
        const lbls = EMPLOYEES.map(nm => [nm.split(' ')[0], `(Ìú¥${sFull[nm]}, Î∞ò${sHalf[nm]})`]);
        const pts = EMPLOYEES.map(nm => (sFull[nm]*1) + (sHalf[nm]*0.5));
        
        const ctx = chartRef.current.getContext('2d');
        if(chartInstance.current) chartInstance.current.destroy();
        chartInstance.current = new Chart(ctx, { 
          type: 'bar', 
          data: { labels: lbls, datasets: [{ data: pts, backgroundColor: EMP_COLORS, borderRadius: 4 }] }, 
          options: { 
            responsive: true, maintainAspectRatio: false, 
            plugins: { legend: { display: false } }, 
            scales: { y: { beginAtZero: true, ticks: { stepSize: 0.5 } }, x: { ticks: { font: { size: 10 } } } } 
          } 
        });
      }, [hrData, currentDate]);

      const calendarDays = useMemo(() => {
        const year = currentDate.getFullYear(), month = currentDate.getMonth();
        const startDay = new Date(year, month, 1).getDay(), offset = startDay === 0 ? 6 : startDay - 1;
        const lastDate = new Date(year, month + 1, 0).getDate();
        const days = [];
        const cln = getCleanedHR();

        for (let i = 0; i < offset; i++) days.push(null);
        for (let i = 1; i <= lastDate; i++) {
          const ds = `${year}-${String(month + 1).padStart(2, '0')}-${String(i).padStart(2, '0')}`;
          
          // Í∞ÄÏ§ëÏπò(Capacity) Í≥ÑÏÇ∞ Î°úÏßÅ
          let capGuide = 0; let capBurial = 0;
          EMPLOYEES.forEach(emp => {
             const st = cln[`${ds}_${emp}`] || 'Ï∂úÍ∑º';
             // Î∞òÏ∞®ÎÇò Ìú¥Î¨¥Í∞Ä ÏïÑÎãàÎ©¥ 100% Í∞ÄÎèô
             if(st === 'Ï∂úÍ∑º') {
                capGuide += EMP_WEIGHTS[emp].guide || 0;
                capBurial += EMP_WEIGHTS[emp].burial || 0;
             } else if (['Ïò§Ï†ÑÎ∞òÏ∞®', 'Ïò§ÌõÑÎ∞òÏ∞®', 'Ï°∞Ìá¥'].includes(st)) {
                // Î∞òÏ∞®Î©¥ 50% Í∞ÄÎèôÎ†• Ïù∏Ï†ï
                capGuide += (EMP_WEIGHTS[emp].guide || 0) * 0.5;
                capBurial += (EMP_WEIGHTS[emp].burial || 0) * 0.5;
             }
          });

          days.push({ day: i, dateStr: ds, capGuide, capBurial });
        }
        return days;
      }, [currentDate, hrData]);

      const handleCellClick = (dateStr) => {
        const cln = getCleanedHR();
        let dayData = {};
        EMPLOYEES.forEach(emp => { dayData[emp] = cln[`${dateStr}_${emp}`] || 'Ï∂úÍ∑º'; });
        setDayModal({ isOpen: true, dateStr, data: dayData });
      };

      const saveHR = async (e) => {
          e.preventDefault();
          const dateStr = dayModal.dateStr;
          
          // Í∏∞Ï°¥ Îç∞Ïù¥ÌÑ∞ ÏÇ≠Ï†ú ÌõÑ ÏÉà Îç∞Ïù¥ÌÑ∞ ÏùºÍ¥Ñ ÏÇΩÏûÖ (Í∞ÑÎã®Ìïú Upsert ÎåÄÏ≤¥ Î°úÏßÅ)
          await supabaseClient.from('hr_management').delete().eq('work_date', dateStr);
          
          const insertData = EMPLOYEES.map((emp, i) => ({
             work_date: dateStr,
             worker_name: emp,
             status: e.target[`hr_st_${i}`].value,
             memo: e.target.hr_note.value
          }));
          
          await supabaseClient.from('hr_management').insert(insertData);
          setDayModal({isOpen:false, dateStr:'', data:{}});
          fetchHR();
      };

      return (
        <div className="space-y-4 max-w-7xl mx-auto h-full flex flex-col">
          <div className="bg-white rounded-2xl shadow border border-slate-200 flex flex-col h-[60vh] overflow-hidden shrink-0">
            <div className="p-4 border-b border-slate-100 flex justify-between items-center shrink-0 bg-slate-50">
              <div className="flex items-center space-x-4">
                <button onClick={() => setCurrentDate(new Date(currentDate.getFullYear(), currentDate.getMonth()-1, 1))} className="px-3 py-1 bg-white border border-slate-200 rounded-lg font-bold">‚óÄ</button>
                <h2 className="text-xl font-black">{currentDate.getFullYear()}ÎÖÑ {currentDate.getMonth()+1}Ïõî</h2>
                <button onClick={() => setCurrentDate(new Date(currentDate.getFullYear(), currentDate.getMonth()+1, 1))} className="px-3 py-1 bg-white border border-slate-200 rounded-lg font-bold">‚ñ∂</button>
              </div>
            </div>
            
            <div className="flex-1 overflow-auto bg-slate-50 p-2 md:p-4">
              <div className="min-w-[700px] h-full flex flex-col border border-slate-200 rounded-xl shadow-sm bg-slate-200 gap-px">
                <div className="grid grid-cols-7 gap-px shrink-0">
                  {['Ïõî','Ìôî','Ïàò','Î™©','Í∏à','ÌÜ†','Ïùº'].map((d,i)=>(<div key={d} className={`py-2 text-center text-sm font-black bg-white ${i===6?'text-red-500':i===5?'text-blue-500':'text-slate-700'}`}>{d}</div>))}
                </div>
                <div className="grid grid-cols-7 gap-px flex-1">
                  {calendarDays.map((d,i)=>(
                    <div key={i} onClick={()=>d && handleCellClick(d.dateStr)} className={`calendar-cell flex flex-col ${!d?'bg-slate-50 cursor-default':''}`}>
                      {d && (
                        <>
                          <div className={`text-right text-xs font-bold p-1 ${getTodayStr() === d.dateStr ? 'text-white bg-blue-600 inline-block self-end rounded-md px-2' : 'text-slate-500'}`}>{d.day}</div>
                          
                          {/* Í≤∞Í∑ºÏûê ÌÉúÍ∑∏ */}
                          <div className="space-y-1 flex-1 overflow-y-auto no-scrollbar pb-1">
                            {EMPLOYEES.map((emp, idx) => {
                               const st = dayModal.data[emp] || getCleanedHR()[`${d.dateStr}_${emp}`];
                               if(st && st !== 'Ï∂úÍ∑º') {
                                 let c = EMP_COLORS[idx]; let style = "";
                                 if(['Ìú¥Î¨¥','Ïó∞Ï∞®','Î≥ëÍ∞Ä'].includes(st)) style = `bg-[${c}] text-white border-transparent`;
                                 else style = `bg-white text-[${c}] border border-[${c}]`; // Î∞òÏ∞® Í≥ÑÏó¥
                                 return <div key={emp} className={`px-1.5 py-0.5 rounded text-[10px] font-bold truncate ${style}`} style={{backgroundColor: ['Ìú¥Î¨¥','Ïó∞Ï∞®'].includes(st)?c:'white', color: ['Ìú¥Î¨¥','Ïó∞Ï∞®'].includes(st)?'white':c, borderColor: c}}>{emp} {st.includes('Î∞òÏ∞®')?st.substring(0,2):''}</div>
                               }
                               return null;
                            })}
                          </div>

                          {/* üß† Ïú†Í∏∞Ï†Å Í∞ÄÏ§ëÏπò(ÏºÄÌåå) ÌëúÏãúÎ∞î */}
                          <div className="bg-slate-100 p-1 rounded mt-1 text-[9px] font-black text-slate-500 text-center tracking-tighter flex justify-between">
                            <span>ÎãµÏÇ¨ {d.capGuide}</span>
                            <span>ÏïàÏπò {d.capBurial}</span>
                          </div>
                        </>
                      )}
                    </div>
                  ))}
                </div>
              </div>
            </div>
          </div>

          <div className="bg-white rounded-2xl shadow border border-slate-200 p-4 shrink-0">
              <h3 className="text-center font-black text-slate-800 text-sm mb-2">üìä Ïù¥Î≤à Îã¨ Í∞úÏù∏Î≥Ñ Ìú¥Î¨¥ Ìï©Í≥Ñ</h3>
              <div className="w-full h-[180px] relative">
                  <canvas ref={chartRef}></canvas>
              </div>
          </div>

          {/* Í∑ºÌÉú ÏàòÏ†ï Ìèº Î™®Îã¨ */}
          <Modal isOpen={dayModal.isOpen} onClose={()=>setDayModal({isOpen:false, dateStr:'', data:{}})} title={`üìù ${dayModal.dateStr} Í∑ºÎ¨¥ ÏàòÏ†ï`}>
              <form onSubmit={saveHR} className="space-y-3">
                  {EMPLOYEES.map((emp, i) => {
                      const st = dayModal.data[emp] || 'Ï∂úÍ∑º';
                      let bg = st === 'Ï∂úÍ∑º' ? 'bg-emerald-50 text-emerald-700 border-emerald-200' : (['Ìú¥Î¨¥','Ïó∞Ï∞®'].includes(st) ? 'bg-red-50 text-red-600 border-red-200' : 'bg-orange-50 text-orange-600 border-orange-200');
                      return (
                          <div key={emp} className="flex justify-between items-center p-3 border-b border-dashed border-slate-200">
                              <span className="font-bold text-sm" style={{color: EMP_COLORS[i]}}>{emp}</span>
                              <select name={`hr_st_${i}`} className={`p-2 rounded-lg font-bold text-sm outline-none border ${bg}`} defaultValue={st}>
                                  <option value="Ï∂úÍ∑º">üü¢ Ï∂úÍ∑º</option>
                                  <option value="Ïò§Ï†ÑÎ∞òÏ∞®">üåó Ïò§Ï†Ñ Î∞òÏ∞® (0.5)</option>
                                  <option value="Ïò§ÌõÑÎ∞òÏ∞®">üåì Ïò§ÌõÑ Î∞òÏ∞® (0.5)</option>
                                  <option value="Ï°∞Ìá¥">üìâ Ï°∞Ìá¥ (0.5)</option>
                                  <option value="Ìú¥Î¨¥">üî¥ Ìú¥Î¨¥ (1)</option>
                                  <option value="Ïó∞Ï∞®">üî¥ Ïó∞Ï∞® (1)</option>
                              </select>
                          </div>
                      );
                  })}
                  <div className="pt-2">
                      <input name="hr_note" type="text" className="form-input" placeholder="ÌäπÏù¥ÏÇ¨Ìï≠ Î©îÎ™®" />
                  </div>
                  <button type="submit" className="w-full py-3 bg-slate-800 text-white font-black rounded-xl mt-4 hover:bg-slate-700">Í∑ºÌÉú Ï†ÄÏû•</button>
              </form>
          </Modal>

        </div>
      );
    }

    function FieldView({ layoutData }) {
      const [loading, setLoading] = useState(true);
      const [data, setData] = useState([]);
      const [area, setArea] = useState('A6/Í∞Ä');
      const [slotModal, setSlotModal] = useState({ isOpen: false, data: null });

      useEffect(() => {
        const fetchField = async () => {
          setLoading(true);
          try {
            const res = await supabaseClient.from('field_data').select('*').eq('Íµ¨Ïó≠', area);
            setData(res.data || []);
          } catch(e) { console.error("DB Fetch Error:", e); }
          setLoading(false);
        };
        fetchField();
      }, [area]);

      const renderedGrid = useMemo(() => {
        if (!layoutData || !layoutData[area]) return [];
        const dataMap = {};
        data.forEach(item => { if (item.ÏúÑÏπò_Î≤àÌò∏) dataMap[item.ÏúÑÏπò_Î≤àÌò∏] = item; });
        const comp = layoutData[area];
        let finalRows = [];

        if (Array.isArray(comp[0])) finalRows = comp;
        else {
            const flat = [];
            comp.forEach(item => {
                if (typeof item === 'string' && item.startsWith('_')) {
                    const count = parseInt(item.substring(1)) || 1;
                    for(let i=0; i<count; i++) flat.push('SPACER');
                } else flat.push(item);
            });
            const config = ROW_CONFIG[area] || [20];
            let idx = 0;
            config.forEach(cnt => {
                if(idx < flat.length) { finalRows.push(flat.slice(idx, idx + cnt)); idx += cnt; }
            });
        }

        return finalRows.map((rowSlots, rIdx) => ({
            rowNum: rIdx + 1,
            slots: rowSlots.map((slotId, sIdx) => {
                if (!slotId || slotId === 'SPACER' || (typeof slotId === 'string' && slotId.startsWith('_'))) {
                     return { type: 'spacer', id: `spacer-${rIdx}-${sIdx}` };
                }
                return { type: 'data', ...(dataMap[slotId] || { ÏúÑÏπò_Î≤àÌò∏: slotId, Íµ¨Ïó≠: area, Í≥ÑÏïΩ_ÏÉÅÌÉú: 'ÎØ∏Î∂ÑÏñë' }) };
            })
        }));
      }, [data, area, layoutData]);

      const saveField = async (e) => {
          e.preventDefault();
          const payload = {
              Íµ¨Ïó≠: area,
              ÏúÑÏπò_Î≤àÌò∏: slotModal.data.ÏúÑÏπò_Î≤àÌò∏,
              ÏÑ±Ìï®: e.target.f_name.value,
              Í≥ÑÏïΩ_ÏÉÅÌÉú: e.target.f_status.value,
              Í≥ÑÏïΩÏûê: e.target.f_contractor.value,
              Í∏∞Ïàò: e.target.f_units.value,
              Í∞ÄÍ≤©: e.target.f_price.value.replace(/[^0-9]/g, ""),
              Í¥ÄÎ¶¨ÎπÑ: e.target.f_fee.value.replace(/[^0-9]/g, ""),
              Î©îÎ™®: e.target.f_memo.value
          };
          if(slotModal.data?.id) await supabaseClient.from('field_data').update(payload).eq('id', slotModal.data.id);
          else await supabaseClient.from('field_data').insert(payload);
          
          setSlotModal({isOpen:false, data:null});
          // Í∞ÑÎã®Ìïú Î¶¨Î°úÎìú Ìö®Í≥º
          setLoading(true);
          const res = await supabaseClient.from('field_data').select('*').eq('Íµ¨Ïó≠', area);
          setData(res.data || []);
          setLoading(false);
      };

      return (
        <div className="space-y-4 max-w-7xl mx-auto flex flex-col h-[calc(100vh-100px)] overflow-hidden">
          <div className="flex gap-2 overflow-x-auto pb-2 border-b border-slate-200 px-2 w-full no-scrollbar shrink-0" style={{ WebkitOverflowScrolling: 'touch' }}>
            {SECTION_LIST.map(s => (
              <button key={s} onClick={() => setArea(s)} className={`flex-none px-4 py-2.5 rounded-t-xl font-bold text-[13px] whitespace-nowrap transition-all border-t border-l border-r ${area === s ? 'bg-white text-blue-600 border-slate-200 translate-y-[1px] shadow-[0_-2px_4px_rgba(0,0,0,0.02)]' : 'bg-slate-100 text-slate-500 border-transparent hover:bg-slate-200'}`}>
                {s}
              </button>
            ))}
          </div>

          <div className="bg-white p-4 md:p-8 rounded-b-2xl rounded-tr-2xl shadow-xl border border-slate-200 overflow-auto flex-1 relative w-full">
            {loading || Object.keys(layoutData).length === 0 ? (
              <div className="flex h-full items-center justify-center font-black text-slate-300 animate-pulse tracking-widest text-lg">MAP SYNCING...</div>
            ) : (
              <div className="min-w-max pb-20 pr-20">
                {renderedGrid.map((row, rIdx) => (
                  <div key={rIdx} className="map-row">
                    {row.slots.map((s) => {
                      if (s.type === 'spacer') return <div key={s.id} className="map-slot slot-spacer"></div>;
                      const st = clean(s.Í≥ÑÏïΩ_ÏÉÅÌÉú) || 'ÎØ∏Î∂ÑÏñë';
                      const cols = { 'ÏïàÏπò':'bg-emerald-700 text-white border-emerald-800', 'ÏòàÏïΩ':'bg-amber-300 text-amber-900 border-amber-400', 'ÌôÄÎî©':'bg-rose-600 text-white border-rose-800', 'ÎØ∏Î∂ÑÏñë':'bg-white text-slate-400 border-slate-300' };
                      return (
                        <div key={s.id || s.ÏúÑÏπò_Î≤àÌò∏} onClick={()=>setSlotModal({isOpen:true, data:s})} className={`map-slot ${cols[st] || cols['ÎØ∏Î∂ÑÏñë']}`}>
                          <div className={`slot-id ${st==='ÎØ∏Î∂ÑÏñë'?'opacity-50':''}`}>{s.ÏúÑÏπò_Î≤àÌò∏}</div>
                          <div className={`slot-name ${st==='ÎØ∏Î∂ÑÏñë'?'opacity-30':''}`}>{clean(s.ÏÑ±Ìï®) || clean(s.Í≥ÑÏïΩÏûê) || 'EMPTY'}</div>
                        </div>
                      );
                    })}
                  </div>
                ))}
              </div>
            )}
          </div>

          <Modal isOpen={slotModal.isOpen} onClose={()=>setSlotModal({...slotModal, isOpen:false})} title={`üìç ${slotModal.data?.Íµ¨Ïó≠} ${slotModal.data?.ÏúÑÏπò_Î≤àÌò∏}`}>
            {slotModal.data && (
              <form onSubmit={saveField} className="space-y-4">
                <div className="flex justify-between items-center bg-slate-100 p-4 rounded-xl border border-slate-200 shadow-inner">
                  <div className="flex-1 pr-4 border-r border-slate-300">
                    <label className="form-label">ÏïàÏπòÏûê (ÏÑ±Ìï®)</label>
                    <input name="f_name" type="text" className="form-input bg-white text-lg font-black" defaultValue={clean(slotModal.data.ÏÑ±Ìï®)} placeholder="Ïù¥Î¶Ñ ÏûÖÎ†•" />
                  </div>
                  <div className="pl-4 w-32">
                    <label className="form-label">ÌòÑÏû¨ ÏÉÅÌÉú</label>
                    <select name="f_status" className="form-input bg-white text-blue-600 font-black cursor-pointer" defaultValue={clean(slotModal.data.Í≥ÑÏïΩ_ÏÉÅÌÉú) || 'ÎØ∏Î∂ÑÏñë'}>
                      <option value="ÎØ∏Î∂ÑÏñë">ÎØ∏Î∂ÑÏñë</option>
                      <option value="ÏòàÏïΩ">ÏòàÏïΩ</option>
                      <option value="ÌôÄÎî©">ÌôÄÎî©</option>
                      <option value="ÏïàÏπò">ÏïàÏπò</option>
                    </select>
                  </div>
                </div>
                
                <div className="grid grid-cols-2 gap-3">
                  <div>
                    <label className="form-label">Í≥ÑÏïΩÏûê</label>
                    <input name="f_contractor" type="text" className="form-input" defaultValue={clean(slotModal.data.Í≥ÑÏïΩÏûê)} />
                  </div>
                  <div>
                    <label className="form-label">Í∏∞Ïàò</label>
                    <div className="relative">
                       <input name="f_units" type="number" className="form-input pr-8" defaultValue={clean(slotModal.data.Í∏∞Ïàò)} />
                       <span className="absolute right-3 top-1/2 -translate-y-1/2 font-black text-slate-400">Í∏∞</span>
                    </div>
                  </div>
                </div>

                <div className="grid grid-cols-2 gap-3">
                  <div>
                    <label className="form-label text-amber-600">Î∂ÑÏñëÍ∞Ä</label>
                    <input name="f_price" type="text" className="form-input bg-amber-50 border-amber-200 text-amber-700" defaultValue={formatMoney(slotModal.data.Í∞ÄÍ≤©)} />
                  </div>
                  <div>
                    <label className="form-label text-amber-600">Í¥ÄÎ¶¨ÎπÑ (Ïó∞)</label>
                    <input name="f_fee" type="text" className="form-input bg-amber-50 border-amber-200 text-amber-700" defaultValue={formatMoney(slotModal.data.Í¥ÄÎ¶¨ÎπÑ)} />
                  </div>
                </div>

                <div>
                  <label className="form-label">ÎπÑÍ≥† (ÌòÑÏû• Î©îÎ™®)</label>
                  <textarea name="f_memo" className="form-input min-h-[80px]" defaultValue={clean(slotModal.data.Î©îÎ™®)} placeholder="ÌäπÏù¥ÏÇ¨Ìï≠ Í∏∞Î°ù..."></textarea>
                </div>

                <div className="pt-2">
                    <button type="submit" className="w-full py-3 bg-blue-600 text-white font-black rounded-xl text-sm hover:bg-blue-700 transition shadow-lg shadow-blue-500/30">ÏßÄÎèÑ Îç∞Ïù¥ÌÑ∞ ÏàòÏ†ï (DB Î∞òÏòÅ)</button>
                </div>
              </form>
            )}
          </Modal>
        </div>
      );
    }

    function App() {
      const [activeTab, setActiveTab] = useState('dash');
      const [isSidebarOpen, setIsSidebarOpen] = useState(window.innerWidth > 1024);
      const [layoutData, setLayoutData] = useState({});

      useEffect(() => {
        const handleResize = () => {
          if (window.innerWidth > 1024) setIsSidebarOpen(true);
          else setIsSidebarOpen(false);
        };
        window.addEventListener('resize', handleResize);
        return () => window.removeEventListener('resize', handleResize);
      }, []);

      useEffect(() => {
        fetch('/map_layout.json')
          .then(res => res.json())
          .then(json => setLayoutData(json))
          .catch(err => console.error("Layout JSON Fetch Error", err));
      }, []);

      return (
        <div className="flex h-screen overflow-hidden bg-slate-900">
          {isSidebarOpen && <div className="fixed inset-0 bg-black/60 z-40 lg:hidden backdrop-blur-sm transition-opacity" onClick={() => setIsSidebarOpen(false)} />}
          
          <aside className={`fixed inset-y-0 left-0 z-50 w-64 bg-slate-900 border-r border-slate-800 text-slate-300 transform transition-transform duration-300 ease-in-out lg:static lg:translate-x-0 ${isSidebarOpen ? 'translate-x-0' : '-translate-x-full lg:hidden'} flex flex-col shadow-2xl lg:shadow-none`}>
            <div className="p-6 border-b border-slate-800 flex justify-between items-center shrink-0">
              <h1 className="text-xl font-black text-white tracking-tighter">JAKE WorkOS <span className="text-[10px] bg-emerald-500 px-1.5 py-0.5 rounded ml-1 text-slate-900">V26</span></h1>
              <button className="lg:hidden text-slate-400 hover:text-white transition font-bold" onClick={() => setIsSidebarOpen(false)}>‚úï</button>
            </div>
            <nav className="p-4 space-y-8 overflow-y-auto flex-1 no-scrollbar">
              <div>
                <p className="text-[10px] font-black text-slate-500 mb-3 ml-2 uppercase tracking-widest">Team Workspace</p>
                <div className="space-y-1">
                  <button onClick={() => {setActiveTab('dash'); if(window.innerWidth<1024)setIsSidebarOpen(false);}} className={`w-full flex items-center px-4 py-3 rounded-xl font-bold text-sm transition-all ${activeTab === 'dash' ? 'bg-blue-600 text-white shadow-lg shadow-blue-900/50' : 'hover:bg-slate-800'}`}>üìä ÌÜµÌï© ÏùºÏ†ï Í¥ÄÎ¶¨</button>
                  <button onClick={() => {setActiveTab('field'); if(window.innerWidth<1024)setIsSidebarOpen(false);}} className={`w-full flex items-center px-4 py-3 rounded-xl font-bold text-sm transition-all ${activeTab === 'field' ? 'bg-blue-600 text-white shadow-lg shadow-blue-900/50' : 'hover:bg-slate-800'}`}>üìç ÌòÑÏû• ÏßÄÎèÑ (Map)</button>
                  <button onClick={() => {setActiveTab('hr'); if(window.innerWidth<1024)setIsSidebarOpen(false);}} className={`w-full flex items-center px-4 py-3 rounded-xl font-bold text-sm transition-all ${activeTab === 'hr' ? 'bg-blue-600 text-white shadow-lg shadow-blue-900/50' : 'hover:bg-slate-800'}`}>üèñÔ∏è Í∑ºÌÉú Í¥ÄÎ¶¨</button>
                </div>
              </div>
            </nav>
          </aside>

          <main className="flex-1 flex flex-col h-screen overflow-hidden bg-[#F8FAFC]">
            <header className="h-14 bg-white border-b border-slate-200 flex items-center px-4 justify-between shrink-0 z-10 shadow-sm">
              <div className="flex items-center">
                <button className="p-2 text-slate-500 hover:bg-slate-100 transition rounded-lg mr-3" onClick={() => setIsSidebarOpen(!isSidebarOpen)}>
                  <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
                </button>
                <h2 className="font-black text-lg text-slate-800 tracking-tight">{activeTab === 'dash' ? 'Integrated Dashboard' : activeTab === 'field' ? 'Field Control Map' : 'HR Management'}</h2>
              </div>
            </header>
            <div className="flex-1 overflow-hidden p-2 md:p-4">
              {activeTab === 'dash' && <DashboardView layoutData={layoutData} />}
              {activeTab === 'field' && <FieldView layoutData={layoutData} />}
              {activeTab === 'hr' && <HrView />}
            </div>
          </main>
        </div>
      );
    }

    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(
      <ErrorBoundary>
        <App />
      </ErrorBoundary>
    );
  </script>
</body>
</html>
