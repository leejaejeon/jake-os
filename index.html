DROP VIEW IF EXISTS "view_master_dashboard";

CREATE VIEW "view_master_dashboard" AS
SELECT 
    o."안치번호",
    o."증서no" AS "계약번호",
    o."계약현황",
    o."계약자1" AS "마스터_계약자",
    o."고인명" AS "마스터_고인명",
    o."분양가격",
    o."미수금",
    e."상태" AS "각인_진행상태",
    e."각인" AS "각인_내용",
    e."설치" AS "각인_설치여부",
    -- b(일정 테이블)에 데이터가 없으면 o(마스터 테이블)의 안치일자를 가져옵니다.
    COALESCE(NULLIF(b."안치일", ''), NULLIF(o."관리비납부_안치일자", '')) AS "실제_안치일정",
    b."비고" AS "안치_비고"
FROM "official_records" o
LEFT JOIN "engraving_mgmt" e ON o."증서no" = e."계약번호"
LEFT JOIN "burial_schedule" b ON o."증서no" = b."계약번호";
