<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>Jake WorkOS - Master Dashboard</title>
  
  <script src="https://unpkg.com/react@18/umd/react.production.min.js" crossorigin></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js" crossorigin></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

  <style>
    @import url('https://cdn.jsdelivr.net/gh/orioncactus/pretendard@v1.3.9/dist/web/static/pretendard.min.css');
    body { font-family: 'Pretendard', sans-serif; background-color: #f8fafc; overscroll-behavior-y: none; }
  </style>
</head>
<body>
  <div id="root"></div>

  <script type="text/babel">
    const { useState, useEffect } = React;

    // ==========================================
    // ğŸš¨ [í•„ìˆ˜ ì…ë ¥] ë°˜ë“œì‹œ ì‘ì€ë”°ì˜´í‘œ(' ') ì•ˆì— ë„£ìœ¼ì„¸ìš”!
    // ==========================================
    const SUPABASE_URL = 'lqccxnciiajwqdmpwjdv.supabase.co';
    const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImxxY2N4bmNpaWFqd3FkbXB3amR2Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzE1MjA3MTMsImV4cCI6MjA4NzA5NjcxM30.L23-eq-DIPsbONOeX-xQ8UcMb7gtgTTTRpkaSm9HTw4';

    // ğŸ›¡ï¸ ì—ëŸ¬ ë°©ì–´ì„ : URL/Key í˜•ì‹ ìë™ ê²€ì‚¬
    let supabaseClient = null;
    let initError = null;
    try {
      if (!SUPABASE_URL || SUPABASE_URL.includes('ì—¬ê¸°ì—')) {
        initError = "ì½”ë“œ ìƒë‹¨ì— Supabase URLê³¼ KEYë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.";
      } else if (!SUPABASE_URL.startsWith('http')) {
        initError = "URLì€ ë°˜ë“œì‹œ https:// ë¡œ ì‹œì‘í•´ì•¼ í•©ë‹ˆë‹¤. ë³µì‚¬í•˜ì‹  ê°’ì„ í™•ì¸í•´ì£¼ì„¸ìš”.";
      } else {
        supabaseClient = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);
      }
    } catch (err) {
      initError = "Supabase ì´ˆê¸°í™” ì‹¤íŒ¨: " + err.message;
    }

    function Layout({ children }) {
      const [isSidebarOpen, setIsSidebarOpen] = useState(false);
      return (
        <div className="flex h-screen overflow-hidden text-gray-800">
          {isSidebarOpen && <div className="fixed inset-0 bg-black bg-opacity-50 z-40 md:hidden" onClick={() => setIsSidebarOpen(false)} />}
          <aside className={`fixed md:static inset-y-0 left-0 z-50 w-64 bg-white border-r border-gray-200 transform transition-transform duration-300 ${isSidebarOpen ? 'translate-x-0' : '-translate-x-full md:translate-x-0'}`}>
            <div className="p-5 border-b border-gray-100 flex justify-between items-center bg-gray-50">
              <h1 className="font-bold text-xl text-slate-800 tracking-tight">ğŸŒ² Jake WorkOS</h1>
              <button className="md:hidden text-gray-500 font-bold text-xl" onClick={() => setIsSidebarOpen(false)}>âœ•</button>
            </div>
            <nav className="p-4 space-y-2">
              <button className="w-full text-left p-3 rounded-lg bg-blue-600 text-white font-bold shadow-md">ğŸ“Š í†µí•© ëŒ€ì‹œë³´ë“œ</button>
              <button className="w-full text-left p-3 rounded-lg text-gray-600 hover:bg-gray-100 font-semibold">ğŸ” í˜„ì¥ ê´€ë¦¬</button>
              <button className="w-full text-left p-3 rounded-lg text-gray-600 hover:bg-gray-100 font-semibold">ğŸš€ í”„ë¡œì íŠ¸</button>
            </nav>
          </aside>
          <main className="flex-1 flex flex-col h-screen overflow-hidden bg-slate-50">
            <header className="h-14 bg-white border-b border-gray-200 flex items-center px-4 shrink-0 shadow-sm z-10">
              <button className="md:hidden p-2 text-gray-600 rounded-md bg-gray-100 mr-3" onClick={() => setIsSidebarOpen(true)}>â˜°</button>
              <div className="font-bold text-lg text-slate-700">ëŒ€ì‹œë³´ë“œ & ì¼ì • í†µí•©</div>
            </header>
            <div className="flex-1 overflow-y-auto p-4 md:p-6 pb-24">{children}</div>
          </main>
        </div>
      );
    }

    function Dashboard() {
      const [loading, setLoading] = useState(!initError);
      const [dataList, setDataList] = useState([]);
      const [systemError, setSystemError] = useState(initError);

      useEffect(() => {
        if (!supabaseClient) return;
        fetchData();
      }, []);

      const fetchData = async () => {
        try {
          const { data, error } = await supabaseClient
            .from('view_master_dashboard')
            .select('*')
            .order('ì‹¤ì œ_ì•ˆì¹˜ì¼ì •', { ascending: false, nullsFirst: false })
            .limit(100);

          if (error) throw error;
          setDataList(data || []);
        } catch (error) {
          setSystemError("DB ë°ì´í„° ë¡œë“œ ì—ëŸ¬: " + error.message);
        } finally {
          setLoading(false);
        }
      };

      return (
        <Layout>
          {/* ğŸš¨ ì—ëŸ¬ ë°œìƒ ì‹œ ë°±ì§€ ëŒ€ì‹  ë³´ì—¬ì¤„ ê²½ê³ ì°½ */}
          {systemError && (
            <div className="bg-red-100 border-l-4 border-red-600 text-red-800 p-4 mb-6 rounded shadow-sm font-bold">
              âš ï¸ ì‹œìŠ¤í…œ ê²½ê³ : {systemError}
            </div>
          )}

          <div className="flex bg-slate-800 text-white rounded-xl shadow-lg mb-6">
            <div className="flex-1 p-4 text-center border-r border-slate-600">
              <div className="text-xs text-slate-400 font-bold mb-1">ì˜¤ëŠ˜ ì•ˆì¹˜</div><div className="text-2xl font-black text-yellow-400">0ê±´</div>
            </div>
            <div className="flex-1 p-4 text-center border-r border-slate-600">
              <div className="text-xs text-slate-400 font-bold mb-1">ì˜¤ëŠ˜ ë‹µì‚¬</div><div className="text-2xl font-black text-yellow-400">0ê±´</div>
            </div>
            <div className="flex-1 p-4 text-center">
              <div className="text-xs text-slate-400 font-bold mb-1">ì˜¤ëŠ˜ íœ´ë¬´</div><div className="text-2xl font-black text-white">0ëª…</div>
            </div>
          </div>

          <div className="bg-white rounded-xl shadow-sm border border-gray-200 p-5 overflow-hidden">
            <h2 className="font-bold text-lg mb-4 text-slate-800 border-b pb-2">ğŸ“‹ í†µí•© ì•ˆì¹˜ í˜„í™©</h2>
            
            {loading ? (
              <div className="text-center py-10 text-slate-500 font-bold">ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ì…ë‹ˆë‹¤...</div>
            ) : (
              <div className="overflow-x-auto">
                <table className="w-full text-sm text-left whitespace-nowrap">
                  <thead className="bg-slate-100 text-slate-600">
                    <tr>
                      <th className="px-4 py-3 font-bold">ìœ„ì¹˜(ë²ˆí˜¸)</th>
                      <th className="px-4 py-3 font-bold">ê³„ì•½ì</th>
                      <th className="px-4 py-3 font-bold">ê³ ì¸ëª…</th>
                      <th className="px-4 py-3 font-bold text-center">ìƒíƒœ</th>
                      <th className="px-4 py-3 font-bold text-right">ì•ˆì¹˜ì¼</th>
                    </tr>
                  </thead>
                  <tbody className="divide-y divide-gray-100">
                    {dataList.length === 0 && !systemError ? (
                      <tr><td colSpan="5" className="text-center py-8 text-gray-500">ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.</td></tr>
                    ) : (
                      dataList.map((row, idx) => (
                        <tr key={idx} className="hover:bg-blue-50">
                          <td className="px-4 py-3 font-bold text-blue-700">{row.ì•ˆì¹˜ë²ˆí˜¸ || '-'}</td>
                          <td className="px-4 py-3">{row.ë§ˆìŠ¤í„°_ê³„ì•½ì || '-'}</td>
                          <td className="px-4 py-3 font-bold">{row.ë§ˆìŠ¤í„°_ê³ ì¸ëª… || '-'}</td>
                          <td className="px-4 py-3 text-center">
                            <span className="px-2 py-1 bg-gray-200 rounded text-xs font-bold text-gray-700">{row.ê°ì¸_ì§„í–‰ìƒíƒœ || 'ë¯¸ë“±ë¡'}</span>
                          </td>
                          <td className="px-4 py-3 text-right font-medium">
                            {/* ğŸ›¡ï¸ ë‚ ì§œ ì¶œë ¥ ì—ëŸ¬ ë°©ì–´ */}
                            {row.ì‹¤ì œ_ì•ˆì¹˜ì¼ì • ? String(row.ì‹¤ì œ_ì•ˆì¹˜ì¼ì •).substring(0, 10) : '-'}
                          </td>
                        </tr>
                      ))
                    )}
                  </tbody>
                </table>
              </div>
            )}
          </div>
        </Layout>
      );
    }

    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<Dashboard />);
  </script>
</body>
</html>
