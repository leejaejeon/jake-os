<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>Jake WorkOS V14 - Absolute Grid Engine</title>
  
  <script src="https://unpkg.com/react@18/umd/react.production.min.js" crossorigin></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js" crossorigin></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

  <style>
    @import url('https://cdn.jsdelivr.net/gh/orioncactus/pretendard@v1.3.9/dist/web/static/pretendard.min.css');
    body { font-family: 'Pretendard', sans-serif; background-color: #f1f5f9; color: #1e293b; -webkit-font-smoothing: antialiased; overflow: hidden; }
    
    /* 2D ìŠ¤í¬ë¡¤ë°” ìµœì í™” */
    ::-webkit-scrollbar { width: 8px; height: 8px; }
    ::-webkit-scrollbar-track { background: #f8fafc; border-radius: 4px; }
    ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 4px; border: 2px solid #f8fafc; }
    ::-webkit-scrollbar-thumb:hover { background: #94a3b8; }
    
    /* ëª¨ë°”ì¼ ë„¤ë¹„ê²Œì´ì…˜ ìŠ¤í¬ë¡¤ì„ ìœ„í•œ íŠ¹ìˆ˜ í´ë˜ìŠ¤ */
    .nav-scroll { display: flex; overflow-x: auto; -webkit-overflow-scrolling: touch; scrollbar-width: none; }
    .nav-scroll::-webkit-scrollbar { display: none; }
    
    /* ë‹¬ë ¥ ë° ëª¨ë‹¬ ì• ë‹ˆë©”ì´ì…˜ */
    .calendar-grid { display: grid; grid-template-columns: repeat(7, 1fr); gap: 1px; background-color: #e2e8f0; border: 1px solid #e2e8f0; }
    .calendar-cell { min-height: 110px; background-color: #fff; padding: 4px; transition: background 0.2s; cursor: pointer; }
    .calendar-cell:hover { background-color: #f8fafc; }
    .modal-enter { animation: fadeIn 0.25s cubic-bezier(0.16, 1, 0.3, 1); }
    @keyframes fadeIn { from { opacity: 0; transform: translateY(15px); } to { opacity: 1; transform: translateY(0); } }

    /* ğŸ—ºï¸ ì ˆëŒ€ ì¢Œí‘œ ê·¸ë¦¬ë“œ ë¬¼ë¦¬ ì—”ì§„ CSS */
    .map-row { display: flex; flex-direction: row; justify-content: flex-end; /* ìš°ì¸¡ë¶€í„° 1-1ì´ ì‹œì‘ë˜ë„ë¡ ìš°ì¸¡ ì •ë ¬ */ gap: 4px; margin-bottom: 4px; width: max-content; }
    .map-slot { width: 85px; min-width: 85px; height: 70px; border-radius: 6px; border: 1px solid #cbd5e1; display: flex; flex-direction: column; justify-content: center; align-items: center; cursor: pointer; transition: transform 0.1s, opacity 0.1s; box-shadow: 0 1px 2px rgba(0,0,0,0.05); }
    .map-slot:active { transform: scale(0.95); opacity: 0.8; }
    .slot-spacer { visibility: hidden; pointer-events: none; border: none; background: transparent; box-shadow: none; } 
    .slot-id { font-size: 10px; opacity: 0.8; font-weight: 800; margin-bottom: 2px; }
    .slot-name { font-size: 11px; font-weight: 800; text-align: center; width: 100%; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; padding: 0 2px; letter-spacing: -0.5px; }
  </style>
</head>
<body>
  <div id="root"></div>

  <script type="text/babel">
    const { useState, useEffect, useMemo, useCallback } = React;

    const SUPABASE_URL = 'https://lqccxnciiajwqdmpwjdv.supabase.co';
    const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImxxY2N4bmNpaWFqd3FkbXB3amR2Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzE1MjA3MTMsImV4cCI6MjA4NzA5NjcxM30.L23-eq-DIPsbONOeX-xQ8UcMb7gtgTTTRpkaSm9HTw4';
    const supabaseClient = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

    const clean = (val) => (!val || val === '0.0' || val === '0' || val === 'null' || val === ' -  - ') ? '' : String(val).trim();
    const normalizeDate = (v) => { 
      if(!v) return null; 
      const s = String(v).replace(/\./g,'-').replace(/\s/g,'').substring(0,10);
      const match = s.match(/^(\d{4})-(\d{1,2})-(\d{1,2})/);
      if (match) {
        return `${match[1]}-${match[2].padStart(2, '0')}-${match[3].padStart(2, '0')}`;
      }
      return null;
    };
    const formatMoney = (val) => {
      const num = parseInt(String(val).replace(/[^0-9]/g, ''));
      return isNaN(num) ? '0ì›' : num.toLocaleString() + 'ì›';
    };

    // ğŸ“ ì ˆëŒ€ ì¢Œí‘œê³„ ì„¤ì •ì„ ìœ„í•œ êµ¬ì—­ë³„ ì •ë³´
    // ë°°ì—´ì˜ ê° ìˆ«ìëŠ” í•´ë‹¹ í–‰(Row)ì˜ 'ìµœëŒ€ ì¹¸ ìˆ˜'ë¥¼ ì˜ë¯¸í•©ë‹ˆë‹¤.
    const SECTION_LIST = ['A2/ê°€','A3/ê°€','A4/ê°€','A4/ë‚˜','A4/ë‹¤','A5/ê°€','A5/ë‚˜','A6/ê°€','A6/ë‚˜','B1/ê°€','B2/ê°€','B3/ê°€','B4/ê°€','B5/ê°€','B6/ê°€/1-12','B6/ê°€/13-14','C1/ê°€'];
    const ROW_CONFIG = { 
      'A2/ê°€':[12], 'A3/ê°€':[8,8], 'A4/ê°€':[12,12,12,12,18,18,28,12], 'A4/ë‚˜':[9,11,7,8,8], 'A4/ë‹¤':[6,6], 'A5/ê°€':[13,14,14,13,13,15,11], 
      'A5/ë‚˜':[23,22,26,25,30,47,47,30,39], 'A6/ê°€':[27,27,22,18,19,15,13], 'A6/ë‚˜':[25,26,26,26,26,26], 'C1/ê°€':[13,17,21,25], 
      'B1/ê°€':[20,23], 'B2/ê°€':[34,34,35,34,34], 'B3/ê°€':[48,46,45,41], 'B4/ê°€':[37,38,41,41,34], 'B5/ê°€':[47,47,49,48,40,32], 
      'B6/ê°€/1-12':[47,52,53,52,53,53,54,54,54,53,55,54,50], 'B6/ê°€/13-14':[75,75,75,75,75,75,75,75,75] 
    };

    function Modal({ isOpen, onClose, title, children }) {
      if (!isOpen) return null;
      return (
        <div className="fixed inset-0 z-[100] flex items-center justify-center p-4 bg-slate-900/70 backdrop-blur-sm" onClick={onClose}>
          <div className="bg-white rounded-2xl shadow-2xl w-full max-w-md max-h-[85vh] overflow-hidden flex flex-col modal-enter" onClick={e => e.stopPropagation()}>
            <div className="p-4 border-b border-slate-100 flex justify-between items-center bg-slate-50">
              <h3 className="text-lg font-black text-slate-800 tracking-tight">{title}</h3>
              <button onClick={onClose} className="p-1 hover:bg-slate-200 rounded-lg transition text-slate-500 font-bold">âœ•</button>
            </div>
            <div className="flex-1 overflow-y-auto p-4 bg-slate-50/50">{children}</div>
            <div className="p-3 bg-white border-t border-slate-100 flex flex-col">
              <button onClick={onClose} className="w-full py-3 bg-slate-800 text-white rounded-xl font-bold hover:bg-slate-700 transition shadow-sm">ë‹«ê¸°</button>
            </div>
          </div>
        </div>
      );
    }

    function DashboardView() {
      const [loading, setLoading] = useState(true);
      const [events, setEvents] = useState([]);
      const [currentDate, setCurrentDate] = useState(new Date());
      const [dailyModal, setDailyModal] = useState({ isOpen: false, date: '', events: [] });

      useEffect(() => {
        const fetchAll = async () => {
          setLoading(true);
          try {
            const [burRes, salRes] = await Promise.all([
              supabaseClient.from('burial_schedule').select('*'),
              supabaseClient.from('status_mgmt').select('*')
            ]);
            const burialEvents = (burRes.data || []).map(b => ({
              type: 'burial', date: normalizeDate(b.ì•ˆì¹˜ì¼), title: clean(b.ê³ ì¸ëª…), sub: clean(b.ìœ„ì¹˜), raw: b
            }));
            const salesEvents = (salRes.data || []).map(s => {
              const custName = clean(s['ê³ ê°(ê³ ì¸)ëª…'] || s.ê³ ê°_ê³ ì¸_ëª… || s.ê³ ê°ê³ ì¸ëª… || 'ì´ë¦„ì—†ìŒ');
              return {
                type: 'sales', date: normalizeDate(s.ë‹µì‚¬ì¼) || normalizeDate(s.ë“±ë¡ì¼), title: custName, sub: `${clean(s.ì˜ì—…ìì‚¬ëª…)}/${clean(s.ì˜ì—…ìì„±í•¨)}`, status: s.í˜„ì¬ìƒíƒœ, raw: s
              };
            }).filter(s => s.status !== 'ìƒë‹´ í›„ ëŒ€ê¸°');
            setEvents([...burialEvents, ...salesEvents].filter(e => e.date !== null));
          } catch (e) { console.error(e); } finally { setLoading(false); }
        };
        fetchAll();
      }, []);

      const calendarDays = useMemo(() => {
        const year = currentDate.getFullYear(), month = currentDate.getMonth();
        const startDay = new Date(year, month, 1).getDay(), offset = startDay === 0 ? 6 : startDay - 1;
        const lastDate = new Date(year, month + 1, 0).getDate();
        const days = [];
        for (let i = 0; i < offset; i++) days.push(null);
        for (let i = 1; i <= lastDate; i++) {
          const ds = `${year}-${String(month + 1).padStart(2, '0')}-${String(i).padStart(2, '0')}`;
          days.push({ day: i, dateStr: ds, dayEvents: events.filter(e => e.date === ds) });
        }
        return days;
      }, [currentDate, events]);

      const openDailyList = (dateStr, dayEvents) => {
        setDailyModal({ isOpen: true, date: dateStr, events: dayEvents });
      };

      return (
        <div className="space-y-6 max-w-7xl mx-auto h-full flex flex-col">
          <div className="bg-white rounded-3xl shadow-xl border border-slate-200 flex flex-col h-full overflow-hidden">
            <div className="p-4 md:p-6 border-b border-slate-100 flex justify-between items-center bg-white shrink-0">
              <div className="flex items-center space-x-4">
                <button onClick={() => setCurrentDate(new Date(currentDate.getFullYear(), currentDate.getMonth() - 1, 1))} className="p-2 hover:bg-slate-100 rounded-full font-black">â—€</button>
                <h2 className="text-xl md:text-2xl font-black text-slate-800 tracking-tight">{currentDate.getFullYear()}ë…„ {currentDate.getMonth() + 1}ì›”</h2>
                <button onClick={() => setCurrentDate(new Date(currentDate.getFullYear(), currentDate.getMonth() + 1, 1))} className="p-2 hover:bg-slate-100 rounded-full font-black">â–¶</button>
              </div>
            </div>

            <div className="flex-1 overflow-x-auto overflow-y-auto no-scrollbar bg-slate-50 p-2 md:p-4">
              <div className="min-w-[700px] h-full flex flex-col shadow-sm rounded-xl overflow-hidden">
                <div className="grid grid-cols-7 gap-px bg-slate-200 border-b border-slate-200 shrink-0">
                  {['ì›”','í™”','ìˆ˜','ëª©','ê¸ˆ','í† ','ì¼'].map((d,i)=>(<div key={d} className={`py-2 text-center text-sm font-black bg-white ${i===6?'text-red-500':i===5?'text-blue-500':'text-slate-600'}`}>{d}</div>))}
                </div>
                <div className="grid grid-cols-7 gap-px bg-slate-200 flex-1">
                  {calendarDays.map((d, i) => (
                    <div key={i} onClick={() => d && openDailyList(d.dateStr, d.dayEvents)} className={`calendar-cell flex flex-col ${!d?'bg-slate-50/50 cursor-default':''}`}>
                      {d && (
                        <>
                          <div className={`text-right text-xs font-bold mb-1 p-1 ${new Date().toISOString().split('T')[0] === d.dateStr ? 'text-white bg-blue-600 inline-block self-end rounded-md px-2 py-0.5' : 'text-slate-400'}`}>{d.day}</div>
                          <div className="space-y-1 flex-1 overflow-y-auto no-scrollbar pb-1">
                            {d.dayEvents.map((ev, idx) => {
                              const isCancel = ev.status === 'ì·¨ì†Œ';
                              const isDone = ev.status === 'ë‹µì‚¬ì™„ë£Œ' || ev.status === 'ì•ˆì¹˜í™•ì •';
                              let style = ev.type === 'burial' 
                                ? 'bg-emerald-600 text-white border-emerald-700' 
                                : (isCancel ? 'bg-slate-100 text-slate-400 line-through border-slate-200' : isDone ? 'bg-blue-50 text-blue-700 border-blue-200' : 'bg-amber-300 text-amber-900 border-amber-400');
                              let icon = ev.type === 'burial' ? 'ğŸŸ¢' : (isCancel ? 'âŒ' : isDone ? 'âœ…' : 'ğŸŸ¡');
                              
                              return (
                                <div key={idx} className={`px-1.5 py-1 rounded text-[10px] font-bold truncate shadow-sm border ${style}`}>
                                  {icon} {ev.title}
                                </div>
                              );
                            })}
                          </div>
                        </>
                      )}
                    </div>
                  ))}
                </div>
              </div>
            </div>
          </div>

          <Modal isOpen={dailyModal.isOpen} onClose={() => setDailyModal({ ...dailyModal, isOpen: false })} title={`ğŸ“… ${dailyModal.date} ì¼ì • ìƒì„¸`}>
            {dailyModal.events.length === 0 ? (
              <div className="text-center p-10 text-slate-400 font-bold">ì´ ë‚ ì§œì— ë“±ë¡ëœ ì¼ì •ì´ ì—†ìŠµë‹ˆë‹¤.</div>
            ) : (
              <div className="space-y-3">
                {dailyModal.events.map((ev, idx) => {
                  const isCancel = ev.status === 'ì·¨ì†Œ';
                  const isDone = ev.status === 'ë‹µì‚¬ì™„ë£Œ' || ev.status === 'ì•ˆì¹˜í™•ì •';
                  if (ev.type === 'sales') {
                    const bg = isCancel ? "bg-slate-100 border-slate-200 text-slate-400" : (isDone ? "bg-blue-50 border-blue-200 text-blue-800" : "bg-yellow-50 border-amber-300 text-amber-900");
                    const icon = isCancel ? "âŒ" : (isDone ? "âœ…" : "ğŸŸ¡");
                    const textDec = isCancel ? "line-through" : "none";
                    return (
                      <div key={idx} className={`p-4 rounded-xl border shadow-sm ${bg}`}>
                        <div className="font-black text-[13px] mb-1" style={{textDecoration: textDec}}>
                          {icon} [ì˜ì—…] {ev.sub} - {ev.title} ({ev.status})
                        </div>
                        <div className="text-[11px] font-bold opacity-70 mt-2 whitespace-pre-wrap">{clean(ev.raw.ë¹„ê³ ë©”ëª¨) || 'ê¸°ë¡ëœ ë©”ëª¨ ì—†ìŒ'}</div>
                      </div>
                    );
                  } else {
                    return (
                      <div key={idx} className="p-4 rounded-xl border border-emerald-700 bg-emerald-600 text-white shadow-sm">
                        <div className="font-black text-[13px] mb-1">ğŸŸ¢ [ì•ˆì¹˜] {ev.title} ({ev.sub || 'ìœ„ì¹˜ë¯¸ìƒ'})</div>
                        <div className="text-[11px] font-medium opacity-90 mt-2 whitespace-pre-wrap">{clean(ev.raw.ë¹„ê³ ) || 'íŠ¹ì´ì‚¬í•­ ì—†ìŒ'}</div>
                      </div>
                    );
                  }
                })}
              </div>
            )}
          </Modal>
        </div>
      );
    }

    // ==========================================
    // ğŸ” View: Field Map (ğŸš€ ì ˆëŒ€ ê·¸ë¦¬ë“œ ê°•ì œ ë Œë”ë§ ì—”ì§„)
    // ==========================================
    function FieldView() {
      const [loading, setLoading] = useState(true);
      const [data, setData] = useState([]);
      const [area, setArea] = useState('A6/ê°€');
      const [slotModal, setSlotModal] = useState({ isOpen: false, data: null });

      useEffect(() => {
        const fetchField = async () => {
          setLoading(true);
          const res = await supabaseClient.from('field_data').select('*').eq('êµ¬ì—­', area);
          setData(res.data || []);
          setLoading(false);
        };
        fetchField();
      }, [area]);

      // ğŸ§  ì ˆëŒ€ ì¢Œí‘œ ê°•ì œ ì‚½ì… ì—”ì§„ (Jakeì˜ ë¡œì§ ë°˜ì˜)
      const renderedGrid = useMemo(() => {
        const config = ROW_CONFIG[area];
        if (!config) return [];

        // 1. ë°ì´í„°ë¥¼ ì°¾ê¸° ì‰½ê²Œ Map(Dictionary)ìœ¼ë¡œ ë³€í™˜
        // ì˜ˆ: dataMap['1-12'] = { ì„±í•¨: 'ë°•ì¢…ì„...', ê³„ì•½ì: 'ë°•ë´‰ìˆ˜', ... }
        const dataMap = {};
        data.forEach(item => {
          if (item.ìœ„ì¹˜_ë²ˆí˜¸ && item.ìœ„ì¹˜_ë²ˆí˜¸ !== 'SPACER') {
            dataMap[item.ìœ„ì¹˜_ë²ˆí˜¸] = item;
          }
        });

        // 2. config ë°°ì—´ì„ ë°”íƒ•ìœ¼ë¡œ ê°€ìƒì˜ ë¼ˆëŒ€(Grid)ë¥¼ êµ¬ì¶•
        return config.map((maxCols, rIdx) => {
          const rowNum = rIdx + 1; // 1í–‰, 2í–‰...
          const rowSlots = [];

          // 3. ìš°ì¸¡(1ë²ˆ)ë¶€í„° ì¢Œì¸¡(maxColsë²ˆ)ê¹Œì§€ ê°•ì œë¡œ ì¹¸ì„ ìƒì„±
          for (let c = 1; c <= maxCols; c++) {
            const posKey = `${rowNum}-${c}`; // ì˜ˆ: '1-1', '1-2', '2-23' ...
            const matchedData = dataMap[posKey];

            if (matchedData) {
              // DBì— í•´ë‹¹ ìœ„ì¹˜ ë°ì´í„°ê°€ ìˆìœ¼ë©´ ë°ì´í„° ë Œë”ë§
              rowSlots.push({ type: 'data', ...matchedData });
            } else {
              // DBì— ë°ì´í„°ê°€ ì—†ìœ¼ë©´ 'íˆ¬ëª… ë°•ìŠ¤'ë¥¼ ê°•ì œë¡œ ë¼ì›Œë„£ì–´ ë¼ˆëŒ€ë¥¼ ìœ ì§€ì‹œí‚´
              rowSlots.push({ type: 'spacer', id: `blank-${posKey}` });
            }
          }

          // 4. íŠ¹ë³„ ì¼€ì´ìŠ¤ (A3/ê°€ 1-3-1, 1-3-2 ì²˜ëŸ¼ ë¶ˆê·œì¹™í•œ ë²ˆí˜¸ ì²˜ë¦¬)
          const irregulars = data.filter(item => {
             const baseMatch = String(item.ìœ„ì¹˜_ë²ˆí˜¸).match(/^(\d+)-(\d+)/);
             if (baseMatch && parseInt(baseMatch[1]) === rowNum) {
                 // ê·œì¹™ì ì¸ ë²ˆí˜¸(ì˜ˆ: 1-5)ê°€ ì•„ë‹Œ ì˜ˆì™¸ ë²ˆí˜¸(ì˜ˆ: 1-3-2)ì¸ ê²½ìš°
                 return !String(item.ìœ„ì¹˜_ë²ˆí˜¸).match(/^\d+-\d+$/);
             }
             return false;
          });
          
          irregulars.forEach(irr => rowSlots.push({ type: 'data', ...irr }));

          return { rowNum, slots: rowSlots };
        });
      }, [data, area]);

      return (
        <div className="space-y-4 max-w-7xl mx-auto flex flex-col h-[calc(100vh-100px)]">
          {/* âœ… êµ¬ì—­ íƒ­ ê°€ë¡œ ìŠ¤í¬ë¡¤ ë³µêµ¬ (nav-scroll í´ë˜ìŠ¤ ì ìš©) */}
          <div className="nav-scroll pb-2 border-b border-slate-200 shrink-0 gap-2 px-2">
            {SECTION_LIST.map(s => (
              <button key={s} onClick={() => setArea(s)} className={`px-4 py-2.5 rounded-t-xl font-bold text-[13px] whitespace-nowrap transition-all border-t border-l border-r shrink-0 ${area === s ? 'bg-white text-slate-900 border-slate-200 border-b-white translate-y-[1px] shadow-[0_-2px_4px_rgba(0,0,0,0.02)]' : 'bg-slate-100 text-slate-500 border-transparent hover:bg-slate-200'}`}>
                {s}
              </button>
            ))}
          </div>

          {/* ğŸ—ºï¸ ê±°ëŒ€ ì§€ë„ ìŠ¤í¬ë¡¤ ìº”ë²„ìŠ¤ */}
          <div className="bg-white p-4 md:p-8 rounded-b-2xl rounded-tr-2xl shadow-xl border border-slate-200 flex-1 overflow-auto relative">
            {loading ? (
              <div className="flex h-full items-center justify-center font-black text-slate-300 animate-pulse tracking-widest text-lg">MAP BUILDING...</div>
            ) : (
              <div className="w-max mx-auto pb-10 pr-10">
                {renderedGrid.map((row) => (
                  <div key={`row-${row.rowNum}`} className="map-row">
                    {/* CSSì—ì„œ justify-content: flex-end ë¡œ ìš°ì¸¡ ì •ë ¬í–ˆìœ¼ë¯€ë¡œ, 1ë²ˆ(ë°°ì—´ ì²«ìš”ì†Œ)ì´ ê°€ì¥ ìš°ì¸¡ì— ë Œë”ë§ë¨ */}
                    {row.slots.map((s, sIdx) => {
                      if (s.type === 'spacer') {
                        return <div key={s.id} className="map-slot slot-spacer"></div>;
                      }

                      const status = clean(s.ê³„ì•½_ìƒíƒœ) || 'ë¯¸ë¶„ì–‘';
                      const colors = {
                        'ì•ˆì¹˜': 'bg-emerald-700 text-white border-emerald-800',
                        'ì˜ˆì•½': 'bg-amber-300 text-amber-900 border-amber-400',
                        'ê³„ì•½ê¸ˆ': 'bg-amber-100 text-amber-800 border-amber-300',
                        'í™€ë”©': 'bg-rose-600 text-white border-rose-800',
                        'ë¯¸ë¶„ì–‘': 'bg-white text-slate-400 border-slate-300'
                      };
                      return (
                        <div key={s.id || s.ìœ„ì¹˜_ë²ˆí˜¸} onClick={() => setSlotModal({ isOpen: true, data: s })} className={`map-slot ${colors[status] || colors['ë¯¸ë¶„ì–‘']}`}>
                          <div className={`slot-id ${status==='ë¯¸ë¶„ì–‘'?'text-slate-400':'text-inherit'}`}>{s.ìœ„ì¹˜_ë²ˆí˜¸}</div>
                          <div className={`slot-name ${status==='ë¯¸ë¶„ì–‘'?'opacity-30':'opacity-100'}`}>{clean(s.ì„±í•¨) || clean(s.ê³„ì•½ì) || 'EMPTY'}</div>
                        </div>
                      );
                    })}
                  </div>
                ))}
              </div>
            )}
          </div>

          {/* ğŸ“ ìƒì„¸ ì •ë³´ ëª¨ë‹¬ */}
          <Modal isOpen={slotModal.isOpen} onClose={() => setSlotModal({ isOpen: false, data: null })} title={`ğŸ—ºï¸ ${slotModal.data?.êµ¬ì—­} ${slotModal.data?.ìœ„ì¹˜_ë²ˆí˜¸}`}>
            {slotModal.data && (
              <div className="space-y-3">
                <div className="flex justify-between items-center bg-slate-100 p-4 rounded-xl border border-slate-200 shadow-sm">
                  <div>
                    <p className="text-[10px] font-black text-slate-400">ì•ˆì¹˜ì (ì„±í•¨)</p>
                    <p className="text-xl font-black text-slate-800">{clean(slotModal.data.ì„±í•¨) || '-'}</p>
                  </div>
                  <div className="text-right">
                    <p className="text-[10px] font-black text-slate-400">í˜„ì¬ ìƒíƒœ</p>
                    <p className="text-lg font-black text-blue-600">{clean(slotModal.data.ê³„ì•½_ìƒíƒœ) || 'ë¯¸ë¶„ì–‘'}</p>
                  </div>
                </div>
                
                <div className="grid grid-cols-2 gap-3">
                  <div className="bg-white p-3 rounded-xl border border-slate-200 shadow-sm">
                    <p className="text-[10px] font-black text-slate-400 mb-1">ê³„ì•½ì</p>
                    <p className="font-bold text-slate-800">{clean(slotModal.data.ê³„ì•½ì) || '-'}</p>
                  </div>
                  <div className="bg-white p-3 rounded-xl border border-slate-200 shadow-sm">
                    <p className="text-[10px] font-black text-slate-400 mb-1">ê¸°ìˆ˜</p>
                    <p className="font-bold text-slate-800">{clean(slotModal.data.ê¸°ìˆ˜) ? `${slotModal.data.ê¸°ìˆ˜}ê¸°` : '-'}</p>
                  </div>
                </div>

                <div className="grid grid-cols-2 gap-3">
                  <div className="bg-white p-3 rounded-xl border border-slate-200 shadow-sm">
                    <p className="text-[10px] font-black text-slate-400 mb-1">ë¶„ì–‘ê°€</p>
                    <p className="font-bold text-amber-600">{formatMoney(slotModal.data.ê°€ê²©)}</p>
                  </div>
                  <div className="bg-white p-3 rounded-xl border border-slate-200 shadow-sm">
                    <p className="text-[10px] font-black text-slate-400 mb-1">ê´€ë¦¬ë¹„</p>
                    <p className="font-bold text-amber-600">{formatMoney(slotModal.data.ê´€ë¦¬ë¹„)}</p>
                  </div>
                </div>

                <div className="bg-white p-4 rounded-xl border border-slate-200 shadow-sm mt-2">
                  <p className="text-[10px] font-black text-slate-400 mb-2">ë¹„ê³  (í˜„ì¥ ë©”ëª¨)</p>
                  <p className="text-sm font-medium text-slate-600 whitespace-pre-wrap">{clean(slotModal.data.ë©”ëª¨) || 'ê¸°ë¡ëœ ë©”ëª¨ê°€ ì—†ìŠµë‹ˆë‹¤.'}</p>
                </div>
              </div>
            )}
          </Modal>
        </div>
      );
    }

    // ==========================================
    // âš™ï¸ Main Application Controller
    // ==========================================
    function App() {
      const [activeTab, setActiveTab] = useState('dash');
      const [isSidebarOpen, setIsSidebarOpen] = useState(false);

      return (
        <div className="flex h-screen overflow-hidden">
          {isSidebarOpen && <div className="fixed inset-0 bg-black/50 z-40 lg:hidden" onClick={() => setIsSidebarOpen(false)} />}
          <aside className={`fixed inset-y-0 left-0 z-50 w-64 bg-slate-900 text-slate-300 lg:static lg:translate-x-0 ${isSidebarOpen ? 'translate-x-0' : '-translate-x-full'} transition-transform shadow-2xl lg:shadow-none`}>
            <div className="p-6 border-b border-slate-800 flex justify-between items-center">
              <h1 className="text-xl font-black text-white tracking-tighter">JAKE WorkOS <span className="text-xs bg-emerald-600 px-1.5 py-0.5 rounded ml-1 text-white">V14</span></h1>
              <button className="lg:hidden text-slate-400 font-bold" onClick={() => setIsSidebarOpen(false)}>âœ•</button>
            </div>
            <nav className="p-4 space-y-8 overflow-y-auto h-[calc(100vh-80px)] no-scrollbar">
              <div>
                <p className="text-[10px] font-black text-slate-500 mb-3 ml-2 uppercase tracking-widest">ê³µìœ ì•± (Team)</p>
                <div className="space-y-1">
                  <button onClick={() => {setActiveTab('dash'); setIsSidebarOpen(false);}} className={`w-full flex items-center px-4 py-3 rounded-xl font-bold text-sm transition-all ${activeTab === 'dash' ? 'bg-blue-600 text-white shadow-lg shadow-blue-900/50' : 'hover:bg-slate-800'}`}>ğŸ“Š í†µí•© ëŒ€ì‹œë³´ë“œ</button>
                  <button onClick={() => {setActiveTab('field'); setIsSidebarOpen(false);}} className={`w-full flex items-center px-4 py-3 rounded-xl font-bold text-sm transition-all ${activeTab === 'field' ? 'bg-blue-600 text-white shadow-lg shadow-blue-900/50' : 'hover:bg-slate-800'}`}>ğŸ” í˜„ì¥ê´€ë¦¬ (Map)</button>
                  <button className="w-full flex items-center px-4 py-3 rounded-xl font-bold text-sm text-slate-600 cursor-not-allowed">ğŸ–ï¸ ê·¼íƒœê´€ë¦¬ (ëŒ€ê¸°ì¤‘)</button>
                </div>
              </div>
              <div>
                <p className="text-[10px] font-black text-slate-500 mb-3 ml-2 uppercase tracking-widest">WorkOS (Jake)</p>
                <div className="space-y-1">
                  <button className="w-full flex items-center px-4 py-3 rounded-xl font-bold text-sm text-slate-600 cursor-not-allowed">ğŸš€ í”„ë¡œì íŠ¸ (ëŒ€ê¸°ì¤‘)</button>
                  <button className="w-full flex items-center px-4 py-3 rounded-xl font-bold text-sm text-slate-600 cursor-not-allowed">âš°ï¸ ê°ì¸ê´€ë¦¬ (ëŒ€ê¸°ì¤‘)</button>
                </div>
              </div>
            </nav>
          </aside>

          <main className="flex-1 flex flex-col h-screen overflow-hidden">
            <header className="h-14 bg-white border-b border-slate-200 flex items-center px-6 justify-between shrink-0 shadow-sm z-10">
              <div className="flex items-center">
                <button className="lg:hidden p-2 text-slate-500 bg-slate-100 rounded-lg mr-4" onClick={() => setIsSidebarOpen(true)}>â˜°</button>
                <h2 className="font-black text-lg text-slate-800 uppercase tracking-tighter">{activeTab === 'dash' ? 'Integrated Dashboard' : 'Field Management'}</h2>
              </div>
              <div className="flex items-center space-x-2">
                <span className="text-[10px] font-black text-slate-400 hidden sm:inline">DATA ALIGNED</span>
                <div className="h-2 w-2 rounded-full bg-emerald-500 animate-pulse"></div>
              </div>
            </header>

            <div className="flex-1 overflow-hidden bg-[#F8FAFC]">
              {activeTab === 'dash' && <DashboardView />}
              {activeTab === 'field' && <FieldView />}
            </div>
          </main>
        </div>
      );
    }

    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<App />);
  </script>
</body>
</html>
