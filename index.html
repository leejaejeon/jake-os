<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>Jake Integrated OS</title>
  
  <script src="https://cdn.tailwindcss.com"></script>
  
  <script src="https://unpkg.com/react@18/umd/react.production.min.js" crossorigin></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js" crossorigin></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

  <style>
    /* Zí´ë“œ6 ìµœì í™” ë° ë‹¤í¬ í…Œë§ˆ ê¸°ë³¸ ì„¸íŒ… */
    body {
      background-color: #121212;
      color: #e0e0e0;
      overscroll-behavior-y: none;
      -webkit-font-smoothing: antialiased;
      font-family: 'Pretendard', sans-serif;
    }
    
    ::-webkit-scrollbar { width: 6px; }
    ::-webkit-scrollbar-track { background: #1e1e1e; }
    ::-webkit-scrollbar-thumb { background: #444; border-radius: 3px; }

    .card {
      background-color: #1e1e1e;
      border: 1px solid #333;
      border-radius: 0.75rem;
      box-shadow: 0 4px 6px rgba(0,0,0,0.3);
    }
    
    .status-badge {
      padding: 0.15rem 0.5rem;
      border-radius: 9999px;
      font-size: 0.75rem;
      font-weight: 700;
    }
    .status-progress { background: #0d6efd; color: white; }
    .status-ready { background: #6c757d; color: white; }
    .status-done { background: #198754; color: white; }
  </style>
</head>
<body>
  <div id="root"></div>

  <script type="text/babel">
    const { useState, useEffect } = React;

    // ğŸ” Supabase ì‹¤ì‹œê°„ ì—°ê²° (Jake ì œê³µ í‚¤)
    const SUPABASE_URL = 'https://lqccxnciiajwqdmpwjdv.supabase.co';
    const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImxxY2N4bmNpaWFqd3FkbXB3amR2Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzE1MjA3MTMsImV4cCI6MjA4NzA5NjcxM30.L23-eq-DIPsbONOeX-xQ8UcMb7gtgTTTRpkaSm9HTw4';
    const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

    function App() {
      const [projects, setProjects] = useState([]);
      const [locations, setLocations] = useState([]);
      const [loading, setLoading] = useState(true);
      const [error, setError] = useState(null);

      // âš™ï¸ Zero-Failure ë°ì´í„° íŒ¨ì¹­ ë¡œì§
      useEffect(() => {
        async function fetchDashboardData() {
          try {
            // 1. WorkOS: ì§„í–‰ ì¤‘ì¸ í”„ë¡œì íŠ¸ 5ê°œ ë¶ˆëŸ¬ì˜¤ê¸°
            const { data: projData, error: projError } = await supabase
              .from('projects')
              .select('*')
              .neq('status', 'ì™„ë£Œ')
              .order('start_date', { ascending: false })
              .limit(5);
            
            if (projError) throw projError;

            // 2. ê³µìœ ì•±: í˜„ì¥ ìœ„ì¹˜ ë§ˆìŠ¤í„° ë°ì´í„° ì¼ë¶€ ë¶ˆëŸ¬ì˜¤ê¸°
            const { data: locData, error: locError } = await supabase
              .from('master_locations')
              .select('*')
              .limit(5);

            if (locError) throw locError;

            setProjects(projData || []);
            setLocations(locData || []);
          } catch (err) {
            console.error('DB Fetch Error:', err);
            setError(err.message);
          } finally {
            setLoading(false);
          }
        }
        
        fetchDashboardData();
      }, []);

      if (loading) {
        return (
          <div className="flex h-screen w-screen items-center justify-center bg-[#121212]">
            <div className="text-[#0d6efd] text-xl font-bold animate-pulse">DB ì‹œìŠ¤í…œì— ì—°ê²° ì¤‘...</div>
          </div>
        );
      }

      if (error) {
        return (
          <div className="flex h-screen w-screen items-center justify-center bg-[#121212] p-4">
            <div className="card border-red-500 p-6 text-center">
              <h2 className="text-red-500 text-lg font-bold mb-2">í†µì‹  ì˜¤ë¥˜ ë°œìƒ</h2>
              <p className="text-sm text-gray-400">{error}</p>
            </div>
          </div>
        );
      }

      return (
        <div className="min-h-screen p-4 md:p-8 max-w-7xl mx-auto">
          <header className="mb-8 flex justify-between items-center border-b border-[#333] pb-4">
            <div>
              <h1 className="text-2xl font-extrabold text-white tracking-tight">Jake Integrated OS</h1>
              <p className="text-sm text-gray-500 mt-1">Supabase DB ì‹¤ì‹œê°„ ë™ê¸°í™” ì™„ë£Œ</p>
            </div>
            <div className="h-10 w-10 rounded-full bg-[#0d6efd] flex items-center justify-center font-bold text-white shadow-[0_0_15px_rgba(13,110,253,0.5)]">
              J
            </div>
          </header>

          <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
            
            {/* WorkOS íŒ¨ë„ */}
            <section className="card flex flex-col h-[400px]">
              <div className="flex justify-between items-center mb-4 border-b border-[#333] pb-2">
                <h2 className="text-lg font-bold text-white">ğŸš€ ì§„í–‰ ì¤‘ì¸ í”„ë¡œì íŠ¸ (WorkOS)</h2>
                <span className="text-xs text-gray-400">{projects.length}ê±´</span>
              </div>
              <div className="flex-1 overflow-y-auto pr-2">
                {projects.length === 0 ? (
                  <div className="text-center text-gray-500 mt-10 text-sm">ì§„í–‰ ì¤‘ì¸ í”„ë¡œì íŠ¸ê°€ ì—†ìŠµë‹ˆë‹¤.</div>
                ) : (
                  <div className="space-y-3">
                    {projects.map(p => (
                      <div key={p.id} className="p-3 bg-[#2a2a2a] rounded-lg border border-[#444] hover:border-[#0d6efd] transition-colors cursor-pointer">
                        <div className="flex justify-between items-start mb-1">
                          <span className="font-bold text-white text-sm">{p.title}</span>
                          <span className={`status-badge ${p.status === 'ì§„í–‰ì¤‘' ? 'status-progress' : 'status-ready'}`}>
                            {p.status}
                          </span>
                        </div>
                        <div className="text-xs text-gray-400 flex justify-between">
                          <span>{p.category || 'ë¯¸ë¶„ë¥˜'}</span>
                          <span>{p.end_date || 'ë§ˆê°ì¼ ì—†ìŒ'}</span>
                        </div>
                      </div>
                    ))}
                  </div>
                )}
              </div>
            </section>

            {/* ê³µìœ ì•± íŒ¨ë„ */}
            <section className="card flex flex-col h-[400px]">
              <div className="flex justify-between items-center mb-4 border-b border-[#333] pb-2">
                <h2 className="text-lg font-bold text-white">ğŸŒ³ ìˆ˜ëª© í˜„ì¥ ë§ˆìŠ¤í„° (ê³µìœ ì•±)</h2>
                <span className="text-xs text-gray-400">ë°ì´í„° ìƒ˜í”Œë§</span>
              </div>
              <div className="flex-1 overflow-y-auto pr-2">
                {locations.length === 0 ? (
                  <div className="text-center text-gray-500 mt-10 text-sm">ë§ˆìŠ¤í„° ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.</div>
                ) : (
                  <div className="space-y-2">
                    {locations.map(loc => (
                      <div key={loc.id} className="flex justify-between items-center p-3 bg-[#2a2a2a] rounded-lg border border-[#444]">
                        <div className="flex items-center gap-3">
                          <span className="text-[#0d6efd] font-mono font-bold text-sm bg-[#121212] px-2 py-1 rounded border border-[#333]">
                            {loc.section} {loc.slot_no}
                          </span>
                          <span className="text-sm font-bold text-white">{loc.deceased_name || '(ê³µë€)'}</span>
                        </div>
                        <span className={`text-xs px-2 py-1 rounded font-bold ${loc.status === 'ì•ˆì¹˜' ? 'bg-[#198754] text-white' : 'bg-[#333] text-gray-300'}`}>
                          {loc.status}
                        </span>
                      </div>
                    ))}
                  </div>
                )}
              </div>
            </section>

          </div>
        </div>
      );
    }

    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<App />);
  </script>
</body>
</html>
